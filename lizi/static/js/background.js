webpackJsonp([5],{1:function(e,t,n){"use strict";var a="https://api.x.xmt.cn",o="https://sso.xmt.cn";"release-production".match("production")||(a="",o="/sso");var r={titles:{ACCOUNT:"帐号管理",ADD_ACCOUNT:"添加帐号",CLASS:"新媒体课堂",DOWNLOAD:"App下载"},urls:{ACCOUNT_HOST:o,API_HOST:a,OPEN_HOST:"https://open.xmt.cn",ZAN_HOST:"https://api.xmtzan.com",ZAN_LOGIN:"api.xmtzan.com/api/web/login",CALENDAR_URL:"https://calendar.xmt.cn/",HOTARTICLE_API:"https://article.xmt.cn/",SEARCH_URL:"http://search.xmt.cn/",PAIBAN_HREF:"http://paiban.xmt.cn",MORE_PLATFORM_HREF:"https://wj.qq.com/s/918898/5579",PLAT_SYNC_HREF:"https://x.xmt.cn/sync/",WEB_LOGIN:o,SXL_URL:"https://x.xmt.cn/sxl/index.html",SXL_LOGIN:"https://www.sxl.cn/r/v1/users/xmt_users/login",PROFILE:"https://x.xmt.cn/user/",EXTENSION_API:"https://x.xmt.cn/user/#/appcenter",MATERIAL_API:"https://x.xmt.cn/user/#/material/photo",SOOGIF_SEARCH_GIF:a+"/api/sogif/image/search",SOOGIF_GET_COLUMN:a+"/api/sogif/column/list",SOOGIF_GET_GIF_LIST:a+"/api/sogif/column/image/list",IMAGE_SEARCH:a+"/api/openimage/search",IMAGE_GET_CATEGORY:a+"/api/openimage/categories",IMAGE_BY_CATEGORY:a+"/api/openimage/category",TEXT_LINK:a+"/system/option",DESKTOP_GET_DATA:a+"/api/super/desktop/account",DOC_IMPORT:a+"/api/word2html",COLLECT_STYLE:a+"/api/style_collect/add",GET_COLLECTED_STYLE:a+"/api/style_collect/list",DELETE_STYLE:a+"/api/style_collect/delete ",SAVE_STYLE:a+"/api/style_collect/update/",MESSAGE_GET:a+"/api/notify/list",MESSAGE_GET_UNREADCOUNT:a+"/api/notify/new_count",MESSAGE_GET_NEW:a+"/api/notify/list/new",MESSAGE_READ:a+"/api/notify/read",UPLOAD_IMG_API:"https://x.xmt.cn/uploadImg/index.html",STYLE_CENTER_URL:"https://x.xmt.cn/styleCenter/"},STORAGE_USERS_KEY:"xmt-extension-users",STORAGE_CONFIG_KEY:"xmt-extension-config",STORAGE_BIND_HINT_KEY:"xmt-should-show-bind-hint",DESKTOP:{CUSTOM_HEADER:"X-Xmt-Header",GET_FOLLOWER_URL:"https://mp.weixin.qq.com/cgi-bin/home?t=home/index&lang=zh_CN&f=json",GET_HEADLINE_URL:"https://mp.weixin.qq.com/cgi-bin/masssendpage?t=mass/list&action=history&begin=0&count=10&lang=zh_CN&f=json",ACCOUNT_STATUS:{EXPIRED:0,ACTIVE:1},CARD_STATUS:{DEFAULT:0,QRCODE:1,IMGCODE:2,WRONGPWD:3}},SYNC:{CUSTOM_HEADER_AID:"X-Xmt-Sync-Header-Aid",CUSTOM_HEADER_ACTION:"X-Xmt-Sync-Header-Action",CUSTOM_HEADER_PLAT:"X-Xmt-Sync-Header-Plat",CUSTOM_HEADER_Referer:"X-Xmt-Sync-Header-Referer",ERR_REPORT_URL:a+"/api/multiplatform/user/report_error"},SEARCH_PLATFORMS:{WEIXIN:"wx",WEIXIN_NUM:"wxn",UCHEAD:"uch",WEIXIN_TA:"wxta",TOUTIAO:"tt",WEIBO:"wb",YIDIAN:"yd",QIE:"qe",BAIJIA:"bj",WANGYI:"wy",SOHU:"sh",JIANSHU:"js",ZHIHU:"zh",UC:"uc",QINGBO:"qb",XINBANG:"xb",ZXCX:"zxcx",GOUTOUYING:"gty",PANSOU:"ps",PANDUODUO:"pdd",SO:"so",TAOBAO:"tb",SOGOU:"sg",JINGDONG:"jd",TMALL:"tm",YMX:"ymx",YANXUAN:"yx",SUNING:"sn"}};t.a=r},14:function(e,t,n){"use strict";t.a="release-production".match("production")},4:function(e,t,n){"use strict";var a={version:"6.56",displayVersion:"6.5.6",date:"2018-10-18"};a.defaultConfig={configList:{radarSwitch:{name:"公号雷达开关",status:!0,editable:!0},searchImg:{name:"显示图片搜索",status:!0,editable:!0},styleCollect:{name:"显示内容采集按钮",status:!0,editable:!0},showCollectBtn:{name:"显示图片采集按钮",status:!0,editable:!0},dragCollect:{name:"拖动图片采集功能",status:!0,editable:!0},sidebar:{name:"启用功能侧边栏",status:!0,editable:!0},toolbar:{name:"启用编辑工具强化栏",status:!0,editable:!0},imgScale:{name:"启用图片编辑工具条",status:!0,editable:!0},styleCenter:{name:"显示编辑器样式中心",status:!0,editable:!0},permanentLink:{name:"开启永久链接生成",status:!0,editable:!0},multiDelete:{name:"开启批量删除功能",status:!0,editable:!0},messageManager:{name:"开启消息快捷回复",status:!0,editable:!0},monthSearch:{name:"开启图文按月查询",status:!0,editable:!0},articleSearch:{name:"图文分析文章搜索",status:!0,editable:!0},autoReplyTextLink:{name:"后台回复添加链接",status:!0,editable:!0},coverMaking:{name:"显示题图制作按钮",status:!0,editable:!0},inspirationCenter:{name:"灵感中心",status:!0,editable:!0},syncLite:{name:"一键全网发布",status:!0,editable:!0}}},a.tabReg=/xmt.cn/,a.platforms=["wx","tt","qe","op","wb","bj","uc","zh","wy","sh","js","db"],a.platformCodes=["01","02","03","04","05","06","07","08","09","10","13","14","15"],a.weixinCookie=["data_bizuin","data_ticket","ticket_id","ticket","bizuin","slave_user","slave_sid"],a.toutiaoCookie=["currentMediaId","_mp_auth_key","sessionid"],a.toutiaoDelCookie=["sessionid","toutiao_sso_user","sso_login_status","sso_auth_status","__tasessionId","sid_tt","sid_guard","login_flag"],a.ttSsoCookie=["sso_auth_status","toutiao_sso_user","sessionid","toutiao_sso_user","sso_login_status","sso_auth_status","__tasessionId"],a.omCookie=["OM_EMAIL"],a.dianCookie=["JSESSIONID"],a.weiboCookie=["SUB","Apache","SUBP","SUHB","SSOLoginState","SINAGLOBAL","login_sid_t","YF-Ugrow-G0","YF-V5-9074G0","_s_tentry","un","wvr","SCF","WBStorage","ALF","UOR","SINAGLOBAL"],a.weiboSinaCookie=["Apache","LT","SCF","SINAGLOBAL","SUB","SUBP","sso_info","tgc"],a.weiboPwdCookie=["ULV","wvr","SRT","SRF","ALF","UOR"],a.bjCookie=["BAIDUID","BDUSS"],a.ucCookie=["USER_TMP","WM_ST","cna","isg"],a.zhCookie=["z_c0","q_c1"],a.wyCookie=["ANTICSRF","NTES_SESS","P_INFO","S_INFO","NTES_PASSPORT"],a.shCookie=["ppinf","ppmdig","pprdig","ppsmu","spinfo","spsession"],a.jsCookie=["_session_id","remember_user_token","_maleskine_session","_m7e_session"],a.wxbCookie=["PHPSESSID"],a.xbCookie=["token"],a.dbCookie=["dbcl2"],a.wxDomain="mp.weixin.qq.com",a.ttDomain="mp.toutiao.com",a.qeDomain="om.qq.com",a.opDomain="mp.yidianzixun.com",a.wbDomain=".weibo.com",a.bjDomain="baidu.com",a.ucDomain="mp.dayu.com",a.zhDomain="zhihu.com",a.wyDomain="163.com",a.shDomain="sohu.com",a.jsDomain="www.jianshu.com",a.wxbDomain=".wxb.com",a.xbDomain=".newrank.cn",a.dbDomain=".douban.com",a.wxUrl="https://mp.weixin.qq.com",a.taUrl="https://mp.weixin.qq.com",a.ttUrl="https://mp.toutiao.com",a.qeUrl="https://om.qq.com",a.opUrl="https://mp.yidianzixun.com",a.wbUrl="https://weibo.com",a.bjUrl="http://baijiahao.baidu.com/",a.ucUrl="https://mp.dayu.com",a.zhUrl="https://www.zhihu.com",a.wyUrl="http://mp.163.com/index.html",a.shUrl="https://mp.sohu.com/",a.jsUrl="https://www.jianshu.com/sign_in",a.wxbUrl="http://t.wxb.com/",a.xbUrl="http://www.newrank.cn/",a.dbUrl="https://www.douban.com/",a.wbTestLoginUrl="https://weibo.com/aj/onoff/getstatus?ajwvr=6&sid=0&__rnd=",a.shTestLoginUrl="https://mp.sohu.com/v2/main/stat/media_ajax_v2.action?start_date="+(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate()+"&end_date="+(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+((new Date).getDate()-1)+"&_=",a.wyTestLoginUrl="http://mp.163.com/wemedia/navinfo.do",a.bjTestLoginUrl="http://baijiahao.baidu.com/builder/app/appinfo",a.sogouImgUrl=["*://*.sogoucdn.com/*"],a.doubanImgUrl=["https://*.doubanio.com/view/*","https://www.douban.com/photos/*"],a.sogouUrl=["http://weixin.sogou.com/weixin*"],a.qrCode=["https://meihua.oss-cn-hangzhou.aliyuncs.com/*","https://meihua.oss.aliyuncs.com/*"],a.appmsganalysis=["https://mp.weixin.qq.com/misc/appmsganalysis?action=all&begin_date=*"],a.desktopNetworkBlockList=["https://mp.weixin.qq.com/","https://mp.weixin.qq.com/cgi-bin/home?t=home/index&lang=zh_CN&token=*","https://mp.weixin.qq.com/cgi-bin/masssendpage?t=mass/list&action=history&begin=*&count=*&token=*&lang=zh_CN&f=json","https://mp.weixin.qq.com/cgi-bin/bizlogin?action=startlogin","https://mp.weixin.qq.com/cgi-bin/verifycode?username=*&r=*&xmtIndex=*","https://mp.weixin.qq.com/cgi-bin/loginqrcode?action=getqrcode&xmtIndex=*&r=*","https://mp.weixin.qq.com/cgi-bin/loginqrcode?action=ask&token=&lang=zh_CN&token=&lang=zh_CN&f=json&ajax=1&xmtIndex=*&random=*","https://mp.weixin.qq.com/cgi-bin/loginauth?action=ask&token=&lang=zh_CN&token=&lang=zh_CN&f=json&ajax=1&xmtIndex=*&random=*","https://mp.weixin.qq.com/cgi-bin/bizlogin?action=login&token=&lang=zh_CN"],a.searchBlockList=["*://www.baidu.com/s*","*://tieba.baidu.com/f?kw=*","*://www.sogou.com/web?query=*","https://www.sogou.com/tx*","*://s.taobao.com/search*","*://shopsearch.taobao.com/search*","*://www.zhihu.com/search*","*://www.so.com/s?*","*://cn.bing.com/search?q=*","*://www.chinaso.com/search/pagesearch.htm?q=*","*://www.google.com/search*","*://www.google.com.hk/search*","*://www.youdao.com/w*","*://s.weibo.com/weibo*","*://www.toutiao.com/search/?keyword=*","*://www.soku.com/search_video*","*://search.bilibili.com/all?keyword=*","*://ke.qq.com/course/list*","*://www.icourse163.org/search.htm?search*","*://study.163.com/provider-search?keyword*","*://study.163.com/courses-search?keyword*","*://www.genshuixue.com/sh*","*://class.hujiang.com/esearch?k=*","*://www.cctalk.com/search?keyword*","*://www.zaih.com/search?word*","*://ke.youdao.com/search*","*://www.douban.com/search?q*","*://so.iqiyi.com/so*","*://v.qq.com/x/search/?q*","*://so.tv.sohu.com/mts?wd*","*://search.pptv.com/s_video*","*://www.fun.tv/search/?word*","*://so.le.com/s?wd*","*://www.ximalaya.com/search/all/kw*","*://36kr.com/search/articles*","*://v.youmi.cn/search/result?q*","*://www.huodongxing.com/search?qs*","*://www.vko.cn/search/?key*","*://www.qingting.fm/search/all*","*://search.jd.com/Search?keyword*","*://search.dangdang.com/?key*","*://www.newrank.cn/public/info/search.html?value*"],a.readabilityBlockList=["https://mercury.postlight.com/parser*"],t.a=a},5:function(e,t,n){"use strict";var a=n(13),o=n.n(a),r=n(2),i=n.n(r),s=n(53),c=n.n(s),u=n(1),l=n(14),d=function(e,t){var n=new RegExp("(^|&|\\?)"+e+"=([^&]*)(&|$)","i"),a=t||window.location.search,o=a.substr(1).match(n);return null!==o?unescape(o[2]):null},m=function(e){var t="";switch(e){case"01":t="微信公众平台";break;case"02":t="今日头条";break;case"03":t="企鹅媒体平台";break;case"04":t="一点资讯";break;case"05":t="微博";break;case"06":t="uc大鱼号";break;case"07":t="知乎";break;case"08":t="搜狐号";break;case"09":t="百度百家号";break;case"10":t="网易号";break;case"13":t="简书";break;case"14":t="微信小程序";break;case"15":t="豆瓣";break;default:t=void 0}return t},p=function(e){var t="";switch(e){case"01":t="wx";break;case"02":t="tt";break;case"03":t="qe";break;case"04":t="op";break;case"05":t="wb";break;case"06":t="uc";break;case"07":t="zh";break;case"08":t="sh";break;case"09":t="bj";break;case"10":t="wy";break;case"13":t="js";break;case"14":t="wx_ta";break;case"15":t="db";break;default:t=void 0}return t},h=n(4),f=function(e){var t=void 0;switch(e){case"wx":case"wx_ta":t=h.a.wxUrl;break;case"tt":t=h.a.ttUrl;break;case"qe":t=h.a.qeUrl;break;case"op":t=h.a.opUrl;break;case"wb":t=h.a.wbUrl;break;case"bj":t=h.a.bjUrl;break;case"uc":t=h.a.ucUrl;break;case"zh":t=h.a.zhUrl;break;case"wy":t=h.a.wyUrl;break;case"sh":t=h.a.shUrl;break;case"js":t=h.a.jsUrl;break;case"xb":t=h.a.xbUrl;break;case"wxb":t=h.a.wxbUrl;break;case"db":t=h.a.dbUrl;break;default:t=void 0}return t},g=function(e){var t=void 0;switch(e){case"wx":t="01";break;case"tt":t="02";break;case"qe":t="03";break;case"op":t="04";break;case"wb":t="05";break;case"uc":t="06";break;case"zh":t="07";break;case"sh":t="08";break;case"bj":t="09";break;case"wy":t="10";break;case"js":t="13";break;case"wx_ta":t="14";break;case"db":t="15";break;case"wxb":t="100";break;case"xb":t="101";break;default:t=void 0}return t},b=function(e){var t=void 0;switch(e){case"wx":case"wx_ta":t=h.a.weixinCookie;break;case"tt":t=h.a.toutiaoCookie;break;case"ttsso":t=h.a.ttSsoCookie;break;case"qe":t=h.a.omCookie;break;case"op":t=h.a.dianCookie;break;case"wb":t=h.a.weiboCookie;break;case"bj":t=h.a.bjCookie;break;case"uc":t=h.a.ucCookie;break;case"zh":t=h.a.zhCookie;break;case"wy":t=h.a.wyCookie;break;case"sh":t=h.a.shCookie;break;case"js":t=h.a.jsCookie;break;case"db":t=h.a.dbCookie;break;case"wxb":t=h.a.wxbCookie;break;case"xb":t=h.a.xbCookie}return t},v=function(e,t){var n=void 0;switch(e){case"wx":case"wx_ta":n=/class="login_form"/.test(t)||/class="icon_page_error"/.test(t)||/id="loginBt"/.test(t);break;case"tt":n=/btn login/.test(t);break;case"qe":n=/btn-a-login/.test(t);break;case"op":n=/class="mp-btn mp-btn-large mp-btn-cancel l-button show-login"/.test(t);break;case"wb":n=!t.code;break;case"bj":n=0!==t.errno;break;case"uc":n=/login_banner/.test(t);break;case"zh":n=/Button SignFlow-submitButton/.test(t);break;case"sh":if(t.status)n=!1;else try{n=!JSON.parse(t).status}catch(e){n=!0}break;case"wy":if(t.code&&1===t.code)n=!1;else try{n=!(1===JSON.parse(t).code)}catch(e){n=!0}break;case"js":n=/sign-in-button/.test(t);break;case"db":n=/id="anony-reg-new"/.test(t);break;default:n=!0}return n},w=function(e){var t=void 0;switch(e){case"wx":case"wx_ta":t=h.a.wxDomain;break;case"tt":t=h.a.ttDomain;break;case"qe":t=h.a.qeDomain;break;case"op":t=h.a.opDomain;break;case"wb":t=h.a.wbDomain;break;case"bj":t=h.a.bjDomain;break;case"uc":t=h.a.ucDomain;break;case"zh":t=h.a.zhDomain;break;case"sh":t=h.a.shDomain;break;case"wy":t=h.a.wyDomain;break;case"js":t=h.a.jsDomain;break;case"db":t=h.a.dbDomain;break;case"wxb":t=h.a.wxbDomain;break;case"xb":t=h.a.xbDomain;break;default:t=void 0}return t},k=function(e){var t="";switch(e){case"wb":t="https://weibo.com/login.php";break;case"tt":t="https://sso.toutiao.com/login/?next=/&service=http://mp.toutiao.com/sso_confirm/?redirect_url=/";break;case"qe":t="https://om.qq.com/userAuth/index";break;case"zh":t="https://www.zhihu.com/#signin";break;case"wy":t="http://mp.163.com/wemedia/notice/list/1/20.html";break;case"bj":t="http://baijiahao.baidu.com/builder/app/login";break;default:t=f(e)}return t},_=n(9),y=n.n(_),x=function(){return new y.a(function(e,t){chrome.storage.sync.get(function(n){console.log("getting sync items"),console.log(n),n?"function"==typeof e&&e(n):"function"==typeof t&&t(n)})})},C=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],S=function(e){if(""===e)return"";var t=Math.round(25*Math.random()),n=C[t],a=e.substring(0,1)+n+e.substring(1)+t;return window.btoa(a).replace(/\r|\n/g,"")},I=function(e){if(""===e)return"";if(e=e.replace(/\r|\n/g,""),!/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/.test(e))return e;var t="";try{t=window.atob(e)}catch(t){return e}if(t.length<6||t.length>21)return e;for(var n=0;n<t.length;n++)if(t.charCodeAt(n)<33||t.charCodeAt(n)>126)return e;var a=t.substring(1,2);return t=C.indexOf(a)<10?t.substring(0,t.length-1):t.substring(0,t.length-2),t.substring(0,1)+t.substring(2,t.length)},T={encode:S,decode:I},D=n(31),A=n.n(D),j=function e(t,n,a){if(null===n||"object"!==(void 0===n?"undefined":A()(n)))return n;var o=void 0;for(var r in n)!n.hasOwnProperty(r)||a.exclude&&-1!==a.exclude.indexOf(r)||(o=n[r],a.deep&&("object"===(void 0===o?"undefined":A()(o))||Array.isArray(o))?t.hasOwnProperty(r)&&e(t[r],o,{deep:!0,exclude:a.exclude||"undefined"}):t.hasOwnProperty(r)&&(t[r]=o))},E=j,O=function(e){var t=e||new Date,n=t.getFullYear(),a=t.getMonth()+1,o=a<10?"0"+a:a,r=t.getDate(),i=r<10?"0"+r:r,s=t.getHours(),c=s<10?"0"+s:s,u=t.getMinutes();return n+"-"+o+"-"+i+" "+c+":"+(u<10?"0"+u:u)+":00"},L=function(e){var t=e?new Date(e):new Date,n=t.getFullYear(),a=t.getMonth()+1,o=a<10?"0"+a:a,r=t.getDate();return n+"-"+o+"-"+(r<10?"0"+r:r)},U={formatTime:O,formatDate:L},q=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.innerText||t.textContent;return t=null,n},H=function(e){return window.localStorage?window.localStorage.getItem(e):(console.log("不支持 localstorage"),null)},N=function(e,t){return window.localStorage?window.localStorage.setItem(e,t):(console.log("不支持 localstorage"),null)},P=function(e){return window.localStorage?window.localStorage.removeItem(e):(console.log("不支持 localstorage"),null)},R={getStorage:H,setStorage:N,removeStorage:P},M=n(34),B=n.n(M),G=function(e){return void 0===e?"":"?"+B()(e).filter(function(t){return void 0!==e[t]}).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent("string"==typeof e[t]?e[t]:e[t].toString())}).join("&")},F={};F.getQueryString=d,F.getPlatName=m,F.convertPlatCode=p,F.getPlatUrl=f,F.getPlatformCode=g,F.getPlatCookie=b,F.isNotLogged=v,F.getDomain=w,F.genOpenMpUrl=k,F.throttle=c.a,F.getOptions=x,F.enpassword=T.encode,F.depassword=T.decode,F.objCopy=E,F.getFormattedDate=U.formatTime,F.formatIntTime=U.formatDate,F.HTMLDecode=q,F.getStorage=R.getStorage,F.setStorage=R.setStorage,F.removeStorage=R.removeStorage,F.param=G,F.dataCount=function(e){l.a&&chrome.extension.sendRequest({operation:"dataCount",options:e})},F.saveOptions=function(e){chrome.storage.sync.set(e)},F.browerOpenUrl=function(e){chrome.tabs.create({url:e})},F.genId=function(){return(Date.now().toString(36)+Date.now().toString(36)).substr(4)},F.unBind=function(e,t,n){return i.a.ajax({url:u.a.urls.API_HOST+"/api/user/unbind_v2",type:"POST",data:{aid:e,type:t,platformCode:""+n},dataType:"json"})},F.postCookie=function(e,t){return i.a.ajax({url:e,type:"POST",data:t,dataType:"json"})},F.errorTip=function(e){i()("body").append('<div class="JS_TIPS page_tips error"><div class="inner">'+e+"</div></div>"),setTimeout(function(){i()(".JS_TIPS").remove()},1e3)},F.succTip=function(e){i()("body").append('<div class="JS_TIPS weui-toptips weui-toptips_success">\n       <div class="weui-toptips__inner"> '+e+" </div>\n     </div>"),setTimeout(function(){i()(".JS_TIPS").remove()},1e3)},F.submitArticle=function(e){return i.a.ajax({url:u.a.urls.API_HOST+"/api/sxl/mini_program/blogs",contentType:"application/json;charset=utf-8;charset=UTF-8",type:"POST",data:o()(e)}).then(function(e){console.log(e)})},F.getPluginVersion=function(){var e=chrome.runtime.getManifest().version;return parseFloat(e.split(".")[0]+"."+e.split(".")[1]+e.split(".")[2],10)},F.getWxTitle=function(e){var t=new RegExp("(^|&|/?)"+e+"=([^&]*)(&|$)","i"),n=window.location.search,a=n.substr(1).match(t);return null!==a?decodeURI(a[2]):null};t.a=F},571:function(e,t,n){"use strict";function a(e,t){"release-production".match("production")&&chrome.tabs.create({url:e},function(e){chrome.tabs.executeScript(e.id,{code:'window.location.href = window.location.href.replace("#/", "&window_id='+e.id+'#/");',runAt:"document_start"}),"function"==typeof t&&t(e)})}function o(){u(-1),_e<3&&setTimeout(r,500)}function r(){_e++,b.a.getJSON(_.a.urls.API_HOST+"/api/bind/users_v2").then(function(e){try{var t=e}catch(e){return void o()}if(t.base_resp){if(-3==t.base_resp.ret)return o(),void(ye.loginData.loginStatus=-3);if(0==t.base_resp.ret)return u(0,t.phone),void i(t.multiPlatformUsers);o()}else o()},function(){o()})}function i(e){ye.accountsData=e}function s(){return ye.accountsData}function c(){return ye.loginData}function u(e,t){ye.loginData.loginStatus=e,0!==e?(ye.loginData.loginAccount="",ye.accountsData=[]):ye.loginData.loginAccount=t||""}function l(e,t,n){if(1==e.nodeType&&e.tagName.toLowerCase()==t&&n.push(e),e.childNodes&&e.childNodes.length)for(var a,o=0;a=e.childNodes[o++];)l(a,t,n)}Object.defineProperty(t,"__esModule",{value:!0});var d,m=n(62),p=n.n(m),h=n(13),f=n.n(h),g=n(2),b=n.n(g),v=n(4),w=n(9),k=n.n(w),_=n(1),y=n(5),x={extensionConfig:JSON.parse(f()(v.a.defaultConfig)),customStyle:{style:[]},timer:{},configExpired:!0,infoReport:!1,init:function(){var e=this;y.a.getOptions().then(function(t){t.configV2&&y.a.objCopy(e.extensionConfig,t.configV2,{deep:!0,exclude:["editable","name"]});for(var n in e.extensionConfig.configList)e.extensionConfig.configList.hasOwnProperty(n)&&!1===e.extensionConfig.configList[n].editable&&(e.extensionConfig.configList[n].status=!1);e.customStyle=t.customStyle,e.updateConfig()},function(){})},updateConfig:function(){var e=this;return new k.a(function(t,n){e.configExpired&&(e.configExpired=!1,e.timer=setTimeout(function(){e.configExpired=!0},6e5),console.log("update config"),b.a.ajax({url:_.a.urls.TEXT_LINK+"?version="+v.a.version,type:"get",dataType:"json"}).done(function(a){0===a.base_resp.ret?(a.option.foreverLink?0==e.extensionConfig.configList.permanentLink.editable&&(e.extensionConfig.configList.permanentLink.editable=!0,e.extensionConfig.configList.permanentLink.status=!0):!1===a.option.foreverLink&&(e.extensionConfig.configList.permanentLink.status=!1,e.extensionConfig.configList.permanentLink.editable=!1),e.infoReport=a.option.userInfoReport,t(a)):n(a)},function(e){n(e)}))})},forceUpdate:function(){return clearTimeout(this.timer),this.configExpired=!0,this.updateConfig()},getConfig:function(e){return this.updateConfig(),e?"infoReport"===e?this.infoReport:this.extensionConfig.configList[e].status:this.extensionConfig},setConfig:function(e){y.a.objCopy(this.extensionConfig.configList,e,{deep:!0}),y.a.saveOptions({configV2:this.extensionConfig})},getCustomStyle:function(){return this.customStyle},setCustomStyle:function(e){this.customStyle=e}},C=x,S=n(575),I=n.n(S),T=n(78),D=function(){var e=[];b.a.getJSON(_.a.urls.DESKTOP_GET_DATA).then(function(t){return 0==t.base_resp.ret&&t.accounts.map(function(t,n){e[n]=T.a.newAccountData();for(var a in t)t.hasOwnProperty(a)&&(e[n][a]=t[a])}),e}).then(function(e){var t={};e.map(function(e,n){t[_.a.DESKTOP.CUSTOM_HEADER]="testLogin:"+n,b.a.ajax({url:"https://mp.weixin.qq.com/",type:"GET",headers:t}).then(function(t){y.a.isNotLogged("wx",t)?e.status=_.a.DESKTOP.ACCOUNT_STATUS.EXPIRED:(e.token=T.a.getToken(t),e.status=_.a.DESKTOP.ACCOUNT_STATUS.ACTIVE,T.a.getData(n,e.token,function(n){0==n.state?y.a.objCopy(e,t,{deep:!1}):e.status=_.a.DESKTOP.ACCOUNT_STATUS.EXPIRED}))},function(e){console.log("过期测试 failed")})})});var t={testLogin:[],getImgCode:[],desktopStartLogin:[],desktopFinishLogin:[],getFansCount:[],getHeadline:[]},n=function(n){var a=n.requestHeaders;if(n.url.match(/action=(getqrcode|ask)(.+)?&xmtIndex/)||n.url.match(/verifycode\?username=/)){var o=n.url.split("xmtIndex=")[1].split("&")[0];n.url.match(/verifycode\?username=/)&&(t.getImgCode[o]=n.requestId);for(var r=0;r<a.length;r++)"cookie"===a[r].name.toLowerCase()&&(a[r].value=e[o].cookies);return{requestHeaders:a}}for(var i=0;i<a.length;i++)if(a[i].name===_.a.DESKTOP.CUSTOM_HEADER){var s=a[i].value.split(":")[1],c=a[i].value,u=!1,l=void 0;c.match(/desktopStartLogin/)?l=t.desktopStartLogin:c.match(/desktopFinishLogin/)?l=t.desktopFinishLogin:c.match(/testLogin/)?l=t.testLogin:c.match(/getFansCount/)?l=t.getFansCount:c.match(/getHeadline/)&&(l=t.getHeadline),l[s]=n.requestId;for(var d=0;d<a.length&&("Referer"!==a[d].name||(a[d].value="https://mp.weixin.qq.com/",u=!0,!c.match(/desktopStartLogin/)));d++)"cookie"===a[d].name.toLowerCase()&&e[s]&&(a[d].value=e[s].cookies);!1===u&&a.push({name:"Referer",value:"https://mp.weixin.qq.com/"});break}return{requestHeaders:a}};chrome.webRequest.onBeforeSendHeaders.addListener(n,{urls:v.a.desktopNetworkBlockList},["blocking","requestHeaders"]);var a=function(n){var a=void 0,o=void 0;if(n.url.match(/action=startlogin/)?o=t.desktopStartLogin:n.url.match(/action=login/)?o=t.desktopFinishLogin:"https://mp.weixin.qq.com/"===n.url||n.url.match(/cgi-bin\/home\?t=home\/index/)&&-1===n.url.indexOf("f=json")?o=t.testLogin:n.url.match(/cgi-bin\/home\?t=home\/index.*f=json/)?o=t.getFansCount:n.url.match(/cgi-bin\/masssendpage\?t=mass\/list.*f=json/)?o=t.getHeadline:n.url.match(/verifycode\?username=/)&&(o=t.getImgCode),o){if(-1!==(a=o.indexOf(n.requestId))){var r=n.responseHeaders,i=[],s=void 0;s=e[a];for(var c=0;c<r.length;c++)"set-cookie"!==r[c].name.toLowerCase()?i.push(r[c]):s&&function(){var e=r[c].value.split(";")[0],t=e.split(/=(.+)?/)[0],n=e.split(/=(.+)?/)[1],a=new RegExp("(^|;)"+t+"=(.*?)($|;)");"EXPIRED"!==n?-1!==s.cookies.indexOf(t)?s.cookies=s.cookies.replace(a,function(e,a,o,r){return a+t+"="+n+r}):s.cookies+=";"+e:-1!==s.cookies.indexOf(t)&&(s.cookies=s.cookies.replace(a,function(e,t,n,a){return 0==t.length?"":";"}))}();return{responseHeaders:i}}return{requestHeaders:n.requestHeaders}}return{requestHeaders:n.requestHeaders}};chrome.webRequest.onHeadersReceived.addListener(a,{urls:v.a.desktopNetworkBlockList},["blocking","responseHeaders"]),chrome.extension.onRequest.addListener(function(t,n,a){if("desktop"==t.operation)switch(t.action){case"getData":a({accountsData:e});break;case"setData":if(void 0!==t.accountIndex)y.a.objCopy(e[t.accountIndex],t.data,{deep:!1,exclude:["cookies"]});else{t.data.length<e.length&&e.splice(t.data.length);for(var o in t.data)e.hasOwnProperty(o)?("setAccountData"==t.type&&y.a.objCopy(e[o],t.data[o],{deep:!1,exclude:["cookies"]}),"setAccounts"==t.type&&y.a.objCopy(e[o],t.data[o],{deep:!1})):e[o]=t.data[o]}a({status:"succ"});break;case"setCookie":for(var r=e[t.accountIndex],i=y.a.getPlatCookie("wx"),s=r.cookies.split(";").filter(function(e){return e.length>0&&-1!==i.indexOf(e.split(/=(.+)?/)[0])}),c="",u=0;u<s.length;u++)c+=s[u]+";";var l={clientPlatform:"plugin",clientVersion:v.a.version,platformCode:"01",userInfoUniqueId:r.user_info_unique_id,username:"",password:"",cookieContent:c};b.a.ajax({url:_.a.urls.API_HOST+"/api/set_cookies_v2",type:"post",data:l,dataType:"json",success:function(e){a(0===e.base_resp.ret?{status:!0}:{statue:!1})}});break;case"accountsArrModify":var d=t.accounts.filter(function(e){return"01"==e.platformCode});d=d.slice(0,4);var m=[];d.map(function(t,n){if(e[n]&&e[n].aId==t.aId)m[n]=e[n];else for(var a=0;a<e.length;a++){if(e[a].aId==t.aId){m[n]=e[a];break}a==e.length-1&&(m[n]=T.a.newAccountData())}}),e=m;break;case"clear":e=[]}})},A={},j=0,E=function(e){var t=void 0,n=e.split("-"),a=parseInt(n[1])+1;return t=a<10?"0"+a:a,13==a?parseInt(n[0])+1+"-01-01":n[0]+"-"+t+"-"+n[2]},O=function(e){var t=void 0,n=e.split("-"),a=parseInt(n[1]);return t=a<10?"0"+a:a,n[0]+"-"+t+"-01"},L=function(e){if(e.url.match(/appmsganalysis\?action=all/)&&1==j&&!e.url.match(/func=xmt/)){var t=new RegExp(/\?.*/),n=t.exec(e.url)[0],a=unescape(n.substr(1).match(new RegExp("(^|&)token=([^&]*)(&|$)"))[2]),o=unescape(n.substr(1).match(new RegExp("(^|&)random=([^&]*)(&|$)"))[2]),r=O(d);return{redirectUrl:"https://mp.weixin.qq.com/misc/appmsganalysis?action=all&begin_date="+r+"&end_date="+E(r)+"&order_by=1&order_direction=2&token="+a+"&lang=zh_CN&f=json&ajax=1&random="+o}}};A.setTime=function(e){d=e},A.setSearchMouth=function(e){j=e},A.getSearchMouth=function(){return j},A.init=function(){chrome.webRequest.onBeforeRequest.addListener(L,{urls:v.a.appmsganalysis},["blocking"])};var U=A,q=[],H=function(e){var t=/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/i;return e.match(t)[2]},N=function(){var e={dark:0,light:0},t={bg:0,promotion:0};y.a.getOptions().then(function(n){if(void 0!=n.darkConfig){if(e=n.darkConfig,1===e.dark)return P();if(1===e.light)return M()}void 0!=n.tasteConfig&&(t=n.tasteConfig)}),chrome.tabs.onReplaced.addListener(function(t,n){return 1==e.dark?P():1==e.light?M():void 0}),chrome.tabs.onUpdated.addListener(function(t,n,a){if("complete"==n.status&&-1==a.url.indexOf("chrome://")&&(q.push(window.btoa(H(a.url))),q.length>=50)){var o={total:f()(q)};b.a.ajax({url:_.a.urls.API_HOST+"/api/tj/stat",type:"POST",data:o,success:function(e){console.log(e)}}),q=[]}return 1==e.dark?P():1==e.light?M():void 0}),b.a.ajax({url:_.a.urls.API_HOST+"/api/user/status",type:"GET",dataType:"json"}).then(function(e){0===e.base_resp.ret?e.data.backgroundStatus&&chrome.tabs.onUpdated.addListener(function(e,t){return"loading"===t.status&&"chrome://newtab/"===t.url&&chrome.tabs.update(e,{url:"/search.html"}),!0}):-3===e.base_resp.ret&&1===t.bg&&chrome.tabs.onUpdated.addListener(function(e,t){return"loading"===t.status&&"chrome://newtab/"===t.url&&chrome.tabs.update(e,{url:"/search.html"}),!0})}),chrome.extension.onRequest.addListener(function(n,a,o){switch(n.operation){case"dark":switch(n.action){case"open":P();break;case"close":R()}break;case"light":switch(n.action){case"open":M();break;case"close":R()}break;case"darkConfig":switch(n.action){case"get":o(e);break;case"set":e=n.darkConfig,y.a.saveOptions({darkConfig:e})}case"tasteConfig":switch(n.action){case"get":o(t);break;case"set":t=n.tasteConfig,y.a.saveOptions({tasteConfig:t})}}})},P=function(){chrome.tabs.query({},function(e){e.forEach(function(e){B("0",e)})})},R=function(){chrome.tabs.query({},function(e){e.forEach(function(e){G(e)})})},M=function(){chrome.tabs.query({},function(e){e.forEach(function(e){B("1",e)})})},B=function(e,t){var n=F(e);-1===t.url.indexOf("chrome://")&&-1===t.url.indexOf("chrome-extension://")&&chrome.tabs.executeScript(t.id,{code:n,runAt:"document_start"})},G=function(e){-1===e.url.indexOf("chrome://")&&-1===e.url.indexOf("chrome-extension://")&&chrome.tabs.executeScript(e.id,{code:Y(),runAt:"document_start"})},F=function(e){var t=void 0;return" var darkstyle = document.getElementById('xmt-dark-reader-style');var css = '"+(t="0"==e?'@media screen{html{-webkit-filter: invert(100%) hue-rotate(180deg) brightness(110%) contrast(80%) grayscale(30%) sepia(10%) !important;}img,iframe,video,*:not(object):not(body)>embed,object,svg image,*[style*="background:url"]:empty,*[style*="background-image:url"]:empty,*[style*="background: url"]:empty,*[style*="background-image: url"]:empty{-webkit-filter:invert(100%) hue-rotate(180deg) !important}html{text-shadow:0 0 0 !important}*:-webkit-full-screen,*:-webkit-full-screen *{-webkit-filter:none !important}html{background:rgb(34,34,34)!important}}':"@media screen{html{-webkit-filter:grayscale(30%) sepia(10%) !important}html{text-shadow:0 0 0 !important}*:-webkit-full-screen,*:-webkit-full-screen *{-webkit-filter:none !important}html{background:rgb(255,255,253) !important}}")+"';\n    var style = document.createElement('style');\n    style.setAttribute('id', 'xmt-dark-reader-style');\n    style.type = 'text/css';\n  if(!darkstyle){style.appendChild(document.createTextNode('"+t+"'));document.head.appendChild(style);}else{darkstyle.innerHTML = '"+t+"'}"},Y=function(){return"var style = document.getElementById('xmt-dark-reader-style');if(style){style.parentElement.removeChild(style)};"},z=N,V=n(16),X=n.n(V),J=n(17),K=n.n(J),W=function(){function e(){X()(this,e)}return K()(e,null,[{key:"genWxUserData",value:function(){var e=document.createElement("script");e.innerHTML='\n      (function(){\n        var ticket = window.wx.data.ticket;\n        var ticketId = window.wx.data.user_name;\n        var uin = window.wx.data.uin;\n        $("body").append("<input type=\'hidden\' id=\'xmt-wx-ticket-input\' >");\n        $("body").append("<input type=\'hidden\' id=\'xmt-wx-username-input\' >");\n        $("body").append("<input type=\'hidden\' id=\'xmt-wx-uin\' >");\n        $("#xmt-wx-ticket-input").val(ticket);\n        $("#xmt-wx-uin").val(uin);\n        $("#xmt-wx-username-input").val(ticketId);\n      })()\n    ',document.body.appendChild(e)}},{key:"getToken",value:function(){return y.a.getQueryString("token")}},{key:"getTicket",value:function(){return b()("#xmt-wx-ticket-input").val()}},{key:"getUsername",value:function(){return b()("#xmt-wx-username-input").val()}},{key:"getUin",value:function(){return b()("#xmt-wx-uin").val()}},{key:"fileTransfer",value:function(t,n){var a="https://mp.weixin.qq.com/cgi-bin/filetransfer"+y.a.param({action:"upload_material",f:"json",scene:"8",writetype:"doublewrite",groupid:"3",ticket_id:n&&n.ticket_id||e.getUsername(),ticket:n&&n.ticket||e.getTicket(),svr_time:parseInt(Date.now()/1e3).toString(),token:n&&n.token||y.a.getQueryString("token"),lang:"zh_CN",seq:Date.now().toString()}),o=0,r=0,i=new Image;i.onload=function(){o=i.width,r=i.height},i.src=t;var s=new FormData;s.append("id",Date.now().toString()),s.append("name","xmt_"+Date.now()),s.append("type","image/gif"),s.append("lastModifiedDate",new Date),s.append("size",Math.round(3*t.length/4));var c=e.base64ToBlob(t);return console.log(c.size),s.append("file",c,"xmt_"+Date.now()+".gif"),b.a.ajax({type:"POST",url:a,processData:!1,contentType:!1,data:s}).then(function(e){return 0===e.base_resp.ret?k.a.resolve({body:e,imgInfo:{width:o,height:r}}):k.a.reject(e)},function(e){return k.a.reject(e)})}},{key:"uploadImg2Cdn",value:function(t){return b.a.ajax({url:"https://mp.weixin.qq.com/cgi-bin/uploadimg2cdn?lang=zh_CN&token="+e.getToken(),method:"POST",data:{imgurl:t,t:"ajax-editor-upload-img"}}).then(function(e){var t="",n=0;return 0==e.errcode?b.a.Deferred().resolve({code:n,url:e.url}):("15003"==e.errcode?(t="图片太大无法添加",n=1):(t="图片添加失败",n=e.errcode),console.log(t),b.a.Deferred().reject({code:n,msg:t}))},function(e){return console.log("图片上传 网络错误"),b.a.Deferred().reject({code:-1,msg:"网络错误"})})}},{key:"base64ToBlob",value:function(e,t){for(var n=atob(e.split(",")[1]),a=[],o=0;o<n.length;o+=512){for(var r=n.slice(o,o+512),i=new Array(r.length),s=0;s<r.length;s++)i[s]=r.charCodeAt(s);var c=new Uint8Array(i);a.push(c)}return new Blob(a,{type:t||"image/gif"})}}]),e}(),$=W,Q={},Z=function(e){for(var t=e.requestHeaders,n=0;n<t.length;n++)"Referer"==t[n].name&&(t[n].value="");return{requestHeaders:t}};Q.addListener=function(){chrome.webRequest.onBeforeSendHeaders.addListener(Z,{urls:v.a.qrCode},["blocking","requestHeaders"])},Q.removeListener=function(){chrome.webRequest.onBeforeSendHeaders.removeListener(Z)};var ee=Q,te=n(34),ne=n.n(te),ae=function(e){var t=(new Date).getTime(),n="";switch(e.type){case"pv":n=_.a.urls.API_HOST+"/statistics.js?page="+(e.name||e.page);break;case"action":n=_.a.urls.API_HOST+"/statistics.js?action="+(e.name||e.action)}ne()(e).filter(function(e){return!/name|page|action|type/.test(e)}).map(function(t){return n+="&"+t+"="+e[t],t}),n+="&r="+t,b.a.get(n)},oe={needUpdate:!1,updateUrl:"",updateVer:"",needProxy:!1,init:function(){var e=this;this.clearProxy(),this.switchIcon(!1),chrome.runtime.onInstalled.addListener(function(t){e.clearProxy()}),chrome.runtime.onUpdateAvailable.addListener(function(t){console.log("update available"),e.needProxy&&ae({type:"action",name:"autoUpdateSucc"}),e.clearProxy(),e.forceUpdateTimer&&clearTimeout(e.forceUpdateTimer)}),this.checkUpdate()},checkUpdate:function(){var e=this;return this.checkNewVersion().then(function(t){t.hasNewVer?(e.needUpdate=!0,e.updateVer=t.version,e.updateUrl=t.url,e.switchIcon(!0),e.update()):(console.log("已经是最新版"),e.needUpdate=!1,e.updateVer=t.version,e.updateUrl="",e.switchIcon(!1),e.clearProxy(),setTimeout(function(){e.checkUpdate()},108e5),e.update())},function(t){console.log("检测更新请求失败"),e.clearProxy(),setTimeout(function(){e.checkUpdate()},108e5)})},checkNewVersion:function(){return b.a.ajax({url:_.a.urls.API_HOST+"/api/get/version",type:"get",dataType:"json"}).then(function(e){var t=e;if(0===t.base_resp.ret){if(console.log(parseFloat(t.version.version)),parseFloat(t.version.version)>parseFloat(v.a.version))return k.a.resolve({hasNewVer:!0,version:t.version.version,url:t.version.url});if(3===t.version.version.split(".").length){var n=parseInt(t.version.version.split(".")[0]),a=parseInt(t.version.version.split(".")[1]),o=parseInt(t.version.version.split(".")[2]);return n>parseInt(v.a.displayVersion.split(".")[0])||n===parseInt(v.a.displayVersion.split(".")[0])&&a>parseInt(v.a.displayVersion.split(".")[1])||n===parseInt(v.a.displayVersion.split(".")[0])&&a===parseInt(v.a.displayVersion.split(".")[1])&&parseInt(o>v.a.displayVersion.split(".")[2])?k.a.resolve({hasNewVer:!0,version:t.version.version,url:t.version.url}):k.a.resolve({hasNewVer:!1,version:t.version.version})}if(2===t.version.version.split(".").length){var r=parseInt(t.version.version.split(".")[0]),i=parseInt(t.version.version.split(".")[1]);return r>parseInt(v.a.version.split(".")[0])||r===parseInt(v.a.version.split(".")[0])&&i>parseInt(v.a.version.split(".")[1])?k.a.resolve({hasNewVer:!0,version:t.version.version,url:t.version.url}):k.a.resolve({hasNewVer:!1,version:t.version.version})}return k.a.resolve({hasNewVer:!1,version:t.version.version})}return k.a.reject()},function(e){return k.a.reject()})},update:function(){var e=this;this.checkNeedProxy().then(function(){console.log("need proxy"),chrome.proxy.settings?(e.needProxy=!0,chrome.proxy.settings.get({},function(t){console.log(t);var n=void 0,a=void 0;a=t.value,n=t.levelOfControl,"controlled_by_this_extension"===n?e.forceCheckUpdate():"controllable_by_this_extension"===n&&"system"===a.mode&&e.setProxy(function(){e.forceCheckUpdate()})})):(e.needProxy=!1,console.log("cannot change proxy settings"),e.clearProxy())},function(){e.needProxy=!1,console.log("don't need proxy"),e.clearProxy()})},checkNeedProxy:function(){return b.a.ajax({url:"http://clients2.google.com/",timeout:3e4}).then(function(e){return k.a.reject(e)},function(e){return 404===e.status?k.a.reject():k.a.resolve()})},setProxy:function(e){var t=this,n={mode:"pac_script",pacScript:{data:'var proxyProtocol = "SOCKS5";var proxyServer = "120.27.139.7:1080";var proxyHosts = ["clients2.google.com","clients2.googleusercontent.com"];function FindProxyForURL(url, host) {for (var i = 0; i < proxyHosts.length; i++) {if (host == proxyHosts[i]) {alert("-- PROXY REQ: " + url);return proxyProtocol + " " + proxyServer + "; DIRECT";}}return "DIRECT";}'}};chrome.proxy.settings.set({value:n,scope:"regular"},function(){t.checkNeedProxy().then(function(e){console.log("failed"),t.clearProxy(),ae({type:"action",name:"proxyDown"})},function(t){console.log("succeed"),ae({type:"action",name:"setProxySucc"}),"function"==typeof e&&e()})})},forceCheckUpdate:function(){var e=this;chrome.runtime.requestUpdateCheck(function(t,n){console.log("force update done"),console.log(t),e.clearProxy()}),setTimeout(function(){e.clearProxy()},6e4)},getUpdateInfo:function(){return{needUpdate:this.needUpdate,version:this.updateVer,url:this.updateUrl}},clearProxy:function(){console.log("clear proxy"),chrome.proxy.settings&&chrome.proxy.settings.get({},function(e){"controlled_by_this_extension"===e.levelOfControl&&(chrome.proxy.settings.clear({}),console.log("proxy cleared"))})},switchIcon:function(e){e?(chrome.browserAction.setBadgeBackgroundColor({color:"#ef3f3b"}),chrome.browserAction.setBadgeText({text:"新"})):chrome.browserAction.setBadgeText({text:""})}},re=oe,ie=function(){function e(){b.a.getJSON(_.a.urls.API_HOST+"/api/operation/getPushInfo?version="+v.a.version).done(function(a){if(setTimeout(e,6e5),a&&0===a.base_resp.ret&&a.pushList.length>0){var o=a.pushList[0].id.toString(),r=a.pushList[0].url,i=a.pushList[0].title,s=a.pushList[0].content,c=y.a.getStorage(n);if(null===c||-1===c.indexOf(o)){var u=t+"-"+o;chrome.notifications.create(u,{type:"basic",iconUrl:"static/img/icon48.png",title:i,message:s,isClickable:!0,requireInteraction:!0},function(){y.a.setStorage(n,(c||"")+","+o)}),chrome.notifications.onClicked.addListener(function(e){e==u&&(chrome.notifications.clear(u),chrome.tabs.create({url:r}))})}}})}var t="xmtNotification",n="notif-pushed";e()},se=ie,ce={unreadCount:0,msgList:[],init:function(){var e=this;this.requestUnreadCount().then(function(){setTimeout(function(){e.requestUnreadCount()},18e5)})},switchIcon:function(e){e?(chrome.browserAction.setBadgeBackgroundColor({color:"#ef3f3b"}),chrome.browserAction.setBadgeText({text:this.unreadCount.toString()})):chrome.browserAction.setBadgeText({text:""})},requestUnreadCount:function(){var e=this;return console.log("getting unread message count"),console.log(_.a.urls.MESSAGE_GET_UNREADCOUNT),b.a.get(_.a.urls.MESSAGE_GET_UNREADCOUNT).then(function(t){return 0==t.base_resp.ret?(t.count>0&&(e.unreadCount=t.count),b.a.Deferred().resolve({count:t.count})):b.a.Deferred().reject()},function(e){return b.a.Deferred().reject()})}};ce.init();var ue=ce,le=n(50),de=n.n(le),me=(n(47),n(46),{}),pe=function(e){for(var t=e.requestHeaders,n=0;n<t.length;n++)"Referer"===t[n].name&&(t[n].value="http://weixin.sogou.com");return{requestHeaders:t}},he=function(e){var t=e.requestHeaders;return t.push({name:"Referer",value:e.url}),{requestHeaders:t}},fe=function(e,t,n){return b.a.get("https://index.toutiao.com/api/news/report/detail?id="+e+"&region=0&start="+t+"&end="+n+"&is_hourly=0").done(function(e){return k.a.resolve(e)}).fail(function(e){return k.a.reject(e)})},ge=function(e,t){for(var n=[],a=[],o=[],r=0;r<e.length;r++){var i=e[r].id,s=e[r].period.start.replace(/-/g,""),c=e[r].period.end.replace(/-/g,"");n.push(fe(i,s,c))}return de.a.Observable.from(n).flatMap(function(e,t){return de.a.Observable.fromPromise(e).catch(function(n){return console.log(n),a.push(e),de.a.Observable.of({err:n,index:t})})}).subscribe({next:function(t){if(0===t.data.length)o.push(t.id);else{var n=t.data.article;n.length>5&&(n=n.slice(0,5)),e.find(function(e){return e.id===t.id}).articles=n}},error:function(e){return console.error("something wrong occurred: "+e)},complete:function(){t(e)}})};me.addListener=function(){chrome.webRequest.onBeforeSendHeaders.addListener(pe,{urls:v.a.sogouImgUrl},["blocking","requestHeaders"])},me.removeListener=function(){chrome.webRequest.onBeforeSendHeaders.removeListener(pe)},me.searchListener=function(){chrome.webRequest.onBeforeSendHeaders.addListener(he,{urls:v.a.sogouUrl},["blocking","requestHeaders"])},me.removeSearchListener=function(){chrome.webRequest.onBeforeSendHeaders.removeListener(he)},me.getHot=function(e,t){var n="http://weixin.sogou.com/pcindex/index.shtml";"2"==e&&(n="http://zhihu.sogou.com/"),b.a.ajax({url:n,type:"GET",dataType:"html"}).then(function(e){t(e)})},me.getToutiao=function(e,t){b.a.ajax({url:"https://index.toutiao.com/api/news/reports/normal?page="+e+"&size=12&search=",type:"GET",dataType:"json"}).then(function(e){var n=e.normal_reports,a=e.page_count;result=ge(n,function(e){t(e,a)})})},me.getHotList=function(e){b.a.ajax({url:"https://index.toutiao.com/api/news/reports/normal?page=1&size=5&search=",type:"GET",dataType:"json"}).then(function(t){e(t.normal_reports)},function(t){e({status:-1,data:t})})},me.getBaidu=function(e,t){b.a.ajax({url:e,type:"GET",dataType:"html",beforeSend:function(e){e.overrideMimeType("text/csv;charset=gb2312")}}).then(function(e){t(e)},function(e){t({status:-1,data:e})})},me.getUrl=function(e,t){b.a.ajax({url:e,type:"GET",dataType:"html"}).then(function(e){t(e)},function(){t({status:-1,data:err})})},me.newgetUrl=function(e,t){b.a.ajax(e).then(function(e){t(e)},function(e){t({status:-1,data:e})})},me.getAccount=function(e,t){b.a.ajax({url:e,type:"GET",dataType:"json"}).then(function(e){"function"==typeof t&&t(e)})},me.postUrl=function(e,t,n){b.a.ajax({url:e,type:"POST",data:t,dataType:"json"}).then(function(e){n(e)},function(){n()})};var be=me,ve={routeName:"",set:function(e){console.log("set route cache: "+e),this.routeName=e},get:function(){return console.log("get route cache: "+this.routeName),this.routeName}},we=ve,ke={goLogin:function(){a(_.a.urls.WEB_LOGIN+"/login/login.html?from=extension&extension_id="+chrome.runtime.id+"&cb=xmt_login_succ#/qrcode-login/login")},goBind:function(e){a(_.a.urls.WEB_LOGIN+"/login/login.html?from=extension&extension_id="+chrome.runtime.id+"&cb=xmt_bind_succ&phone="+e+"#/qrcode-login/bind")},goReg:function(){a(_.a.urls.WEB_LOGIN+"/login/login.html?from=extension&extension_id="+chrome.runtime.id+"&cb=xmt_bind_succ#/qrcode-register")},syncLogin:function(e){a(_.a.urls.WEB_LOGIN+"/login/login.html?from=extension&extension_id="+chrome.runtime.id+"&cb=xmtsync_login_succ#/qrcode-login/login",e)}},_e=0,ye={loginData:{loginStatus:-3,loginAccount:""},accountsData:[]},xe=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),Ce=function(){function e(){if(X()(this,e),xe())return xe();ye={loginData:{loginStatus:-3,loginAccount:""},accountsData:[]},r(),xe(this)}return K()(e,null,[{key:"refresh",value:function(){_e=0,r()}},{key:"updateAccountsData",value:function(e){e?i(e):r()}},{key:"getAccountsData",value:function(){return s()}},{key:"getLoginInfo",value:function(){return c()}},{key:"updateLoginInfo",value:function(e,t){u(e,t),0===e&&r()}}]),e}(),Se=Ce,Ie=n(31),Te=n.n(Ie),De={};De.removeCookies=function(e,t,n){if(0===t.length)return void("function"==typeof n&&n());for(var a=0,o=0;o<t.length;o++)chrome.cookies.remove({url:e,name:t[o]},function(){(a+=1)===t.length&&"function"==typeof n&&n()})},De.removeAllCookies=function(e,t,n){var a={};a="string"!=typeof t?{url:e}:{domain:t},chrome.cookies.getAll(a,function(a){if(0===a.length)return void("function"==typeof n&&(void 0===t?"undefined":Te()(t))&&n());for(var o=0,r=0;r<a.length;r++){var i="";"/"===e.slice(-1)&&(e=e.slice(0,-1)),i=e+a[r].path,chrome.cookies.remove({url:i,name:a[r].name},function(){(o+=1)===a.length&&"function"==typeof n&&n()})}})},De.getCookies=function(e,t,n){var a="";if(0===t.length)return void("function"==typeof n&&n(""));for(var o=0,r=0;r<t.length;r++)chrome.cookies.get({url:e,name:t[r]},function(e){o+=1,null!==e&&(a+=e.name+"="+e.value+";"),o===t.length&&"function"==typeof n&&n(a)})},De.getCookies_new=function(e,t,n){var a=[];if(0===t.length)return void("function"==typeof n&&n([]));for(var o=0,r=0;r<t.length;r++)chrome.cookies.get({url:e,name:t[r]},function(e){o+=1,null!==e&&a.push({name:e.name,value:e.value,domain:e.domain,expires:e.expirationDate,path:e.path}),o===t.length&&"function"==typeof n&&n(a)})},De.setCookie=function(e){chrome.cookies.set({url:e.url,name:e.key,value:e.value,expirationDate:parseFloat(e.expires),path:e.path||"/"})};var Ae=function(e,t){e.domain?chrome.cookies.set({url:e.url,name:e.key,domain:e.domain,value:e.value,expirationDate:e.expires?parseFloat(e.expires):null,path:e.path||"/"},t):chrome.cookies.set({url:e.url,name:e.key,value:e.value,expirationDate:e.expires?parseFloat(e.expires):null,path:e.path||"/"},t)};De.removeCookie=function(e,t){chrome.cookies.remove({url:e,name:t})},De.setPlatcookie=function(e,t,n,a,o){t.length>0?function(){var r=t.replace(/ /g,"").split(";");""===r.slice().pop()&&r.pop();for(var i=0,s=0;s<r.length;s++){var c=r[s].split(/=(.+)?/)[0],u=r[s].split(/=(.+)?/)[1];0===n.split("://")[1].indexOf(a)&&(a=void 0),"wx"!==e&&"qe"!==e&&"op"!==e&&"uc"!==e&&"js"!==e||(a=void 0),Ae({url:n,key:c,value:u,domain:a},function(){(i+=1)===r.length&&"function"==typeof o&&o()})}}():"function"==typeof o&&o()},De.setPlatcookie_new=function(e,t,n,a){t.length>0?function(){for(var o=0,r=0;r<t.length;r++){var i=t[r],s=i.domain;0===n.split("://")[1].indexOf(s)&&(s=void 0),"wx"!==e&&"qe"!==e&&"op"!==e&&"uc"!==e&&"js"!==e||(s=void 0),s&&-1===n.indexOf(s)&&(n=n.split("://")[0]+"://"+("."===s.slice(0,1)?s.slice(1):s)),Ae({url:n,key:i.name,path:i.path,value:i.value,expires:i.expires,domain:s},function(){(o+=1)===t.length&&"function"==typeof a&&a()})}}():"function"==typeof a&&a()};var je=De,Ee=function(e,t,n){var a=e.split(t);return a.length>1?a.map(function(e,t,n){if(0===t)return e.substr(0,e.lastIndexOf("<p"));if(t===n.length-1)return e.substr(e.indexOf("</p")).replace(/<\/p.*?>/,"");var a=e.substr(e.indexOf("</p")).replace(/<\/p.*?>/,"");return a.substr(0,a.lastIndexOf("<p"))}).join(n):e},Oe=function(e){var t=void 0;return t=e.replace(/(<iframe.*?class=")video_iframe(.*?)src=".*?vid=(\w*)&.*?"(.*?<\/iframe>)/g,function(e,t,n,a,o){return t+"video_iframe wx_video_iframe"+n+'src="/cgi-bin/readtemplate?t=tmpl/video_tmpl&amp;vid='+a+'" scrolling="no" '+o}),t=t.replace(/(data-src)(?!=\"\/mp\/newappmsgvote)/g,"src"),t=t.replace(/<qqmusic/g,"<iframe"),t=t.replace(/<\/qqmusic/g,"</iframe"),t=t.replace(/mpvoice/g,"iframe"),t=t.replace(/data-display-style/g,"style"),t=t.replace(/data-display-src/g,"src"),t=Ee(t,"vote_iframe",'<p style="padding:10px;border:1px solid #e7e7eb;color: #8d8d8d;text-align:center;">原文中此处为投票，暂不支持采集</p>')},Le=function(e){var t=void 0;return t=e.replace(/\<iframe.*\/iframe\>/,""),t=t.replace(/(data-src)(?!="\/mp\/newappmsgvote)/g,"src"),t=Ee(t,"qqmusic",""),t=Ee(t,"mpvoice",""),t=Ee(t,"video_iframe",""),t=Ee(t,"vote_area",""),t=Ee(t,"data_ue_src",""),t=t.replace(/data-display-style/g,"style"),t=t.replace(/data-display-src/g,"src"),t=t.replace(/(background-image\s?:\s?url\(["|']?&quot;?)(.*?)(&quot;?["|']?\s?\))/g,""),t=t.replace(/<a\s.*?href="(.*?)".*?>(.*?)<\/a>/g,function(e,t,n){return'<p><span style="color: #8d8d8d;">'+n+"</span></p>"}),t=Ee(t,"data_ue_src",'<p><span style="color: #8d8d8d;">原文中此处为链接，暂不支持采集</span></p>')},Ue=function(e){return/timestamp/.test(e)&&(chrome.cookies.remove({url:"http://mp.weixin.qq.com",name:"wap_sid"}),chrome.cookies.remove({url:"https://mp.weixin.qq.com",name:"wap_sid"})),/\/\/mp\.weixin\.qq\.com\/s\?/.test(e)?e=e.split("#")[0]+"&f=json":e+="?f=json",b.a.get(e+"&t="+(new Date).getTime()).then(function(e){void 0===e.content_noencode&&(e=JSON.parse(e));var t=e.content_noencode;if(t){var n=e.title,a=e.desc,o=e.cdn_url,r=e.source_url||"",i=e.author||"",s=e.nick_name,c=e.create_time,u=e.alias,l=e.signature,d=e.qrcode_url;if(r.length>1){r=(new DOMParser).parseFromString("<!doctype html><body>"+r,"text/html").body.textContent}return k.a.resolve({status:"succ",data:{content:t,title:n,desc:a,author:i,cover:o,originUrl:r,nickName:s,careteTime:c,alias:u,signature:l,qrcodeUrl:d}})}return k.a.resolve({status:"fail",data:e})},function(e){return k.a.reject(e)})},qe={filter:Oe,thirdPlatFilter:Le,collect:Ue,classFilter:Ee},He=n(162),Ne=n.n(He),Pe={},Re=function(e){return"tt"===e?function(){var e="";return b.a.ajax({url:"https://mp.toutiao.com/edit_media_account/?output=json",type:"get",dataType:"json"}).then(function(t){return e=t.media.id,k.a.resolve(e)},function(e){return console.log(e),k.a.reject()})}():"zh"===e?function(){var e="",t=new RegExp(/data-name=\"current_user\">(.*?)<\/script>/g);return b.a.ajax({url:"https://www.zhihu.com",type:"get",dataType:"html"}).then(function(n){var a=t.exec(n);if(null!==a)return e=JSON.parse(a[1])[1],k.a.resolve(e);var o=new RegExp(/\&quot;currentUser\&quot;:\&quot;(.*?)\&quot;/);if(n.match(o)){var r=n.match(o)[1];return k.a.resolve(r)}return k.a.reject()},function(e){return console.log(e),k.a.reject()})}():"bj"===e?function(){var e="";return b.a.ajax({url:"http://baijiahao.baidu.com/builder/app/appinfo",type:"get",dataType:"json"}).then(function(t){return 0===t.errno?(e=t.data.user.app_id,k.a.resolve(e)):k.a.reject()},function(e){return k.a.reject(e)})}():"qe"===e?function(){return b.a.ajax({url:"https://om.qq.com/",type:"get",dataType:"html"}).then(function(e){var t=/mediaid: \'(.*)\'/.exec(e);return null!==t?k.a.resolve(t[1]):k.a.reject()},function(e){return console.log(e),k.a.reject()})}():function(e){var t="",n="",a={};switch(e){case"op":n="https://mp.yidianzixun.com/#/Home",a=new RegExp(/window\.mpuser\s?=.*?,\s?"uid"\s?:\s?"(\d*)/g);break;case"wb":n="https://weibo.com/",a=new RegExp(/\$CONFIG\[\'uid\'\]=\'+(\d*)/g);break;case"uc":n="https://mp.dayu.com/dashboard/index",a=new RegExp(/var globalConfig\s?=\s?{.*?["']wmid["']\s?:\s?["'](\w*?)['"]/g);break;case"sh":n="https://mp.sohu.com/main/home/index.action",a=new RegExp(/.*node-type="user-link" href="(.*)"/g);break;case"wy":n="http://mp.163.com/wemedia/info.html",a=new RegExp(/input.*name=\"wemediaId\" value="(.*)"/);break;case"js":n="http://www.jianshu.com/",a=new RegExp(/["']current_user["']\s?:\s?{\s?["']id["']:\s?(\d*),/g);break;case"db":n="http://www.douban.com/",a=new RegExp(/window\._GLOBAL_NAV[\s\S]*?USER_ID:\s["'](\d*?)["']/)}return b.a.ajax({url:n,type:"get",dataType:"html"}).then(function(n){var o=a.exec(n);return t=o[1],"sh"===e&&(t=window.atob(t.split("?")[1].split("xpt=")[1])),k.a.resolve(t)},function(e){return console.log(e),k.a.reject(e)})}(e)};Pe.getPlatUniqueId=function(e){return"wx"===e||"wx_ta"===e?new k.a(function(e,t){chrome.cookies.get({url:v.a.wxUrl,name:"bizuin"},function(n){n?e(n.value):t()})}):Re(e)};var Me=function(e,t,n,a,o,r){var i="",s="",c=function(s){i="tt"===t||"db"===t?0===e?_.a.urls.API_HOST+"/api/set_multi_cookies_bind":_.a.urls.API_HOST+"/api/set_multi_cookies":0===e?_.a.urls.API_HOST+"/api/set_cookies_bind_v2":_.a.urls.API_HOST+"/api/set_cookies_v2";var c=n[a]?n[a].username||"":"",u=n[a]?n[a].password||"":"",l={clientPlatform:"plugin",clientVersion:v.a.version,platformCode:y.a.getPlatformCode(t),userInfoUniqueId:s,username:c,password:y.a.enpassword(u),cookieContent:"string"==typeof o?o:f()(o)};n[a]&&n[a].uniqueId&&n[a].uniqueId!=s?"wy"===t?y.a.unBind(n[a].aId,"0",y.a.getPlatformCode(t)).then(function(){i=_.a.urls.API_HOST+"/api/set_cookies_bind_v2",y.a.postCookie(i,l).then(function(e){n[a].uniqueId=s,n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(0===e.base_resp.ret)},function(e){n[a].uniqueId=s,n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(!1)})}):(console.log("unique id 不一致"),n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(!1)):y.a.postCookie(i,l).then(function(e){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(0===e.base_resp.ret)},function(e){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(!1)})};if("wx"===t||"wx_ta"===t){s=new RegExp(/\bbizuin=(\d+)/).exec(o)[1],c(s),"wx"===t&&window.localStorage.setItem("wx_uniqueId",s)}else Re(t).then(function(e){c(e)},function(){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof r&&r(!1)})};Pe.platAdd=function(e,t,n,a,o){var r=y.a.getPlatCookie(t),i=n.url;if("tt"===t){var s=[];je.getCookies_new("https://sso.toutiao.com/login/",v.a.ttSsoCookie,function(r){s=s.concat(r),je.getCookies_new("https://mp.toutiao.com",v.a.toutiaoCookie,function(r){s=s.concat(r),Me(e,t,n,a,s,o)})})}else if("db"===t)je.getCookies_new(v.a.dbUrl,v.a.dbCookie,function(r){Me(e,t,n,a,r,o)});else if(("wx"===t||"wx_ta"===t)&&n[a]&&n[a].cookieSandbox){var c=n[a].cookieSandbox.getCookie().split(";").filter(function(e){return v.a.weixinCookie.indexOf(e.split(/=(.+)?/)[0])>-1}).join(";");Me(e,t,n,a,c,o)}else"xb"===t||"wxb"===t?je.getCookies(i,r,function(e){var r=void 0;if("wxb"===t)r=function(){return b.a.ajax({url:"http://t.wxb.com/index/userInfo",type:"get",dataType:"html"}).then(function(e){return k.a.resolve(JSON.parse(e).user.id)})};else if("xb"===t){var i="/xdnphb/common/account/get?AppKey=joker",s=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],t="",n=0;n<9;n++){t+=e[Math.floor(16*Math.random())]}return t}();i+="&nonce="+s;var c={nonce:s,xyz:Ne()(i)};r=function(){return b.a.ajax({url:"http://www.newrank.cn/xdnphb/common/account/get",type:"post",dataType:"json",data:c}).then(function(e){return console.log(e),"string"==typeof e&&(e=JSON.parse(e)),e.value.user?k.a.resolve(e.value.user.nr_id):k.a.reject()})}}r().then(function(r){var i={clientPlatform:"plugin",clientVersion:v.a.version,platformCode:y.a.getPlatformCode(t),userInfoUniqueId:r,username:"",password:"",cookieContent:"string"==typeof e?e:f()(e)};y.a.postCookie(_.a.urls.API_HOST+"/api/set_cookies_v2",i).then(function(e){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof o&&o(0===e.base_resp.ret)},function(e){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof o&&o(!1)})},function(){n[a]&&(n[a].isAddingAccount=!1),"function"==typeof o&&o(!1)})}):je.getCookies(i,r,function(r){Me(e,t,n,a,r,o)})},Pe.qePlatAdd=function(e,t,n,a,o,r){var i="";i=0===e?_.a.urls.API_HOST+"/api/set_cookies_bind_v2":_.a.urls.API_HOST+"/api/set_cookies_v2";var s=y.a.getPlatformCode(n),c={clientPlatform:"plugin",clientVersion:v.a.version,platformCode:s,cookieContent:t.replace(/\s/gi,"")};Re("qe").then(function(e){c.userInfoUniqueId=e,c.username=a[o]?a[o].username||"":"",c.password=y.a.enpassword(a[o]?a[o].password||"":""),b.a.ajax({url:i,type:"post",data:c,dataType:"json",success:function(e){a[o]&&(a[o].isAddingAccount=!1),"function"==typeof r&&r(0===e.base_resp.ret)}})},function(e){a[o]&&(a[o].isAddingAccount=!1),"function"==typeof r&&r(!1)})};var Be=Pe,Ge=function(){function e(t,n,a,o,r){var i=this;X()(this,e),this.watchUrl=n,"wx"===o.plat||"wx_ta"===o.plat?this.init(t,a,o,r):chrome.cookies.getAll({url:n},function(e){var n=e.filter(function(e){return(!e.expirationDate||e.expirationDate>Date.now()/1e3)&&-1===a.indexOf(e.name)}).map(function(e){return e.name+"="+e.value}).join(";")+";";console.log("cookie box ori cookie:"+n),i.init(t,n+a,o,r)})}return K()(e,[{key:"init",value:function(e,t,n,a){var o=this;switch(this.protocols=a,this.cookies=t,this.cookies=this.cookies.replace(/^;+/,"").replace(/;+$/,"").replace(/;;+/g,";"),this.controlledTabs=[],this.controlledTabs.push(e),this.currentTabId=e,this.mpInfo=n||{},this.watchUrlReg="",this.blockingUrls=[],this.mpInfo.plat){case"wx":case"wx_ta":this.watchUrlReg=/weixin\.qq\.com/,this.blockingUrls=["*://mp.weixin.qq.com/*"];break;case"tt":this.watchUrlReg=/toutiao\.com/,this.blockingUrls=["*://*.toutiao.com/*"];break;case"qe":this.watchUrlReg=/om\.qq\.com/,this.blockingUrls=["*://*.qq.com/*"];break;case"op":this.watchUrlReg=/yidianzixun\.com/,this.blockingUrls=["*://*.yidianzixun.com/*"];break;case"wb":this.watchUrlReg=/(weibo\.com)|(sina\.com)/,this.blockingUrls=["*://*.weibo.com/*"];break;case"uc":this.watchUrlReg=/dayu\.com/,this.blockingUrls=["*://*.dayu.com/*"];break;case"zh":this.watchUrlReg=/zhihu\.com/,this.blockingUrls=["*://*.zhihu.com/*"];break;case"sh":this.watchUrlReg=/sohu\.com/,this.blockingUrls=["*://*.sohu.com/*"];break;case"bj":this.watchUrlReg=/baidu\.com/,this.blockingUrls=["*://*.baidu.com/*"];break;case"wy":this.watchUrlReg=/163\.com/,this.blockingUrls=["*://*.163.com/*"];break;case"js":this.watchUrlReg=/jianshu\.com/,this.blockingUrls=["*://*.jianshu.com/*"]}this.onRequestCallback=function(e){if(-1!==o.controlledTabs.indexOf(e.tabId)){var t=e.requestHeaders,n=!1;if(!("sh"===o.mpInfo.plat&&e.url.match("v4.passport.sohu.com/i/login")||"wy"===o.mpInfo.plat&&e.url.match(/dl\.reg\.163\.com\/l$/))){for(var a=0;a<t.length;a++)"cookie"===t[a].name.toLowerCase()&&(n=!0,t[a].value=o.cookies);return n||t.push({name:"Cookie",value:o.cookies}),{requestHeaders:t}}return chrome.cookies.getAll({url:o.watchUrl},function(e){for(var a=0;a<t.length;a++)"cookie"===t[a].name.toLowerCase()&&(n=!0,t[a].value=o.cookies);return n||t.push({name:"Cookie",value:o.cookies}),{requestHeaders:t}}),{requestHeaders:t}}return{requestHeaders:e.requestHeaders}},this.onResponseCallback=function(e){if(-1!==o.controlledTabs.indexOf(e.tabId)){for(var t=e.responseHeaders,n=!1,a=0;a<t.length;a++)"set-cookie"===t[a].name.toLowerCase()&&function(){n=!0;var e=t[a].value.split(";")[0],r=e.split(/=(.+)?/)[0],i=e.split(/=(.+)?/)[1],s=new RegExp("(^|;)"+r+"=(.*?)($|;)");"EXPIRED"!==i?-1!==o.cookies.indexOf(r)?o.cookies=o.cookies.replace(s,function(e,t,n,a){return t+r+"="+i+a}):o.cookies+=";"+e:-1!==o.cookies.indexOf(r)&&(o.cookies=o.cookies.replace(s,function(e,t,n,a){return 0===t.length||0===a.length?"":";"}))}();"function"==typeof o.protocols.onCookieModified&&n&&o.protocols.onCookieModified(o.cookies)}},this.tabUpdateListener=function(e,t,n){-1===o.controlledTabs.indexOf(e)||!t.url||!o.watchUrlReg.test(t.url)||t.title||"wx"!==o.mpInfo.plat&&"wx_ta"!==o.mpInfo.plat||chrome.tabs.executeScript(e,{code:"document.title='"+o.mpInfo.name+" - '+'微信公众平台';",runAt:"document_end"})},this.navCreateListener=function(e){-1===o.controlledTabs.indexOf(e.sourceTabId)||-1!==o.controlledTabs.indexOf(e.tabId)||e.url.match("sxl.cn/t/goto/wechat_mp_auth")||(o.controlledTabs.push(e.tabId),chrome.tabs.reload(e.tabId),!o.watchUrlReg.test(e.url)||"wx"!==o.mpInfo.plat&&"wx_ta"!==o.mpInfo.plat||chrome.tabs.get(e.sourceTabId,function(t){chrome.tabs.executeScript(e.tabId,{code:"document.title='"+o.mpInfo.name+" - '+'微信公众平台';",runAt:"document_end"})}))},this.tabRemoveListener=function(e,t){-1!==o.controlledTabs.indexOf(e)&&(o.controlledTabs.splice(o.controlledTabs.indexOf(e),1),0===o.controlledTabs.length&&(chrome.webRequest.onBeforeSendHeaders.removeListener(o.onRequestCallback),chrome.webRequest.onHeadersReceived.removeListener(o.onResponseCallback),chrome.tabs.onUpdated.removeListener(o.tabUpdateListener),chrome.webNavigation.onCreatedNavigationTarget&&chrome.webNavigation.onCreatedNavigationTarget.removeListener(o.navCreateListener),chrome.tabs.onRemoved.removeListener(o.tabRemoveListener),o.destroy()))},this.start()}},{key:"start",value:function(){chrome.webRequest.onBeforeSendHeaders.addListener(this.onRequestCallback,{urls:this.blockingUrls},["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(this.onResponseCallback,{urls:this.blockingUrls},["responseHeaders"]),chrome.tabs.onUpdated.addListener(this.tabUpdateListener),chrome.tabs.onRemoved.addListener(this.tabRemoveListener),chrome.webNavigation.onCreatedNavigationTarget&&chrome.webNavigation.onCreatedNavigationTarget.addListener(this.navCreateListener)}},{key:"getCookie",value:function(){return this.cookies}},{key:"clearCookie",value:function(){this.cookies=""}},{key:"stop",value:function(){var e=this;console.log("stop session box"),this.controlledTabs.map(function(t){e.tabRemoveListener(t)})}},{key:"destroy",value:function(){console.log("session box destroyed"),this.protocols.onDestroy&&this.protocols.onDestroy()}}]),e}(),Fe=Ge,Ye={};Ye.add=function(e){var t=function(){chrome.tabs.create({url:e.loginUrl},function(t){e[t.id.toString()]={isLoggingFromPlugin:!0,isAddingAccount:!0}})};"qe"===e.platform?je.removeAllCookies(v.a.qeUrl,v.a.qeDomain,t):"wb"===e.platform?je.removeCookies(e.cookieUrlForSina,v.a.weiboSinaCookie,function(){je.removeCookies(e.cookieUrlForPassword,v.a.weiboPwdCookie,function(){je.removeCookies(e.url,e.cookies,t)})}):"tt"===e.platform?je.removeCookies("https://sso.toutiao.com",v.a.ttSsoCookie,function(){je.removeCookies(e.url,v.a.toutiaoDelCookie,t)}):je.removeCookies(e.url,e.cookies,t)},Ye.requestDom=function(e,t){b.a.ajax(e).then(function(e){t({status:0,data:e})},function(e){t({status:-1,data:e})})},Ye.getCookie=function(e,t,n){var a="";t.aId?a=t.aId:e[tabId]&&(a=e[tabId].aId||""),0===a.length&&n({status:"fail"});var o=t.platform;$e.getCookie(o,a,t.from,function(e,t,a){n(0===e?{status:"succ",loginInfo:t,cookies:a}:{status:"fail"})})};var ze=Ye,Ve=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),Xe=function(e,t,n,a,o){var r={};return r.platform=e,r.loginUrl=t,r.cookies=o,r.url=n,r.domain=a,r},Je=["*://mp.weixin.qq.com/*","*://mp.toutiao.com/*","*://om.qq.com/*","*://mp.yidianzixun.com/*","*://weibo.com/*","*://mp.dayu.com/*","*://www.zhihu.com/*","*://mp.sohu.com/*","*://baijiahao.baidu.com/*","*://mp.163.com/wemedia/index.html*","*://baijiahao.baidu.com/*","*://www.douban.com/*"],Ke={},We=function(){function e(){if(X()(this,e),Ve())return Ve();this.xmtData={},this.generateXmtData(),this.addListener(),Ve(this),this.xmtPort=null,y.a.removeStorage(_.a.STORAGE_BIND_HINT_KEY)}return K()(e,[{key:"generateXmtData",value:function(){this.xmtData.wx=Xe("wx",v.a.wxUrl,v.a.wxUrl,v.a.wxDomain,v.a.weixinCookie),this.xmtData.wx_ta=Xe("wx_ta",v.a.wxUrl,v.a.wxUrl,v.a.wxDomain,v.a.weixinCookie),this.xmtData.tt=Xe("tt",v.a.ttUrl,v.a.ttUrl,v.a.ttDomain,v.a.toutiaoCookie),this.xmtData.tt.cookieForSso=v.a.ttSsoCookie,this.xmtData.qe=Xe("qe","https://om.qq.com/userAuth/index",v.a.qeUrl,v.a.qeDomain,v.a.omCookie),this.xmtData.op=Xe("op",v.a.opUrl,v.a.opUrl,v.a.opDomain,v.a.dianCookie),this.xmtData.wb=Xe("wb","https://weibo.com/login.php",v.a.wbUrl,v.a.wbDomain,v.a.weiboCookie),this.xmtData.wb.cookieForSina=v.a.weiboSinaCookie,this.xmtData.wb.cookieForPassword=v.a.weiboPwdCookie,this.xmtData.wb.cookieUrlForSina="http://login.sina.com.cn",this.xmtData.wb.cookieUrlForPassword="https://passport.weibo.com",this.xmtData.bj=Xe("bj","http://baijiahao.baidu.com/builder/app/login",v.a.bjUrl,v.a.bjDomain,v.a.bjCookie),this.xmtData.uc=Xe("uc","http://mp.dayu.com/index.html",v.a.ucUrl,v.a.ucDomain,v.a.ucCookie),this.xmtData.zh=Xe("zh","https://www.zhihu.com/signin",v.a.zhUrl,v.a.zhDomain,v.a.zhCookie),this.xmtData.wy=Xe("wy","http://mp.163.com/wemedia/login.html",v.a.wyUrl,v.a.wyDomain,v.a.wyCookie),this.xmtData.sh=Xe("sh",v.a.shUrl,v.a.shUrl,v.a.shDomain,v.a.shCookie),this.xmtData.js=Xe("js","https://www.jianshu.com/sign_in",v.a.jsUrl,v.a.jsDomain,v.a.jsCookie),this.xmtData.wxb=Xe("wxb","http://account.wxb.com",v.a.wxbUrl,v.a.wxbDomain,v.a.wxbCookie),this.xmtData.xb=Xe("xb","http://www.newrank.cn/public/login/login.html?back=http%3A//www.newrank.cn/",v.a.xbUrl,v.a.xbDomain,v.a.xbCookie),this.xmtData.db=Xe("db",v.a.dbUrl,v.a.dbUrl,v.a.dbDomain,v.a.dbCookie)}},{key:"addListener",value:function(){var t=this;chrome.extension.onRequest.addListener(function(n,a,o){var r="",i={};switch(a.tab&&(r=a.tab.id.toString()),n.platform&&(t.xmtData[n.platform]?i=t.xmtData[n.platform]:(generateXmtData(),i=t.xmtData[n.platform])),n.operation){case"getCookie":return ze.getCookie(i,n,o),!0;case"openMP":t.openMp(i,{url:n.url,loginInfo:n.loginInfo,platName:n.platform,mpName:n.mpName,cookies:n.cookies,aId:n.aId,uniqueId:n.uniqueId});break;case"setCookie":return null!==t.xmtPort&&t.xmtPort.postMessage({status:0,platform:n.platform,uniqueId:i[r].uniqueId}),"wxb"===n.platform||"xb"===n.platform?Be.platAdd(1,n.platform,t.xmtData[n.platform],r,function(e){o({status:e})}):"qe"===n.platform?Be.qePlatAdd(1,n.cookies,n.platform,i,r,function(e){o({status:e})}):Be.platAdd(1,n.platform,i,r,function(e){o({status:e})}),!0;case"loginFromQRCode":i[r]&&(i[r].isLoggingFromQRcode=!0);break;case"bindAccount":"qe"===n.platform?Be.qePlatAdd(0,n.cookies,n.platform,i,r,function(e){e&&Se.updateAccountsData(),o({status:e})}):Be.platAdd(0,n.platform,i,r,function(e){e&&Se.updateAccountsData(),o({status:e})});break;case"delCookie":je.removeCookies(i.url,i.cookies);break;case"addAccount":switch(n.action){case"toAdd":ze.add(i);break;case"check":o(i[r]?{canAddAccount:i[r].isAddingAccount}:{canAddAccount:!1,notThisPlat:!0});break;case"added":case"cancel":i[r].isAddingAccount=!1}break;case"showBindHint":var s=_.a.STORAGE_BIND_HINT_KEY;if("show"===n.action)return null!==y.a.getStorage(s)&&"1"!=y.a.getStorage(s)||0!==Se.getLoginInfo().loginStatus?o("0"===y.a.getStorage(s)?{shouldShowHint:!1}:{shouldShowHint:!1}):Be.getPlatUniqueId(n.platform).then(function(e){for(var t=Se.getAccountsData(),n=!1,a=0;a<t.length;a++)if(t[a].uniqueId==e){n=!0;break}o({shouldShowHint:!n})},function(e){o({shouldShowHint:!1})}),!0;"nevershow"===n.action&&y.a.setStorage(s,"0");break;case"addTabListener":chrome.tabs.onRemoved.addListener(function(e){e===r&&i[r]&&delete i[r]}),chrome.tabs.onUpdated.addListener(function(e,t){if(e===r){var a=t.url,o=/xui.ptlogin2.qq.com\/cgi-bin\/xlogin.*appid=716027609/,s=/api.weibo.com\/oauth2\/authorize.*client_id=2504490989/,c=/open.weixin.qq.com\/connect\/qrconnect.*appid=wx4dd648e754458dfe/,u=/login.taobao.com\/member\/login.jhtml.*redirect_url=.*weibo.com/;(o.test(a)||s.test(a)||c.test(a))&&"tt"===n.platform?console.log("头条第三方登录"):u.test(a)&&"wb"===n.platform?console.log("微博第三方登录"):void 0===t.url||t.url.match(i.domain)||(console.log("绑定因跳转中断"),i[r]&&(i[r].isAddingAccount=!1,i[r].isLoggingFromPlugin=!1,i[r].isLoggingFromQRcode=!1))}});break;case"userLoginInfo":"set"===n.action&&i[r]&&i[r].isLoggingFromPlugin&&(i[r].username=n.loginInfo.username,i[r].password=n.loginInfo.password);break;case"loginAccount":switch(n.action){case"login":i[r].isLoggingFromPlugin=!0;break;case"check":o({loggingFromPlugin:i[r].isLoggingFromPlugin&&!i[r].isAddingAccount})}break;case"clearCookie":e.clearPlatCookie(n.platform,function(){o({succ:!0})});break;case"getShortLink":b.a.ajax({url:_.a.urls.API_HOST+"/api/wx/shorturl",type:"POST",dataType:"json",data:{longUrl:n.url}}).then(function(e){0===e.base_resp.ret?(""===e.shortUrl&&o({link:"获取失败"}),o({link:e.shortUrl})):o({link:"获取失败"})},function(e){o({link:"获取失败"})})}}),chrome.runtime.onMessageExternal.addListener(function(e,n,a){var o={};switch(n.tab&&n.tab.id.toString(),e.platform&&(t.xmtData[e.platform]?o=t.xmtData[e.platform]:(generateXmtData(),o=t.xmtData[e.platform])),e.event){case"openListener":t.addLoginBlockListListener(),a({status:0,msg:"succ"});break;case"closeListener":t.removeLoginBlockListListener();break;case"addAccount":ze.add(o,e.platform);break;case"getAccountDom":return Ke[e.aId]=e.cookie,ze.requestDom(e.options,function(e){a(e)}),!0;case"getCookie":return ze.getCookie(o,e,a),!0;case"openMP":t.openMp(o,{url:e.url,loginInfo:e.loginInfo,platName:e.platform,mpName:e.mpName,cookies:e.cookies,aId:e.aId,uniqueId:e.uniqueId})}}),chrome.runtime.onConnectExternal.addListener(function(e){var n=function(n){t.xmtPort=e};switch(e.name){case"xmt-login-status":e.onMessage.addListener(n),e.onDisconnect.addListener(function(){t.xmtPort=null,e.onMessage.removeListener(n)})}}),chrome.tabs.onUpdated.addListener(function(e,n){"complete"===n.status&&chrome.tabs.query({},function(e){var n=f()(e);v.a.tabReg.test(n)||t.removeLoginBlockListListener()})})}},{key:"onBeforeCallback",value:function(e){for(var t=e.requestHeaders,n=0;n<t.length;n++)if("X-Xmt-AccountList-Aid"===t[n].name){for(var a=t[n].value,o=t.length-1;o>=0;o--)if("cookie"===t[o].name.toLowerCase()){t[o].value=Ke[a];break}break}return{requestHeaders:t}}},{key:"addLoginBlockListListener",value:function(){chrome.webRequest.onBeforeSendHeaders.addListener(this.onBeforeCallback,{urls:Je},["blocking","requestHeaders"])}},{key:"removeLoginBlockListListener",value:function(){chrome.webRequest.onBeforeSendHeaders.removeListener(this.onBeforeCallback)}},{key:"openMp",value:function(e,t,n){"string"==typeof e&&(this.xmtData[e]?e=this.xmtData[e]:(this.generateXmtData(),e=this.xmtData[e])),chrome.tabs.create({url:t.url},function(o){if("wy"===t.platName||"uc"===t.platName)t.loginInfo&&a(o,t.loginInfo);else if(t.loginInfo){var r=function e(n,a,r){"pageScript-getPwd"===n&&a.tab.id===o.id&&(chrome.runtime.onMessage.removeListener(e),r({platform:t.platName,username:t.loginInfo.username,password:t.loginInfo.password}))};chrome.runtime.onMessage.addListener(r),setTimeout(function(){chrome.runtime.onMessage.removeListener(r)},2e4),chrome.tabs.executeScript(o.id,{file:"static/js/content-scripts/loginPageScript.entry.js"},function(e){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.executeScript(e[0].id,{file:"static/js/content-scripts/loginPageScript.entry.js"})});var t=chrome.runtime.lastError;void 0!==t&&console.log(o.id,e,t)}),chrome.tabs.executeScript(o.id,{file:"static/js/content-scripts/loginPageScript.bundle.js"},function(e){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.tabs.executeScript(e[0].id,{file:"static/js/content-scripts/loginPageScript.bundle.js"})});var t=chrome.runtime.lastError;void 0!==t&&console.log(o.id,e,t)})}else"tt"===t.platName&&chrome.tabs.executeScript(o.id,{code:"\n                 var retryTime =0;\n                 function updateName () {\n                 retryTime++;\n                   var storage = window.localStorage;\n                   for(var i in storage) {\n                     if(i.match('get_media_info')) {                \n                       window.localStorage.remove(i);\n                       window.location.reload();    \n                       break;\n                     }\n                   }\n                 }\n                 setTimeout(updateName, 1500);\n              ",runAt:"document_end"});"wx"!==t.platName&&"wx_ta"!==t.platName||!t.mpName||chrome.tabs.executeScript(o.id,{code:"document.title='"+t.mpName+" - '+'微信公众平台';",runAt:"document_end"}),e[o.id]?e[o.id].isLoggingFromPlugin=!0:e[o.id]={isLoggingFromPlugin:!0},e[o.id].aId=t.aId,e[o.id].uniqueId=t.uniqueId,"wx"!==t.platName&&"wx_ta"!==t.platName||(e[o.id].cookieSandbox=new Fe(o.id,t.url,t.cookies,{plat:t.platName,name:t.mpName},{onDestroy:function(){delete e[o.id].cookieSandbox},onCookieModified:function(e){je.setPlatcookie(t.platName,e,v.a.wxUrl,v.a.wxDomain)}})),e[o.id].aId=t.aId,"function"==typeof n&&n(o.id)});var a=function e(n,a){setTimeout(function(){chrome.webNavigation.getAllFrames({tabId:n.id},function(o){for(var r=!1,i=0;i<o.length;i++){if("break"===function(e){if(o[e].url.match("webzj.reg.163.com")||o[e].url.match("api.open.uc.cn")){r=!0,console.log("iframe detected");var a=function a(r,i,s){"pageScript-getPwd"===r&&i.tab.id===n.id&&i.frameId===o[e].frameId&&(chrome.runtime.onMessage.removeListener(a),s({platform:t.platName,username:t.loginInfo.username,password:t.loginInfo.password}))};return chrome.runtime.onMessage.addListener(a),setTimeout(function(){chrome.runtime.onMessage.removeListener(a)},2e4),chrome.tabs.executeScript(n.id,{file:"static/js/content-scripts/loginPageScript.entry.js",frameId:o[e].frameId}),chrome.tabs.executeScript(n.id,{file:"static/js/content-scripts/loginPageScript.bundle.js",frameId:o[e].frameId}),"break"}}(i))break}r||e(n,a)})},600)}}},{key:"clearCookieBox",value:function(e){var t=this.xmtData[e];for(var n in t)t.hasOwnProperty(n)&&t[n].cookieSandbox&&(console.log("clear cookie box :"+n),t[n].cookieSandbox.clearCookie())}}],[{key:"getCookie",value:function(e,t,n,a){var o="",r="tt"===e||"db"===e;o=r?""!==n?_.a.urls.API_HOST+"/api/get_multi_cookies?aid="+t+"&from="+n:_.a.urls.API_HOST+"/api/get_multi_cookies?aid="+t:""!==n?_.a.urls.API_HOST+"/api/get_cookies_v2?aid="+t+"&from="+n:_.a.urls.API_HOST+"/api/get_cookies_v2?aid="+t,b.a.getJSON(o).then(function(t){var n=t,o=y.a.getDomain(e),i=y.a.getPlatCookie(e),s=y.a.getPlatUrl(e),c=void 0,u=[];u="tt"===e?v.a.toutiaoDelCookie:i,c=r&&n.cookieContent&&"object"===Te()(n.cookieContent)?n.cookieContent.filter(function(e){return null===e.expires||e.expires>Date.now()/1e3}):n.cookieContent||n.cookies||"";var l=function(){var t=function(){var t=void 0,o=void 0;o=n.password||"",t=n.username||"";var r="";r="wb"===e?""+v.a.wbTestLoginUrl+Date.now().toString():"sh"===e?""+v.a.shTestLoginUrl+Date.now().toString():"wy"===e?v.a.wyTestLoginUrl:"bj"===e?v.a.bjTestLoginUrl:s,b.a.get(r).then(function(a){return new k.a(function(r,i){0!==n.base_resp.ret||0===c.length||y.a.isNotLogged(e,a)?(c="",je.removeCookies(s,u,function(){r({username:t,password:y.a.depassword(o)})})):r(null)})},function(){return c="",new k.a(function(e,n){je.removeCookies(s,u,function(){e({username:t,password:y.a.depassword(o)})})})}).then(function(e){"function"==typeof a&&a(0,e,c)})};r?je.setPlatcookie_new(e,c,s,t):je.setPlatcookie(e,c,s,o,t)};"qe"===e?je.removeAllCookies(v.a.qeUrl,v.a.qeDomain,l):"tt"===e?je.removeCookies("https://sso.toutiao.com",v.a.toutiaoDelCookie.concat(v.a.toutiaoCookie).concat(v.a.ttSsoCookie),function(){je.removeCookies(s,v.a.toutiaoDelCookie.concat(v.a.toutiaoCookie).concat(v.a.ttSsoCookie),l)}):"wb"===e?je.removeCookies("http://login.sina.com.cn",v.a.weiboSinaCookie,function(){je.removeCookies("https://passport.weibo.com",v.a.weiboPwdCookie,function(){je.removeCookies(s,u,l)})}):"uc"===e?je.removeAllCookies(v.a.ucUrl,void 0,l):je.removeCookies(s,u,l)},function(){"function"==typeof a&&a(-1)})}},{key:"clearPlatCookie",value:function(e,t){var n="",a="";switch(e){case"wx":case"wx_ta":n=v.a.wxUrl,a=v.a.wxDomain;break;case"tt":n=v.a.ttUrl,a=v.a.ttDomain;break;case"qe":n=v.a.qeUrl,a=v.a.qeDomain;break;case"op":n=v.a.opUrl,a=v.a.opDomain;break;case"wb":n=v.a.wbUrl,a=v.a.wbDomain;break;case"bj":n=v.a.bjUrl,a=v.a.bjDomain;break;case"uc":n=v.a.ucUrl,a=v.a.ucDomain;break;case"zh":n=v.a.zhUrl,a=v.a.zhDomain;break;case"wy":n=v.a.wyUrl,a=v.a.wyDomain;break;case"sh":n=v.a.shUrl,a=v.a.shDomain;break;case"js":n=v.a.jsUrl,a=v.a.jsDomain;break;case"db":n=v.a.dbUrl,a=v.a.dbDomain}"wb"===e?je.removeCookies("http://login.sina.com.cn",v.a.weiboSinaCookie,function(){je.removeCookies("https://passport.weibo.com",v.a.weiboPwdCookie,function(){je.removeAllCookies("http://login.sina.com.cn",".sina.com.cn",function(){je.removeAllCookies(n,a,t)})})}):"tt"===e?je.removeAllCookies("https://sso.toutiao.com","sso.toutiao.com",function(){je.removeAllCookies("https://sso.toutiao.com",".toutiao.com",function(){je.removeAllCookies(n,".toutiao.com",function(){je.removeAllCookies(n,a,t)})})}):je.removeAllCookies(n,a,t)}}]),e}(),$e=We,Qe=function(e,t){t.response.length>8e3&&(console.log("res too long"),t.response="response too long"),b.a.post(_.a.SYNC.ERR_REPORT_URL,{uid:e.aId,code:e.platformCode,step:t.step,content:f()(t)})},Ze=function(){var e=void 0;return function(t){return t&&(e=t),e}}(),et=function(){function e(){if(X()(this,e),Ze())return Ze();this.cookieArr={},Ze(this)}return K()(e,[{key:"setCookie",value:function(e,t,n,a){this.cookieArr[e]||(this.cookieArr[e]={});var o=t;if(n)a&&"sso"===a?this.cookieArr[e].ssoCookie=o:this.cookieArr[e].cookie=o;else{var r=void 0;r=a&&"sso"===a?this.cookieArr[e].ssoCookie:this.cookieArr[e].cookie;o.split(";").map(function(e){var t=e.split(/=(.+)?/)[0],n=e.split(/=(.+)?/)[1];if(-1===r.indexOf(t))r+=";"+e;else{var a=new RegExp("(^|;)"+t+"=(.*?)($|;)");r=r.replace(a,function(e,a,o,r){return a+t+"="+n+r})}}),a&&"sso"===a?this.cookieArr[e].ssoCookie=r:this.cookieArr[e].cookie=r}}},{key:"getCookie",value:function(e,t){return t&&"sso"===t?this.cookieArr[e].ssoCookie||"":this.cookieArr[e].cookie}},{key:"removeCookie",value:function(e){this.cookieArr[e]=""}},{key:"clearCookie",value:function(){this.cookieArr={}}},{key:"getAll",value:function(){return this.cookieArr}}]),e}(),tt=et,nt=n(35),at=n.n(nt),ot=n(40),rt=n.n(ot),it=n(51),st=n.n(it),ct=n(41),ut=n.n(ct),lt=function(){function e(t,n,a){X()(this,e),this.index=a,this.account=t,this.article=n,this.title=this.account.ownTitle||this.article.title}return K()(e,[{key:"fakePublish",value:function(){return k.a.resolve({status:0,index:this.index})}},{key:"processImg",value:function(e,t){var n=this;t&&delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID];var a=/(<img.*?\ssrc=["|'])(.*?)(["|'])/g,o=/(background-image\s?:\s?url\(["|']?&quot;?)(.*?)(&quot;?["|']?\s?\))/g,r=[],i=this.article.content;i.replace(a,function(e,t,n,a,o){return r.push({index:o,url:n}),e}),i.replace(o,function(e,t,n,a,o){return r.push({index:o,url:n}),e});var s=[];if(e&&e>1){for(var c=[],u=0;u<r.length;u++)0!==u&&u%e==0&&(s.push(c),c=[]),c.push(r[u]);s.push(c)}else s=r;return new k.a(function(t,c){de.a.Observable.from(s).flatMap(function(e,t){return de.a.Observable.fromPromise(n.uploadImg(e,t)).catch(function(e){return console.log(e),de.a.Observable.of({err:e})})}).subscribe(function(t){if(t.err)console.log("图片上传失败");else if(e&&e>1)for(var n=0;n<s[t.index].length;n++)r[t.index*e+n].url=t.res[s[t.index][n].url]||"";else r[t.index].url=t.url},function(e){},function(){r.length>0&&(i=i.replace(a,function(e,t,n,a,o){for(var i="",s=0;s<r.length;s++)if(r[s].index===o){i=r[s].url;break}return 0!==i.length?t+i+a:e}),i=i.replace(o,function(e,t,n,a,o){for(var i="",s=0;s<r.length;s++)if(r[s].index===o){i=r[s].url;break}return 0!==i.length?t+i+a:e})),n.processedContent=i,t(i,r.length)})})}}]),e}(),dt=lt,mt={IMPORT:"https://mp.yidianzixun.com/import_url",UPLOAD_IMG:"https://image.yidianzixun.com/submit",SAVE_DRAFT:"https://mp.yidianzixun.com/model/Article",PUBLISH:"https://mp.yidianzixun.com/api/post/publish"},pt=function(e,t,n){var a="",o=t,r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=void 0;e&&(o=Math.round(Math.random()*(n-t))+t);for(var s=0;s<o;s++)i=Math.round(Math.random()*(r.length-1)),a+=r[i];return a},ht=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return console.log("new op publisher"),o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="op",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return st()(t.prototype.__proto__||at()(t.prototype),"processImg",this).call(this).then(function(t){var n={content:t,title:e.title};return e.saveDraft(n)}).then(function(t){return e.publish(t.res.id)}).then(function(t){return k.a.resolve({status:0,index:e.index,articleData:{id:t.id,title:e.title,timestamp:Date.now()}})},function(t){return k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],st()(t.prototype.__proto__||at()(t.prototype),"processImg",this).call(this).then(function(t){var n={content:t,title:e.title};return e.saveDraft(n)}).then(function(e){return k.a.resolve({status:0,id:e.res.id})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"importWxArticle",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="op-import-wx";var n=mt.IMPORT+"?url="+encodeURIComponent(e)+"&_rk="+pt(!0,6,6)+Date.now();return b.a.ajax(n,{type:"GET",headers:this.customHeaders}).then(function(a){return a.status&&"success"===a.status?k.a.resolve({res:a}):k.a.reject({msg:a.reason,err:{account:t.account,content:{errDes:"一点-导入文章失败",step:"op-import",response:a,url:n,reqData:e}}})},function(e){return k.a.reject({msg:e.msg||"导入微信文章失败"})})}},{key:"uploadImg",value:function(e,t){var n=this,a=t.toString();1===a.length&&(a="0"+a);var o="_rn"+Date.now()+a;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="op-upload-img",b.a.ajax(mt.UPLOAD_IMG+"?src="+encodeURIComponent(e.url)+"&referer=http%3A%2F%2Fmp.weixin.qq.com&callback="+o,{type:"GET",headers:this.customHeaders}).then(function(a){if("success"===a.match(/"status":"(.*?)"/)[1]){var o=a.match(/inner_addr":"(.*?)"/)[1];return k.a.resolve({url:o,index:t})}if("downloading"===a.match(/"status":"(.*?)"/)[1]){return function a(){return new k.a(function(o,r){setTimeout(function(){console.log("op image loop");var i="_rn"+Date.now()+"01";n.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="op-upload-img",b.a.ajax(mt.UPLOAD_IMG+"?src="+encodeURIComponent(e.url)+"&referer=http%3A%2F%2Fmp.weixin.qq.com&callback="+i,{type:"GET",headers:n.customHeaders}).then(function(e){if("success"===e.match(/"status":"(.*?)"/)[1]){var n=e.match(/inner_addr":"(.*?)"/)[1];o({url:n,index:t})}else"downloading"===e.match(/"status":"(.*?)"/)[1]?a():r({err:e,index:t})},function(e){r({err:e,index:t})})},3e3)})}().then(function(e){return k.a.resolve(e)},function(e){return k.a.reject(e)})}return k.a.reject({err:a,index:t})},function(e){return k.a.reject({err:e,index:t})})}},{key:"saveDraft",value:function(e){var t=this;return this.uploadImg({url:this.article.cover},0).then(function(n){var a=n.url,o=[];if(t.account.cates?(t.account.cates[0]&&(o[0]=t.account.cates[0].typeName),t.account.cates[1]&&(o[1]=t.account.cates[1].typeName)):o=["体育","足球"],a){t.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="op-save-draft";var r={cate:o[0]||"",cateB:o[1]||"",content:e.content,coverType:"default",covers:[a],extensions:{album:0,native:0,video:0,vote:0},hasSubtitle:0,isPubed:0,is_mobile:0,original:0,reward:0,subTitle:"",title:e.title,video_cover_pic:"",video_id:"",vote_end_tile:"",vote_id:"",vote_options:"",vote_title:"",vote_type:1},i=mt.SAVE_DRAFT+"?_rk="+pt(!0,6,6)+Date.now();return b.a.ajax(i,{type:"POST",headers:t.customHeaders,contentType:"application/json",data:f()(r)}).then(function(e){return e.id?k.a.resolve({res:e}):(r.content="",k.a.reject({msg:e.reason||"保存草稿错误",err:{account:t.account,content:{errDes:"一点-创建草稿失败",step:"op-createDraft",response:e,url:i,reqData:r}}}))},function(e){return k.a.reject({msg:n.reason||"网络错误"})})}return k.a.reject({msg:"封面上传失败",err:{account:t.account,content:{errDes:"一点-封面上传失败",step:"op-cover",response:n}}})},function(e){return k.a.reject({msg:"封面上传失败"})})}},{key:"publish",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="op-publish";var n=mt.PUBLISH+"?post_id="+e+"&_rk="+pt(!0,6,6)+Date.now();return b.a.ajax(n,{type:"GET",headers:this.customHeaders}).then(function(a){return"success"===a.status?k.a.resolve({res:a,id:e}):k.a.reject({msg:a.reason||"发布失败",err:{account:t.account,content:{errDes:"一点-发布失败",step:"op-publish",response:a,url:n}}})},function(e){return k.a.reject({msg:"网络错误"})})}}]),t}(dt),ft=ht,gt={AUTH:"https://mp.toutiao.com/article/browser_auth/?redirect_uri=/core/article/new_article/",AUTH_CONFIRM:"https://mp.toutiao.com/pc_auth_confirm/",MEDIA_INFO:"https://mp.toutiao.com/get_media_info/",UPLOAD_IMG:"https://mp.toutiao.com/tools/catch_picture/?&",TITLE_CHECK:"https://mp.toutiao.com/check_title/",SPELL_CHECK:"https://mp.toutiao.com/article/spell_check_apply/?",ADD_PIC_SOURCE:"https://mp.toutiao.com/article/add_pic_source_stat/?",CHECK_RUMOR:"https://mp.toutiao.com/statistic/rumor_check/?title=",SAVE_DRAFT:"https://mp.toutiao.com/core/article/edit_article_post/?source=mp&type=article",PUBLISH:"https://mp.toutiao.com/core/article/edit_article_post/?source=mp&type=article"},bt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return console.log("new tt publisher"),o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="tt",o.hasAdPermission=!1,o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return k.a.resolve().then(function(){return e.getAdPermission()}).then(function(){return e.checkTitle()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){return e.articleData={content:t},e.saveDraft()}).then(function(t){return e.articleId=t.pgcId,e.publish()}).then(function(t){return k.a.resolve({status:0,index:e.index,articleData:{id:e.articleId,title:e.title,timestamp:Date.now()}})},function(t){return k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],k.a.resolve().then(function(){return e.getAdPermission()}).then(function(){return e.checkTitle()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){return e.articleData={content:t},e.saveDraft()}).then(function(e){return k.a.resolve({status:0,id:e.pgcId})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"getAdPermission",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-ad-permission",b.a.ajax(gt.MEDIA_INFO,{type:"GET",headers:this.customHeaders}).then(function(t){return"success"===t.message&&t.reason&&t.data.media.has_ad_permission&&t.data.media.has_toutiao_ad_permission?e.hasAdPermission=!0:e.hasAdPermission=!1,k.a.resolve()},function(){return e.hasAdPermission=!1,k.a.resolve()})}},{key:"checkAuth",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-check-auth";var t=gt.AUTH+"&_="+Date.now();return b.a.ajax(t,{type:"GET",headers:this.customHeaders}).then(function(n){return"success"===n.message&&n.reason?!0===n.reason.auth_status?k.a.resolve():k.a.reject({res:n,msg:"无发文权限，可能需要验证手机号",err:{account:e.account,content:{errDes:"头条-无发文权限",step:"tt-auth",response:n,url:t}}}):k.a.reject({res:n,msg:"无发文权限，可能需要验证手机号",err:{account:e.account,content:{errDes:"头条-发文权限获取失败",step:"tt-auth",response:n,url:t}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"checkTitle",value:function(){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-check-title",b.a.ajax(gt.TITLE_CHECK+"?title="+encodeURIComponent(this.title)+"&_="+Date.now(),{type:"GET",headers:this.customHeaders}).then(function(e){return e.message,k.a.resolve()},function(e){return k.a.resolve()})}},{key:"checkSpell",value:function(){this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-check-spell";var e=new DOMParser,t=e.parseFromString("<!doctype html><body>"+this.article.content,"text/html"),n=t.body.textContent;return b.a.ajax(gt.SPELL_CHECK,{type:"POST",headers:this.customHeaders,data:{content:n}}).always(function(e){return k.a.resolve()})}},{key:"uploadImg",value:function(e,t){var n=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-upload-img",new k.a(function(a,o){var r=0;!function i(){r+=1,b.a.ajax(gt.UPLOAD_IMG,{type:"POST",data:{upfile:e.url,version:2},headers:n.customHeaders}).then(function(e){e.url?a({url:e.url,index:t}):r<3?i():(console.log("第"+t+"图片粘贴失败"),o({err:e,index:t}))},function(e){r<3?i():(console.log("第"+t+"图片粘贴失败"),o({err:e,index:t}))})}()})}},{key:"addPicSource",value:function(e){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-add-pic",b.a.ajax(gt.ADD_PIC_SOURCE,{type:"POST",headers:this.customHeaders,data:{pic_src:e,pic_count:e}}).always(function(){return k.a.resolve()})}},{key:"processTtImg",value:function(){var e=this,t=/(<img.*?src=["|'])(.*?)(["|'])(.*?)\/>/g,n=[];return this.articleData.content.replace(t,function(e,t,a,o,r,i){return n.push({index:i,url:a}),e}),new k.a(function(a,o){var r=function(e,t){return new k.a(function(n,a){var o=new Image,r=void 0,i=void 0;o.src=e,o.onload=function(){r=o.width,i=o.height,n({width:r,height:i,index:t})},o.onerror=function(){a({err:"图片尺寸获取失败",index:t})}})};de.a.Observable.from(n).flatMap(function(e,t){return de.a.Observable.fromPromise(r(e.url,t)).catch(function(e){return console.log(e),de.a.Observable.of(e)})}).subscribe(function(e){e.width&&(n[e.index].width=e.width,n[e.index].height=e.height)},function(e){},function(){e.articleData.content=e.articleData.content.replace(t,function(e,t,a,o,r,i){for(var s=void 0,c=0;c<n.length;c++)if(n[c].index===i){s=c;break}return n[s].width?t+a+o+' img_width="'+n[s].width+'" img_height="'+n[s].height+'" onerror="javascript:errorimg.call(this);"'+r+"/>":e}),a()})})}},{key:"saveDraft",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-draft",console.log("save-draft"),this.uploadImg({url:this.article.cover},0).then(function(t){var n=t.url;return n?new k.a(function(t,a){var o=new Image;o.src=n,o.onload=function(){e.pubData={article_type:0,title:e.title,content:e.articleData.content,activity_tag:0,title_id:"",claim_origin:0,article_ad_type:e.hasAdPermission?3:2,add_third_title:0,recommend_auto_analyse:0,tag:"",article_label:"",is_fans_article:0,govern_forward:0,push_status:0,push_android_title:"",push_android_summary:"",push_ios_summary:"",timer_status:0,timer_time:"",column_chosen:0,pgc_id:0,pgc_feed_covers:f()([]),from_diagnosis:0,save:0},b.a.ajax(gt.PUBLISH,{type:"POST",headers:e.customHeaders,data:e.pubData}).then(function(n){"保存成功"===n.message&&n.data&&n.data.pgc_id?t({status:0,pgcId:n.data.pgc_id,res:n}):(e.pubData.content="",a({status:-1,msg:n.message,err:{account:e.account,content:{errDes:"头条-创建草稿失败",step:"tt-createDraft",response:n,url:gt.PUBLISH,reqData:e.pubData}}}))})}}):k.a.reject({status:-1,msg:"封面上传失败",err:{account:e.account,content:{errDes:"头条-封面上传失败",step:"tt-cover",response:t,url:gt.PUBLISH,reqData:{upfile:e.article.cover}}}})},function(){return k.a.reject({status:-1,msg:"网络错误"})})}},{key:"publish",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="tt-publish",this.pubData.save=1,this.pubData.pgc_id=this.articleId,b.a.ajax(gt.PUBLISH,{type:"POST",headers:this.customHeaders,data:this.pubData}).then(function(t){return"提交成功"===t.message&&t.data&&t.data.pgc_id?k.a.resolve({status:0,res:t}):(e.pubData.content="",k.a.reject({status:-1,msg:t.message,err:{account:e.account,content:{errDes:"头条-发布失败",step:"tt-publish",response:t,url:gt.PUBLISH,reqData:e.pubData}}}))},function(e){return k.a.reject({msg:"网络错误"})})}}]),t}(dt),vt=bt,wt={GET_BASE64:"https://om.qq.com/image/convertBase64",UPLOAD_IMG:"https://om.qq.com/image/archscaleupload?isRetImgAttr=1&relogin=1",SINGLE_UPLOAD_IMG:"https://om.qq.com/image/exactupload?relogin=1",CROP_COVER:"https://om.qq.com/image/cropupload?relogin=1",SAVE_DRAFT:"https://om.qq.com/article/save?relogin=1",CHECK_HEADLINE:"https://om.qq.com/api/isheadlinewriters?relogin=1",PUBLISH:"https://om.qq.com/article/quickPublish?relogin=1"},kt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return console.log("new qe publisher"),o.coverData={},o.articleContent="",o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="qe",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.genCover().then(function(n){return e.coverData=n,e.coverData.index=0,st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e,5)}).then(function(t){return e.articleContent=t,e.saveDraft()}).then(function(t){return e.publish(t)}).then(function(t){return k.a.resolve({status:0,index:e.index,url:"http://kuaibao.qq.com/s/"+t+"00",articleData:{id:t,type:0,title:e.title,timestamp:Date.now()}})},function(t){return k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],this.genCover().then(function(n){return e.coverData=n,e.coverData.index=0,st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e,5)}).then(function(t){return e.articleContent=t,e.saveDraft()}).then(function(e){return k.a.resolve({status:0,id:e})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"uploadImg",value:function(e,t){this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="qe-upload-img";var n=e.map(function(e){return"https"===e.url.split("://")[0]?(e.isHttps=!0,e.url):(e.isHttps=!1,"https://"+e.url.split("://")[1])}).join(",");return b.a.ajax(wt.UPLOAD_IMG,{type:"POST",data:{url:n},dataType:"json",headers:this.customHeaders}).then(function(n){"string"==typeof n&&(n=JSON.parse(n));var a=n.data;return e.map(function(e){var t="";t=e.isHttps?e.url:e.url.replace("http://","https://"),a.hasOwnProperty(t)?a[e.url]=a[t].size[0].imgurl:a[e.url]=""}),0===n.response.code?k.a.resolve({res:a,index:t}):k.a.reject({err:n,msg:n.response.msg,index:t})},function(e){return k.a.reject({err:e,msg:"图片上传网络错误",index:t})})}},{key:"genCover",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="qe-gen-cover";var t={url:this.article.cover,opCode:151,isUpOrg:1,subModule:"normal_cover"};return b.a.ajax(wt.SINGLE_UPLOAD_IMG,{type:"POST",data:t,headers:this.customHeaders}).then(function(n){return 0===n.response.code?k.a.resolve(n.data):k.a.reject({msg:n.response.msg,err:{account:e.account,content:{errDes:"企鹅-生成封面失败",step:"qe-cover",response:n,url:wt.SINGLE_UPLOAD_IMG,reqData:t}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"saveDraft",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="qe-save-draft";var t={title:this.title,cover_type:1,category_id:this.account.cates?this.account.cates[0].typeId:null,imgurl_ext:f()(this.coverData),content:this.articleContent,orignal:0,user_original:0,apply_olympic_flag:0,apply_push_flag:0,reward_flag:0,type:0};return b.a.ajax(wt.SAVE_DRAFT,{type:"POST",headers:this.customHeaders,data:t}).then(function(n){return 0===n.response.code?k.a.resolve(n.data.articleId):(t.content="",k.a.reject({msg:n.response.msg,err:{account:e.account,content:{errDes:"企鹅-创建草稿失败",step:"qe-createDraft",response:n,reqData:t,url:wt.SAVE_DRAFT}}}))},function(e){return k.a.reject({err:e,msg:"保存草稿失败"})})}},{key:"publish",value:function(e){var t=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="qe-publish",b.a.ajax(wt.PUBLISH,{type:"POST",headers:this.customHeaders,data:{articleId:e}}).then(function(n){return 0===n.response.code?k.a.resolve(e):k.a.reject({msg:n.response.msg,err:{account:t.account,content:{errDes:"企鹅-发布失败",step:"qe-publish",response:n,url:wt.PUBLISH,reqData:{articleId:e}}}})},function(e){return k.a.reject({err:e,msg:"发布失败"})})}}]),t}(dt),_t=kt,yt={USER_INFO:"http://mp.163.com/wemedia/navinfo",UPLOAD_IMG:"http://mp.163.com/wemedia/upload/batchUploadImgUrl",CROP_COVER:"http://mp.163.com/wemedia/upload/doCut",TITLE_CHECK:"http://mp.163.com/wemedia/article/checkTitle",SAVE_DRAFT:"http://mp.163.com/wemedia/article/status/api/publish.do",GET_DRAFTS:"http://mp.163.com/wemedia/content/manage/list.do?_=1509957965129"},xt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return console.log("new wy publisher"),o.coverMode="",o.coverUrl="",o.mediaId="",o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="wy",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.getUserInfo().then(function(){return e.genCover()}).then(function(){return e.checkTitle()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e,10)}).then(function(t){return e.articleContent=t,e.publish(!1)}).then(function(t){return k.a.resolve({status:0,index:e.index,articleData:{id:t.split(",")[1],title:e.title,timestamp:Date.now()}})},function(t){return k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID];var n=0;return this.getDraftList().then(function(e){n=e.length}).then(function(){return e.getUserInfo()}).then(function(){return e.genCover()}).then(function(){return e.checkTitle()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e,10)}).then(function(t){return e.articleContent=t,e.publish(!0)}).then(function(){return function t(){return e.getDraftList().then(function(e){return e.length===n?t():k.a.resolve(e[0].articleId)})}()}).then(function(e){return k.a.resolve({status:0,id:e})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"getUserInfo",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wy-get-info";var t=yt.USER_INFO+"?t="+Date.now()+"&wemediaId=";return b.a.ajax(t,{type:"GET",headers:this.customHeaders}).then(function(n){return 1===n.code?(e.mediaId=n.data.wemediaId,k.a.resolve()):k.a.reject({msg:n.msg||"获取用户信息失败",err:{account:e.account,content:{errDes:"网易-获取用户 id 失败",step:"wy-getUserMediaId",response:n,url:t}}})},function(e){return k.a.reject({msg:"获取用户信息失败"})})}},{key:"uploadImg",value:function(e,t){var n=e.map(function(e){return encodeURIComponent(e.url)}),a="urls="+n.join("&urls=");return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wy-upload-img",b.a.ajax(yt.UPLOAD_IMG,{type:"POST",data:a,headers:this.customHeaders}).then(function(e){if("string"==typeof e&&(e=JSON.parse(e)),1===e.code){var n=e.data;return k.a.resolve({res:n,index:t})}return k.a.reject({err:e,msg:e.msg||"图片上传失败",index:t})},function(e){return k.a.reject({err:e,msg:"图片上传网络错误",index:t})})}},{key:"genCover",value:function(){var e=this;return this.uploadImg([{url:this.article.cover}],0).then(function(t){return t.res&&t.res[e.article.cover]?new k.a(function(n,a){var o=new Image,r=void 0,i=void 0,s=t.res[e.article.cover];o.src=s,o.onload=function(){if(r=o.width,i=o.height,r<360||i<270)n({mode:"auto"});else{var e={cropper_scaleX:1,cropper_scaleY:1,picUrl:s};3*r/4>i?(e.cropper_height=i,e.cropper_width=4*i/3,e.cropper_x=(r-4*i/3)/2,e.cropper_y=0):(e.cropper_width=r,e.cropper_height=3*r/4,e.cropper_y=(i-3*r/4)/2,e.cropper_x=0),e.target_width=Math.floor(e.cropper_width),e.target_height=Math.floor(e.cropper_height),n(r<750||i<375?{mode:"custom",data:e}:{mode:"bigImg",data:e})}}}):k.a.reject({msg:"封面上传错误",err:{account:e.account,content:{errDes:"网易-上传封面失败",step:"wy-uploadCover",response:t,reqData:"urls="+e.article.cover}}})}).then(function(t){return e.coverMode=t.mode,"auto"===t.mode?k.a.resolve():(e.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wy-crop-cover",b.a.ajax(yt.CROP_COVER,{type:"POST",data:t.data,headers:e.customHeaders}).then(function(n){return"string"==typeof n&&(n=JSON.parse(n)),n.data?(e.coverUrl=n.data,k.a.resolve()):k.a.reject({msg:"封面裁剪错误",err:{account:e.account,content:{errDes:"网易-生成封面失败",step:"wy-cover",response:n,url:yt.CROP_COVER,reqData:t.data}}})},function(e){return k.a.reject({err:e,msg:"封面裁剪错误"})}))},function(e){return k.a.reject({err:e.err||e,msg:"封面上传错误"})})}},{key:"checkTitle",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wy-check-title";var t=yt.TITLE_CHECK+"?title="+encodeURIComponent(this.title);return b.a.ajax(t,{type:"GET",headers:this.customHeaders}).then(function(n){return 1===n.code?k.a.resolve():k.a.reject({msg:n.msg,err:{account:e.account,content:{errDes:"网易-标题不合法",step:"wy-checkTitle",response:n,url:t,reqData:e.title}}})},function(e){return k.a.reject({msg:"标题检测错误"})})}},{key:"publish",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]=e?"wy-save-draft":"wy-publish";var n="";this.account.cates?(this.account.cates[0]&&(n+=this.account.cates[0].typeName),this.account.cates[1]&&(n+="/"+this.account.cates[1].typeName)):n="三农";var a={mediaId:this.mediaId,articleId:-1,title:this.title,cover:this.coverMode,scheduled:0,operation:e?"saveDraft":"publish",content:this.articleContent,userClassify:n,picUrl:this.coverUrl};return b.a.ajax(yt.SAVE_DRAFT,{type:"POST",headers:this.customHeaders,data:a}).then(function(n){return"string"==typeof n&&(n=JSON.parse(n)),1===n.code?k.a.resolve(n.data):(a.content="",k.a.reject({msg:n.msg,err:{account:t.account,content:{errDes:e?"网易-保存草稿失败":"网易-发布失败",step:e?"wy-saveDraft":"wy-publish",response:n,url:yt.SAVE_DRAFT,reqData:a}}}))},function(t){return k.a.reject({err:t,msg:e?"保存草稿失败":"发布失败"})})}},{key:"getDraftList",value:function(){return b.a.ajax(yt.GET_DRAFTS,{type:"POST",data:{wemediaId:this.mediaId,pageNo:1,contentState:0,size:50,contentType:0}}).then(function(e){return 1===e.code&&e.data.list.length>0?k.a.resolve(e.data.list):k.a.reject({err:e,msg:"获取草稿失败"})},function(e){return k.a.reject({err:e,msg:"获取草稿失败"})})}}]),t}(dt),Ct=xt,St=["img","iframe"],It=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}return e({$empty:e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1})})}(),Tt={listToMap:function(e){if(!e)return{};e=Tt.isArray(e)?e:e.split(",");for(var t,n=0,a={};t=e[n++];)a[t.toUpperCase()]=a[t]=1;return a},isArray:function(e){return"[object Array]"==Object.prototype.toString.apply(e)},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[e]}):""},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var a=0,o=e.length;a<o;a++)if(!1===t.call(n,e[a],a,e))return!1}else for(var r in e)if(e.hasOwnProperty(r)&&!1===t.call(n,e[r],r,e))return!1},getNodesByTagName:function(e,t){t=Tt.trim(t).replace(/[ ]{2,}/g," ").split(" ");var n=[],a=e;return Tt.each(t,function(e){if(a.childNodes&&a.childNodes.length)for(var t,o=0;t=a.childNodes[o++];)l(t,e,n)}),n},innerText:function(e){return 1!=e.nodeType||It.$empty[e.tagName]?e:e.innerText.replace(/<[^>]+>/g,"")},filterEditorText:function(e){return e&&(e=e.replace(/输入图片描述|请输入图片描述|请点击此处输入图片描述|请点击输入图片描述|请点击输入图片描|STRONG___SEGMENT___STRONG/g,""),e=e.replace(/&nbsp;/g," ")),e||""},getBytes:function(e){if(!e)return 0;var t=/[\u4e00-\u9fa5\u3002\uff1f\uff01\uff0c\u3001\uff1b\uff1a\u201c\u201d\u2018\u2019\uff08\uff09\u300a\u300b\u3008\u3009\u3010\u3011\u300e\u300f\u300c\u300d\ufe43\ufe44\u3014\u3015\u2026\u2014\uff5e\ufe4f\uffe5]/g,n=e+"",a=n.match(t);return a?n.length+a.length:n.length}},Dt={isBody:function(e){return e&&1==e.nodeType&&"body"==e.tagName.toLowerCase()},breakParent:function(e,t){var n,a,o,r=e,i=e;do{for(r=r.parentNode,a?(n=r.cloneNode(!1),n.appendChild(a),a=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(a=r.cloneNode(!1),o=a.cloneNode(!1));n=i.previousSibling;)a.insertBefore(n,a.firstChild);for(;n=i.nextSibling;)o.appendChild(n);i=r}while(t!==r);return n=t.parentNode,n.insertBefore(a,t),n.insertBefore(o,t),n.insertBefore(e,o),Dt.remove(t),e},remove:function(e,t){var n,a=e.parentNode;if(a){if(t&&e.hasChildNodes())for(;n=e.firstChild;)a.insertBefore(n,e);a.removeChild(e)}return e},findParentByTagName:function(e,t,n,a){return t=Tt.listToMap(Tt.isArray(t)?t:[t]),Dt.findParent(e,function(e){return t[e.tagName]&&!(a&&a(e))},n)},findParent:function(e,t,n){if(e&&!Dt.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e)||Dt.isBody(e))return t&&!t(e)&&Dt.isBody(e)?null:e;e=e.parentNode}return null}},At={notTransTagName:{style:1,script:1},moveToBody:function(e,t){Dt.breakParent(e,t)},prepareNode:function(e){for(var t=this,n=0;n<St.length;n++)for(var a=St[n],o=e.getElementsByTagName(a),r=0;r<o.length;r++){var i=o[r],s=i.parentNode;if(("P"!==s.tagName||"BODY"!=s.parentNode.tagName)&&"BODY"!==s.tagName){var c=Dt.findParentByTagName(i,["P"]);c&&t.moveToBody(o[r],c)}}},getNewsData:function(e){var t=this;t.IMAGE_CAPTION_CLASS="bjh-image-caption",t.IMAGE_CAPTION_DEFAULT_TEXT="请点击输入图片描述",t.prepareNode(e);var n=e,a=[];if("BODY"===n.tagName)for(var o,r=0;o=n.childNodes[r++];)t.elementToFeed(o,a),a.push({type:"segment"});var i=0,s=0;for(r=0;r<a.length;r++)"image"===a[r].type?(i++,s+=100):"text"===a[r].type&&(s+=Tt.getBytes(a[r].data)||0);return{data:{type:1,image_num:i,video_num:0,items:a},len:s}},elementToFeed:function(e,t){var n=this,a=e.getAttribute("src")||"";switch(a=Tt.html(a).replace(/["]/g,function(){return"&quot;"}),e.tagName.toLowerCase()){case"img":t.push({type:"image",data:{original:{src:a,height:e.getAttribute("data-h")||"",width:e.getAttribute("data-w")||""}}});break;case"iframe":try{e.attributes&&"edui-faked-goods"===e.getAttribute("class")&&t.push({type:"spd_shop",data:{app_id:"",passport_id:"",tpl_id:e.getAttribute("data-tpl_id"),spd_sku_id:e.getAttribute("data-spd_sku_id"),service_type:e.getAttribute("data-service_type"),tp_src:"bjh"}})}catch(e){}break;default:if(Tt.getNodesByTagName(e,St.join(" ")).length>0){if(e.childNodes&&e.childNodes.length)for(var o=0;o<e.childNodes.length;o++)n.elementToFeed(e.childNodes[o],t)}else try{if("p"===e.tagName.toLowerCase()&&e.getAttribute("class")&&e.getAttribute("class").indexOf(n.IMAGE_CAPTION_CLASS)>-1){for(var r,o=t.length-1;o>-1;o--)if(r=t[o],"segment"!==r.type){if("image"===r.type&&Tt.innerText(e)!==n.IMAGE_CAPTION_DEFAULT_TEXT)break;break}}else{var i=n.nestedElementToText(e,t);e.tagName&&["hr","blockquote","strong","br"].indexOf(e.tagName.toLowerCase())>-1&&(i='<span class="bjh-'+e.tagName.toLowerCase()+'">'+i+"</span>"),(i=Tt.filterEditorText(i))&&t.push({type:"text",data:i})}}catch(e){}}},nestedElementToText:function(e,t){var n=this;if(3==e.nodeType)return e.data||"";var a="";if(e.childNodes&&e.childNodes.length)for(var o,r=0;o=e.childNodes[r++];)switch(o.nodeType){case 1:var i=n.nestedElementToText(o,t)||"",s=o.tagName.toLowerCase();i&&(a+=s&&["hr","blockquote","strong","br"].indexOf(s)>-1?'<span class="bjh-'+s+'">'+i+"</span>":"p"===s?'<span class="bjh-br"></span>'+i:i);break;case 3:var c=n.notTransTagName[o.parentNode.tagName.toLowerCase()]?Tt.html(o.data):o.data.replace(/&nbsp\;/g,"");"STRONG___SEGMENT___STRONG"===c?a+='<span class="bjh-br"></span>':(a=Tt.filterEditorText(a),a+=o.data||"")}return a}},jt=At,Et={UPLOAD_IMG:"http://baijiahao.baidu.com/builderinner/api/content/file/image/dump",AUTO_CROP:"http://baijiahao.baidu.com/builder/author/article/autocutpic",CROP_COVER:"http://baijiahao.baidu.com/builderinner/api/content/file/cuttingPic",CHECK_TITLE:"http://baijiahao.baidu.com/builderinner/api/content/titleCheck",CHECK_SPELL:"http://baijiahao.baidu.com/builderinner/api/content/textCheck",GET_TAG:"http://baijiahao.baidu.com/builderinner/api/content/article/",PUBLISH:"http://baijiahao.baidu.com/builder/author/article/publish",SAVE_DRAFT:"http://baijiahao.baidu.com/builder/author/article/save"},Ot=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return o.appId=o.account.uniqueId,o.tags=[],o.retryTime=0,o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="bj",o.customHeaders["X-Requested-With"]="XMLHttpRequest",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.checkTitle().then(function(){return e.checkSpell()}).then(function(){return e.genCover()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){return e.create(t)}).then(function(){return e.getTag()}).then(function(){return e.tagList.length>0&&(e.tags[0]=e.tagList[0].id),e.publish()}).then(function(){var t=new Date;return k.a.resolve({status:0,index:e.index,articleData:{id:e.articleId,title:e.title,timestamp:t.getTime(),type:"news",publishTime:t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}})},function(t){return k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],this.checkTitle().then(function(){return e.checkSpell()}).then(function(){return e.genCover()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){return e.create(t)}).then(function(){return k.a.resolve({status:0,id:e.articleId})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"uploadImg",value:function(e,t){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-upload-img",b.a.ajax(Et.UPLOAD_IMG+"?usage=content&url="+encodeURIComponent(e.url),{type:"GET",headers:this.customHeaders}).then(function(e){return 0==e.error_code?k.a.resolve({url:e.data.bos_url,index:t}):k.a.reject({err:e,index:t})},function(e){return k.a.reject({err:e,index:t})})}},{key:"genCover",value:function(){var e=this;return this.uploadImg({url:this.article.cover},0).then(function(t){var n=t.url;return e.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-auto-crop",b.a.ajax(Et.AUTO_CROP,{type:"POST",data:{image:n,article_type:"news"},headers:e.customHeaders}).then(function(t){return 0==t.errno?(e.coverUrl=t.url,k.a.resolve(t.url)):e.cropCover(n)})})}},{key:"cropCover",value:function(e){var t=this;return new k.a(function(n,a){var o=new Image,r=void 0,i=void 0;o.src=e,o.onload=function(){if(r=o.width,i=o.height,!(r<218||i<146)){var s={src:e};return 2*r/3>i?(s.h=i,s.w=3*i/2,s.x=(r-3*i/2)/2,s.y=0):(s.w=r,s.h=2*r/3,s.y=(i-2*r/3)/2,s.x=0),t.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-crop-cover",b.a.ajax(Et.CROP_COVER,{type:"POST",data:s,headers:t.customHeaders}).then(function(e){0==e.error_code?(t.coverUrl=e.data.src,t.oriCoverUrl=e.data.origin_src,n()):a({msg:e.error_msg,err:{account:t.account,content:{errDes:"百度：封面裁剪失败",step:"bj-cover",response:e,url:Et.CROP_COVER,reqData:s}}})})}a({msg:"封面太小",err:{account:t.account,content:{errDes:"百度-原封面太小",step:"bj-cover"}}})}})}},{key:"checkTitle",value:function(){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-check-title",this.customHeaders[_.a.SYNC.CUSTOM_HEADER_Referer]="http://baijiahao.baidu.com/builder/article/edit?type=news&app_id="+this.appId,b.a.ajax(Et.CHECK_TITLE,{type:"POST",data:{content:this.title,app_id:this.appId},headers:this.customHeaders}).then(function(e){return 0==e.errno?k.a.resolve():k.a.reject({msg:"标题非法"})})}},{key:"checkSpell",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-check-spell",this.customHeaders[_.a.SYNC.CUSTOM_HEADER_Referer]="http://baijiahao.baidu.com/builder/article/edit?type=news&app_id="+this.appId;var t=new DOMParser,n=t.parseFromString("<!doctype html><body>"+this.article.content,"text/html"),a=n.body.textContent;return b.a.ajax(Et.CHECK_SPELL,{type:"POST",data:{content:a,app_id:this.appId},headers:this.customHeaders}).then(function(t){return 0==t.errno?((ne()(t.result.jiucuo.feed_content).length>0||t.result.jiucuo.feed_content.length>0)&&(e.spellErr=!0),k.a.resolve()):k.a.resolve()})}},{key:"create",value:function(e){var t=this,n=this.genFeedContent(e),a={type:"news",app_id:this.appId,title:this.title,subtitle:"",content:e,original_status:0,cover_layout:"one",cover_images:f()([{src:this.coverUrl}]),_cover_images_map:f()([{src:this.coverUrl,origin_src:this.oriCoverUrl}]),feed_content:n,error_correction:this.spellErr?1:0};return this.account.cates&&(a.feed_cat=this.account.cates[0].typeId),this.publishArticleData=a,this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-create",this.customHeaders[_.a.SYNC.CUSTOM_HEADER_Referer]="http://baijiahao.baidu.com/builder/article/edit?type=news&app_id="+this.appId,b.a.ajax(Et.SAVE_DRAFT,{type:"POST",data:a,headers:this.customHeaders}).then(function(n){return 0==n.errno?(t.articleId=n.ret.id,t.publishArticleData.article_id=t.articleId,t.retryTime=0,k.a.resolve({res:n.ret,id:n.ret.id,data:a})):t.retryTime<3?(t.retryTime++,t.create(e)):(t.retryTime=0,a.content="",k.a.reject({msg:n.errmsg,err:{account:t.account,content:{errDes:"百度-创建草稿失败",step:"bj-createDraft",response:n,url:Et.SAVE_DRAFT,reqData:a}}}))},function(n){return t.retryTime<3?(t.retryTime++,t.create(e)):(t.retryTime=0,k.a.reject({msg:"创建草稿失败"}))})}},{key:"genFeedContent",value:function(e){var t=new DOMParser,n=t.parseFromString("<!doctype html><body>"+e,"text/html"),a=jt.getNewsData(n.body);return f()(a.data)}},{key:"getTag",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-get-tags",this.customHeaders[_.a.SYNC.CUSTOM_HEADER_Referer]="http://baijiahao.baidu.com/builder/article/edit?article_id="+this.articleId+"&type=news&app_id="+this.appId;var t=Et.GET_TAG+this.articleId+"/gettag",n={id:this.articleId,app_id:this.appId,feed_cat:this.account.cates[0].typeId};return b.a.ajax(t,{type:"POST",data:n,headers:this.customHeaders}).then(function(a){return 0==a.error_code?(e.tagList=a.ret,k.a.resolve()):k.a.reject({msg:a.error_msg,err:{account:e.account,content:{errDes:"百度-获取标签失败",step:"bj-getTag",response:a,url:t,reqData:n}}})},function(e){return k.a.reject({msg:"获取标签失败"})})}},{key:"publish",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="bj-publish",this.customHeaders[_.a.SYNC.CUSTOM_HEADER_Referer]="http://baijiahao.baidu.com/builder/article/edit?article_id="+this.articleId+"&type=news&app_id="+this.appId,this.publishArticleData.tag=this.tags.join(","),b.a.ajax(Et.PUBLISH,{type:"POST",headers:this.customHeaders,data:this.publishArticleData}).then(function(t){return 0==t.errno?(e.retryTime=0,k.a.resolve()):20050004==t.errno?(e.publishArticleData.content="",k.a.reject({msg:"已超出每日发文限制",err:{account:e.account,content:{errDes:"百度-发布失败(超出限制)",step:"bj-publish",response:t,url:Et.PUBLISH,reqData:e.publishArticleData}}})):e.retryTime<3?(e.retryTime++,e.publish()):(e.retryTime=0,e.publishArticleData.content="",k.a.reject({msg:t.errmsg,err:{account:e.account,content:{errDes:"百度-发布失败",step:"bj-publish",response:t,url:Et.PUBLISH,reqData:e.publishArticleData}}}))},function(t){return e.retryTime<3?(e.retryTime++,e.publish()):(e.retryTime=0,k.a.reject({msg:"发布失败"}))})}},{key:"saveDraft",value:function(){var e=this;return this.publishArticleData.tag=this.tags.join(","),b.a.ajax(Et.PUBLISH,{type:"POST",headers:this.customHeaders,data:this.publishArticleData}).then(function(t){return 0==t.errno?(e.retryTime=0,k.a.resolve()):20050004==t.errno?(e.publishArticleData.content="",k.a.reject({msg:"已超出每日发文限制",err:{account:e.account,content:{errDes:"百度-发布失败(超出限制)",step:"bj-publish",response:t,url:Et.PUBLISH,reqData:e.publishArticleData}}})):e.retryTime<3?(e.retryTime++,e.publish()):(e.retryTime=0,e.publishArticleData.content="",k.a.reject({msg:t.errmsg,err:{account:e.account,content:{errDes:"百度-发布失败",step:"bj-publish",response:t,url:Et.PUBLISH,reqData:e.publishArticleData}}}))},function(t){return e.retryTime<3?(e.retryTime++,e.publish()):(e.retryTime=0,k.a.reject({msg:"发布失败"}))})}}]),t}(dt),Lt=Ot,Ut={NOTEBOOKS_URL:"http://www.jianshu.com/author/notebooks",NOTES_URL:"http://www.jianshu.com/author/notes/",UPLOAD_IMG:"http://www.jianshu.com/upload_images/fetch"},qt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return o.note={},o.notebooks={},console.log("new js publisher"),o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="js",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.getNotebooks().then(function(){return e.createNewNote()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){var n={content:t};return e.saveDraft(n)}).then(function(t){return e.publish(t)}).then(function(t){return k.a.resolve({status:0,index:e.index,url:t.url,articleData:{id:e.note.slug,title:e.title,timestamp:Date.now()}})},function(t){return console.log("简书发布错误"),k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],this.getNotebooks().then(function(){return e.createNewNote()}).then(function(){return st()(t.prototype.__proto__||at()(t.prototype),"processImg",e).call(e)}).then(function(t){var n={content:t};return e.saveDraft(n)}).then(function(t){return k.a.resolve({status:0,id:e.notebooks.id+"-"+t})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"getCsrfToken",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-get-token",b.a.ajax({url:"http://www.jianshu.com/writer",type:"get",dataType:"html",headers:this.customHeaders}).then(function(t){var n=t.match(/<meta\sname="csrf-token"\scontent="(\S*?)"/);return n?(e.csrfToken=n[1],k.a.resolve()):k.a.reject({res:"",msg:"权限获取失败",err:{account:e.account,content:{errDes:"简书：token 获取失败",step:"js-getToken",response:"",url:"http://www.jianshu.com/writer",reqData:{}}}})},function(e){return k.a.reject()})}},{key:"getNotebooks",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-get-notebooks",b.a.ajax(Ut.NOTEBOOKS_URL,{type:"GET",headers:this.customHeaders}).then(function(t){return t.length>=0?e.createNewNotebook(t):k.a.reject({res:t,msg:"获取文集列表失败",err:{account:e.account,content:{errDes:"简书：获取文集失败",step:"js-getNotebooks",response:t,url:Ut.NOTEBOOKS_URL}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"createNewNotebook",value:function(e){for(var t=this,n=!0,a={},o=0,r=e.length;o<r;o++)if("新媒体管家发布"===e[o].name){n=!1,a=e[o],this.notebooks=a;break}if(n){var i=p()({},this.customHeaders);i["Content-Type"]="application/json",i.Accept="application/json";var s={name:"新媒体管家发布"};return b.a.ajax(Ut.NOTEBOOKS_URL,{type:"POST",dataType:"json",data:f()(s),headers:i}).then(function(e){return e.name||"新媒体管家发布"===e.name?(t.notebooks=e,k.a.resolve(e)):k.a.reject({res:e,msg:"创建简书文集失败",err:{account:t.account,content:{errDes:"简书：创建文集失败",step:"js-createNotebook",response:e,url:Ut.NOTEBOOKS_URL,reqData:s}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}return k.a.resolve(a)}},{key:"getNotes",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-get-notes",b.a.ajax(Ut.NOTES_URL,{type:"GET",headers:this.customHeaders}).then(function(t){return t.length>=0?e.createNewNote(t):k.a.reject({res:t,msg:"获取文章列表失败",err:{account:e.account,content:{errDes:"简书：获取文章列表失败",step:"js-getNotes",response:t,url:Ut.NOTES_URL}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"createNewNote",value:function(){var e=this,t=p()({},this.customHeaders);t["Content-Type"]="application/json",t.Accept="application/json";var n={title:this.article.title,notebook_id:this.notebooks.id};return b.a.ajax(Ut.NOTES_URL,{type:"POST",dataType:"json",data:f()(n),headers:t}).then(function(t){return t.title&&t.notebook_id==e.notebooks.id?(e.note=t,k.a.resolve(t)):k.a.reject({res:t,msg:"简书创建文章失败",err:{account:e.account,content:{errDes:"简书：创建文章失败",step:"js-createNote",response:t,reqData:n,url:Ut.NOTES_URL}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"uploadImg",value:function(e,t){this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-upload-img";var n=p()({},this.customHeaders);return n.Accept="application/json",b.a.ajax(Ut.UPLOAD_IMG,{type:"POST",data:{url:e.url},headers:n}).then(function(e){return e.url?k.a.resolve({url:e.url,index:t}):k.a.reject({err:e,index:t})},function(e){return k.a.reject({err:e,index:t})})}},{key:"saveDraft",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-save-draft";var n=p()({},this.customHeaders);n["Content-Type"]="application/json",n.Accept="application/json";var a={title:this.title,content:e.content,autosave_control:1,id:this.note.id.toString()},o=Ut.NOTES_URL+"/"+this.note.id;return b.a.ajax(o,{type:"PUT",dataType:"json",headers:n,data:f()(a)}).then(function(e){return void 0!==e.id&&e.id===t.note.id?k.a.resolve(e.id):(a.content="",k.a.reject({status:-1,msg:e.message,err:{account:t.account,content:{errDes:"简书：草稿创建失败",step:"js-save-draft",response:e,url:o,reqData:a}}}))},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"publish",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="js-publish";var n=p()({},this.customHeaders);n["Content-Type"]="application/json",n.Accept="application/json";var a=Ut.NOTES_URL+"/"+e+"/publicize";return b.a.ajax(a,{type:"POST",headers:n}).then(function(e){return e.last_compiled_at?k.a.resolve({status:0,url:"http://www.jianshu.com/p/"+t.note.slug,res:e}):k.a.reject({status:-1,msg:e.message,err:{account:t.account,content:{errDes:"简书：发布失败",step:"js-publish",response:e,url:a,reqData:t.note.id}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}}]),t}(dt),Ht=qt,Nt=function(e,t){var n=e.map(function(e){return encodeURIComponent(e.url)}).join("&imgs=");return b.a.ajax(_.a.urls.API_HOST+"/api/upload/urls",{type:"POST",data:"imgs="+n}).then(function(n){if(0===n.base_resp.ret){var a={};return e.map(function(e,t){a[e.url]=n.urls[t]}),k.a.resolve({res:a,index:t})}return k.a.reject({err:n,msg:n.msg||"图片上传失败",index:t})},function(e){return k.a.reject({err:e,msg:"图片上传网络错误",index:t})})},Pt={EDITOR:"https://card.weibo.com/article/v3/editor",ARTICLE:"https://card.weibo.com/article/v3/aj/editor/draft/create",GETBID:"http://js.t.sinajs.cn/t6/toutiao/article/pc/main.js",INITPID:"https://e.weibo.com/v1/public/paid/initpid",SETPAYINFO:"http://card.weibo.com/article/v3/aj/editor/settings/setpayinfo",SAVE_DRAFT:"https://card.weibo.com/article/v3/aj/editor/draft/save",PUBLISH:"http://card.weibo.com/article/v3/aj/editor/draft/publish",DEL_DRAFT:"https://card.weibo.com/article/v3/aj/editor/draft/delete"},Rt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return o.draft={},console.log("new wb publisher"),o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="wb",o.customHeaders["X-Requested-With"]="XMLHttpRequest",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.createNewArticle().then(function(){return e.getBid()}).then(function(){return e.initPaySetting()}).then(function(){return e.setPayInfo()}).then(function(){return e.createCover()}).then(function(){return e.saveDraft()}).then(function(){return e.publish()}).then(function(t){return e.delDraft(t)}).then(function(t){var n=t.res,a=t.url;return k.a.resolve({status:0,index:e.index,url:a,articleData:{id:n.data.object_id.split(":")[1],title:e.title,timestamp:Date.now()}})},function(t){return console.log("微博发布错误"),k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],this.createNewArticle().then(function(){return e.getBid()}).then(function(){return e.initPaySetting()}).then(function(){return e.setPayInfo()}).then(function(){return e.processImg(10)}).then(function(){return e.createCover()}).then(function(t){return e.saveDraft(t)}).then(function(){return k.a.resolve({status:0,id:e.draft.id})},function(e){return k.a.reject({status:-1,msg:e.msg,err:e.err})})}},{key:"createNewArticle",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-new-draft",b.a.ajax(Pt.ARTICLE,{type:"POST",headers:this.customHeaders,data:{title:"xmt",type:"draft",summary:"",writer:"",cover:"",content:""}}).then(function(t){return"string"==typeof t&&(t=JSON.parse(t)),"100000"==t.code?(e.draft.id=t.data.id,k.a.resolve(t)):k.a.reject({res:t,msg:t.msg,err:{account:e.account,content:{errDes:"微博-创建文章失败",step:"wb-create",response:t,url:Pt.ARTICLE}}})},function(e){return k.a.reject({err:e,msg:"网络错误"})})}},{key:"getBid",value:function(){var e=this,t={};return t[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-get-payinfo",t["Content-Type"]="text/html",p()(t,this.customHeaders),b.a.ajax(Pt.EDITOR,{type:"GET",headers:t}).then(function(n){var a=n.match(/toutiao\/article\/pc\/main.js\?version=(\S*?)"/);return a?(delete t["Content-Type"],b.a.ajax(Pt.GETBID+"?version="+a[1],{type:"GET",headers:t})):k.a.reject({HTMLRes:n,msg:"获取文章bid失败",err:{account:e.account,content:{errDes:"微博-获取文章 bid 失败",step:"wb-getbid",url:Pt.EDITOR}}})},function(e){return console.log(e),k.a.reject({err:e,msg:"网络错误"})}).then(function(t){var n=t.match(/paysetComponent:"bid=(\d*?)"/i);return n?(e.draft.bid=n[1],k.a.resolve()):k.a.reject({res:t,msg:"获取文章bid失败",err:{account:e.account,content:{errDes:"微博-获取文章 bid 失败",step:"wb-getbid",url:Pt.GETBID}}})},function(e){var t=e.res;return k.a.reject({err:t,msg:"网络错误"})})}},{key:"initPaySetting",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-init-paysetting";var t=Pt.INITPID+"?bid="+this.draft.bid+"&_t=1&ispay=0&callback=STK_"+Date.now()+"1";return b.a.ajax(t,{type:"GET",headers:this.customHeaders}).then(function(n){var a=n.match(/pid":"(\d*)"/);return a?(e.draft.pid=a[1],k.a.resolve()):k.a.reject({res:n,msg:"获取文章paysetting失败",err:{account:e.account,content:{errDes:"微博-获取 paySetting 失败",step:"wb-getPaySetting",response:n,url:t}}})},function(n){if("200"==n.status){var a=n.responseText.match(/pid":"(\d*)"/);return a?(e.draft.pid=a[1],k.a.resolve()):k.a.reject({res:n,msg:"获取文章paysetting失败",err:{account:e.account,content:{errDes:"微博-获取 paySetting 失败",step:"wb-getPaySetting",response:n,url:t}}})}return k.a.reject({err:n,msg:"获取pid网络错误"})})}},{key:"setPayInfo",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-set-payinfo";var t={id:this.draft.id,pay_setting:f()({pid:this.draft.pid,isreward:1,isvclub:0,ispay:0})};return b.a.ajax(Pt.SETPAYINFO,{type:"POST",data:t,headers:this.customHeaders}).then(function(n){return 1e5==n.code?k.a.resolve():k.a.reject({res:n,msg:n.msg,err:{account:e.account,content:{errDes:"微博-setpayinfo失败",step:"wb-set-payinfo",response:n,url:Pt.SETPAYINFO,reqData:t}}})})}},{key:"uploadImg",value:function(e,t){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-upload-img",Nt(e,t)}},{key:"createCover",value:function(){var e=this;return console.log(this.article.cover),this.uploadImg([{url:this.article.cover}],0).then(function(t){return e.draft.cover=t.res[e.article.cover],k.a.resolve()},function(){return e.draft.cover="https://wx3.sinaimg.cn/crop.0.0.750.421.1000/56e89fd7ly1fcr7jp6l8zj20ku0bqn37.jpg",k.a.resolve()})}},{key:"saveDraft",value:function(e){var t=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-save-draft";var n={id:this.draft.id,title:this.article.title,writer:"",cover:this.draft.cover,summary:"",content:e||this.article.content};return b.a.ajax(Pt.SAVE_DRAFT,{type:"POST",headers:this.customHeaders,data:n}).then(function(e){return"string"==typeof e&&(e=JSON.parse(e)),"100000"==e.code?k.a.resolve():(n.content="",k.a.reject({res:e,msg:e.msg,err:{account:t.account,content:{errDes:"微博-保存草稿失败",step:"wb-saveDraft",response:e,url:Pt.SAVE_DRAFT,reqData:n}}}))},function(e){var t=e.res;return k.a.reject({err:t})})}},{key:"publish",value:function(){var e=this;this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-publish-draft";var t={id:this.draft.id,text:"发布了头条文章：《"+this.article.title+"》",follow_to_read:1,follow_official:0,sync_wb:0,is_original:0};return b.a.ajax(Pt.PUBLISH,{type:"POST",headers:this.customHeaders,data:t}).then(function(n){return"string"==typeof n&&(n=JSON.parse(n)),1e5==n.code?k.a.resolve({status:0,res:n,url:n.data.url}):k.a.reject({status:-1,msg:n.msg,err:{account:e.account,content:{errDes:"微博-发布失败",step:"wb-publish",response:n,url:Pt.PUBLISH,reqData:t,cookie:cookie}}})},function(){return k.a.reject({status:-1,msg:"网络错误"})})}},{key:"delDraft",value:function(e){return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="wb-delete-draft",b.a.ajax(Pt.DEL_DRAFT,{type:"POST",data:{id:this.draft.id},headers:this.customHeaders}).then(function(t){return k.a.resolve({status:0,res:e.res,url:e.url})},function(t){return k.a.resolve({status:0,res:e.res,url:e.url})})}}]),t}(dt),Mt=Rt,Bt={SAVE_DRAFT:"https://mp.sohu.com/v3/news/draft",PUBLISH:"https://mp.sohu.com/v3/news/publish",UPLOAD_XMT_IMG:_.a.urls.API_HOST+"/api/upload/urls"},Gt=function(e){function t(e,n,a){X()(this,t);var o=rt()(this,(t.__proto__||at()(t)).call(this,e,n,a));return console.log("new sh publisher"),o.customHeaders={},o.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID]=o.account.aId,o.customHeaders[_.a.SYNC.CUSTOM_HEADER_PLAT]="sh",o}return ut()(t,e),K()(t,[{key:"doPublish",value:function(){var e=this;return this.genCover().then(function(){var t={content:e.article.content};return e.saveDraft(t)}).then(function(){return e.publish()}).then(function(t){return k.a.resolve({status:0,index:e.index,articleData:{id:t,title:e.title,timestamp:Date.now()}})},function(t){return console.log("搜狐发布错误"),k.a.reject({status:-1,index:e.index,msg:t.msg,err:t.err})})}},{key:"createDraft",value:function(){var e=this;return delete this.customHeaders[_.a.SYNC.CUSTOM_HEADER_AID],this.genCover().then(function(){var t={content:e.article.content};return e.saveDraft(t)}).then(function(){return b.a.ajax(Bt.SAVE_DRAFT,{type:"POST",headers:e.customHeaders,data:e.draftData}).then(function(e){return 200===e.code||/\d{6}/.test(e)?k.a.resolve({status:0,id:e}):k.a.reject({status:-1,msg:e})},function(e){return k.a.reject({status:-1,msg:"创建草稿失败",err:e})})})}},{key:"genCover",value:function(){return k.a.resolve()}},{key:"uploadImg",value:function(e,t){return Nt(e,t)}},{key:"saveDraft",value:function(e){this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="sh-save-draft";var t=[];return this.account.cates?(this.account.cates[0]&&(t[0]=this.account.cates[0].typeId),this.account.cates[1]&&(t[1]=this.account.cates[1].typeId)):t=["10","1468"],this.draftData={title:this.title,brief:this.article.desc,content:this.article.content,channelId:t[0]||null,categoryId:t[1]||null,id:0,isOriginal:0,userColumnId:0},k.a.resolve()}},{key:"publish",value:function(){var e=this;return this.customHeaders[_.a.SYNC.CUSTOM_HEADER_ACTION]="sh-publish",b.a.ajax(Bt.PUBLISH,{type:"POST",headers:this.customHeaders,data:this.draftData}).then(function(t){return 200===t.code||/\d{6}/.test(t)?k.a.resolve(t):500===t.code?(e.draftData.content="",k.a.reject({msg:"已超出每日发文限制",err:{account:e.account,content:{errDes:"搜狐-发布失败(超限)",step:"sh-publish",response:t,url:Bt.PUBLISH,reqData:e.draftData}}})):(e.draftData.content="",k.a.reject({msg:t.msg,err:{account:e.account,content:{errDes:"搜狐-发布失败",step:"sh-publish",response:t,url:Bt.PUBLISH,reqData:e.draftData}}}))},function(t){if(e.draftData.content="",console.log(t),400===t.status){var n=t.responseJSON;return n.code?k.a.reject({msg:3003===n.code?"已超出每日发文限制":n.msg,err:{account:e.account,content:{errDes:"搜狐-发布失败(超限)",step:"sh-publish",response:n,url:Bt.PUBLISH,reqData:e.draftData}}}):k.a.reject({msg:"请求失败",err:{account:e.account,content:{errDes:"搜狐-发布失败",step:"sh-publish",response:n,url:Bt.PUBLISH,reqData:e.draftData}}})}return k.a.reject({msg:"网络错误"})})}}]),t}(dt),Ft=Gt,Yt=new tt,zt=[],Vt=new $e,Xt={checkLogin:{},publish:{},auth:{}},Jt={},Kt={},Wt={},$t={},Qt=function(e){if(-1!==e.tabId)return{requestHeaders:e.requestHeaders};for(var t=e.requestHeaders,n=void 0,a=void 0,o=void 0,r=void 0,i="",s=[],c=0;c<t.length;c++)t[c].name===_.a.SYNC.CUSTOM_HEADER_PLAT&&(o=t[c].value,s.push(c)),t[c].name===_.a.SYNC.CUSTOM_HEADER_ACTION&&(r=t[c].value,s.push(c),n="check-login"===r?Xt.checkLogin:"get-auth"===r?Xt.auth:Xt.publish),t[c].name===_.a.SYNC.CUSTOM_HEADER_AID&&(a=t[c].value,s.push(c)),t[c].name===_.a.SYNC.CUSTOM_HEADER_Referer&&(i=t[c].value,s.push(c));for(var u=s.length-1;u>=0;u--)t.splice(s[u],1);if(o&&n&&a&&r){n[e.requestId]=a;for(var l=!1,d=0;d<t.length;d++)if("cookie"===t[d].name.toLowerCase()){l=!0,t[d].value=Yt.getCookie(a);break}l||t.push({name:"cookie",value:Yt.getCookie(a)})}if(r&&"check-login"!==r){var m={origin:"",referer:""};switch(o){case"op":m.origin="https://mp.yidianzixun.com",m.referer="https://mp.yidianzixun.com/";break;case"qe":m.origin="https://om.qq.com",m.referer="https://om.qq.com/article/articlePublish";break;case"wy":m.origin="http://mp.163.com",m.referer="http://mp.163.com/wemedia/article/postpage/";break;case"bj":m.origin="http://baijiahao.baidu.com",m.referer="http://baijiahao.baidu.com/builder/article/edit";break;case"js":m.origin="http://www.jianshu.com",m.referer="http://www.jianshu.com/writer";break;case"wb":m.origin="https://weibo.com",m.referer="https://weibo.com/ttarticle/p/editor"}m.origin.length>0&&m.referer.length>0&&(t.push({name:"Origin",value:m.origin}),t.push({name:"Referer",value:i.length>0?i:m.referer}))}return{requestHeaders:t}},Zt=function(e){var t=e.responseHeaders,n=void 0,a=void 0,o=[];if(n=Xt.checkLogin[e.requestId]?Xt.checkLogin:Xt.publish[e.requestId]?Xt.publish:null,n&&(a=n[e.requestId]),a){for(var r=Yt.getCookie(a),i=0;i<t.length;i++)"set-cookie"===t[i].name.toLowerCase()?function(){var e=t[i].value.split(";")[0],n=e.split(/=(.+)?/)[0],o=e.split(/=(.+)?/)[1],s=new RegExp("(^|;)"+n+"=(.*?)($|;)");"EXPIRED"!==o?-1!==r.indexOf(n)?r=r.replace(s,function(e,t,a,r){return t+n+"="+o+r}):r+=";"+e:-1!==r.indexOf(n)&&(r=r.replace(s,function(e,t){return 0===t.length?"":";"})),Yt.setCookie(a,r,!0)}():o.push(t[i]);return{responseHeaders:o}}return{responseHeaders:e.responseHeaders}},en=function(){function e(){X()(this,e);for(var t=["tt","op","qe","bj","sh","wy","wb","js"],n=0;n<t.length;n++){var a=y.a.getPlatUrl(t[n]),o="*://*."+a.split("/").slice(2,3)+"/*";zt.push(o)}e.addListener(),e.addWebListener()}return K()(e,null,[{key:"addListener",value:function(){chrome.runtime.onMessageExternal.addListener(function(e,t,n){switch(e.event){case"xmtsync-getArticleContent":qe.collect(e.url).then(function(e){if("succ"===e.status){var t=e.data;n(p()({status:"succ"},t))}else n({status:"fail"})},function(e){n({status:"error"})});break;case"xmtsync-getAccounts":n({loginStatus:Se.getLoginInfo().loginStatus,accounts:Se.getAccountsData()});break;case"xmtsync-login":ke.syncLogin(function(e){Kt[e.id]=t.tab.id});break;case"xmtsync_login_succ":Se.updateLoginInfo(0,e.account),chrome.tabs.remove(parseInt(e.windowId)),chrome.tabs.update(Kt[t.tab.id],{url:_.a.urls.PLAT_SYNC_HREF,active:!0});break;case"xmtsync-request":var a=void 0;e.options.headers&&e.options.headers["X-Xmt-Sync-Header-Aid"]&&(a=Yt.getCookie(e.options.headers["X-Xmt-Sync-Header-Aid"])),b.a.ajax(e.options).then(function(e){n({status:0,data:e,cookie:a})},function(e){n({status:-1,data:e,cookie:a})});break;case"xmtsync-startPublish":console.log("开始发布"),n();break;case"xmtsync-finishPublish":console.log("发布完成")}return!0}),chrome.extension.onRequest.addListener(function(e,t,n){if("setCookie"===e.operation){var a=Wt[t.tab.id]||$t[t.tab.id];if(a){var o=function(e,n){Yt.setCookie(e.aId,n,!1),$t[t.tab.id]?e.port.postMessage({action:"auth",status:"succ",index:e.index}):e.port.postMessage({action:"login",status:"succ",index:e.index}),chrome.tabs.remove(t.tab.id),Jt[t.tab.id]&&Jt[t.tab.id].destroy(),chrome.tabs.update(e.port.sender.tab.id,{active:!0}),delete Wt[t.tab.id]};"qe"===e.platform?o(a,e.cookies):"tt"===e.platform?je.getCookies_new("https://mp.toutiao.com",y.a.getPlatCookie("tt"),function(e){var t=e.map(function(e){return e.name+"="+e.value}).join(";");o(a,t)}):je.getCookies(y.a.getPlatUrl(e.platform),y.a.getPlatCookie(e.platform),function(e){o(a,e)})}}}),chrome.runtime.onConnectExternal.addListener(function(t){switch(t.name){case"xmtsync-checkAccountLoginStatus":e.checkAccountLogin(t);break;case"xmtsync-checkAccountLoginStatusV2":e.checkAccountLogin(t,!0);break;case"xmtsync-loginAccount":e.loginAccount(t);break;case"xmtsync-checkAccountPublishAuth":e.checkAccountAuth(t);break;case"xmtsync-checkAccountPublishAuthV2":e.checkAccountAuthV2(t);break;case"xmtsync-authAccount":e.authAccount(t);break;case"xmtsync-publishAll":e.publishAll(t)}})}},{key:"checkAccountLogin",value:function(e,t){var n=function(n){if("start"===n.action||"recheck"===n.action){var a=function(e,a){var o=y.a.convertPlatCode(e.platformCode),r=y.a.getPlatUrl(o),i=function(e,t){var n=y.a.getPlatCookie(e);return t.filter(function(e){return-1===n.indexOf(e.name)})},s=de.a.Observable.defer(function(){return"start"===n.action?new k.a(function(t,n){chrome.cookies.getAll({url:r},function(n){return n=i(o,n),"02"===e.platformCode?b.a.get(_.a.urls.API_HOST+"/api/get_multi_cookies?aid="+e.aId).always(function(a){if(a.cookieContent){var o=a.cookieContent.filter(function(e){return null===e.expires||e.expires>Date.now()/1e3}),r="",i="";o.map(function(e){var t=e.name+"="+e.value+";";/^\.?sso\.toutiao\.com|^\.?toutiao.com/.test(e.domain)&&(i+=t),/^\.?mp\.toutiao\.com|^\.?toutiao.com/.test(e.domain)&&(r+=t)}),n=n.filter(function(e){return e.expirationDate>Date.now()/1e3&&-1===r.indexOf(e.name)}).map(function(e){return e.name+"="+e.value}).join(";")+";",Yt.setCookie(e.aId,n+r,!0),Yt.setCookie(e.aId,n+i,!0,"sso")}else Yt.setCookie(e.aId,"",!0),Yt.setCookie(e.aId,"",!0,"sso");t()}):b.a.get(_.a.urls.API_HOST+"/api/get_cookies_v2?aid="+e.aId).always(function(a){n=n.filter(function(e){return e.expirationDate>Date.now()/1e3&&-1===(a.cookies||y.a.getPlatCookie(o)).indexOf(e.name)}).map(function(e){return e.name+"="+e.value}).join(";")+";","03"===e.platformCode&&(n=""),Yt.setCookie(e.aId,a.cookies?n+a.cookies:"",!0),t()})})}):(console.log("重新检查登录"),k.a.resolve())}).catch(function(e){return console.log(e),de.a.Observable.of(e)}),c=de.a.Observable.defer(function(){console.log("check login source");var t={};t[_.a.SYNC.CUSTOM_HEADER_AID]=e.aId,t[_.a.SYNC.CUSTOM_HEADER_PLAT]=o,t[_.a.SYNC.CUSTOM_HEADER_ACTION]="check-login";var i="";i="wb"===o?""+v.a.wbTestLoginUrl+Date.now().toString():"sh"===o?""+v.a.shTestLoginUrl+Date.now().toString():"wy"===o?v.a.wyTestLoginUrl:r;var s=Yt.getCookie(e.aId);return b.a.ajax(i,{type:"GET",headers:t}).then(function(t){var r=!y.a.isNotLogged(o,t);if(!r){if("recheck"===n.action)try{Qe(e,{errDes:"重登录失败",step:"recheck-login",cookie:s})}catch(e){console.log("recheck-login err report fail"),console.log(e)}Yt.setCookie(e.aId,"",!0)}return k.a.resolve({isLogin:r,plat:o,index:a})},function(e){return k.a.reject({err:e,index:a})})}).catch(function(e){return console.log(e),de.a.Observable.of(e)});return t?s:de.a.Observable.concat(s,c).last()};de.a.Observable.from(n.accountList).flatMap(function(e,t){return a(e,t)}).subscribe(function(n){t||(n.err?e.postMessage({action:"check",index:n.index,status:-1}):e.postMessage({action:"check",index:n.index,status:0,isLogin:n.isLogin}))},function(e){},function(){if(t){var a=n.accountList.map(function(e){return Yt.getCookie(e.aId)});e.postMessage({action:"init-done",cookies:a})}else e.postMessage({action:"done"})})}else"clearCookie"===n.action&&Yt.setCookie(n.aId,"",!0)};e.onMessage.addListener(n),e.onDisconnect.addListener(function(){console.log("port disconnected"),e.onMessage.removeListener(n)})}},{key:"loginAccount",value:function(e){var t=function(t){switch(t.action){case"login":var n=t.account;$e.getCookie(y.a.convertPlatCode(n.platformCode),n.aId,"sync",function(a,o,r){if(0===a){var i=y.a.convertPlatCode(n.platformCode),s=y.a.genOpenMpUrl(i);Vt.openMp(i,{url:s,loginInfo:o,platName:i,mpName:n.nickname,cookies:r,aId:n.aId,uniqueId:n.uniqueId},function(a){var o=void 0;o="tt"===i?Yt.getCookie(n.aId,"sso"):Yt.getCookie(n.aId),Wt[a]={index:t.index,aId:n.aId,port:e},Jt[a]=new Fe(a,s,o,{plat:i,name:n.nickname},{onCookieModified:function(e){"tt"===i?Yt.setCookie(n.aId,e,!0,"sso"):Yt.setCookie(n.aId,e,!0)},onDestroy:function(){delete Jt[a]}})})}})}};e.onMessage.addListener(t),e.onDisconnect.addListener(function(){console.log("port disconnected"),e.onMessage.removeListener(t)})}},{key:"checkAccountAuth",value:function(e){var t=function(t){if("start"===t.action){console.log("check auth status start");de.a.Observable.from(t.accountList).flatMap(function(e,n){if(e.needCheckAuth&&0===e.loginStatus){var a=y.a.convertPlatCode(e.platformCode),o=null;return"tt"===a&&(o=new vt(e,{},n)),null!==o?de.a.Observable.fromPromise(o.checkAuth().then(function(e){return k.a.resolve({status:0,auth:!0,index:n})},function(a){if(a.res){if(t.isRecheck)try{Qe(e,{errDes:"头条重新验证权限失败",step:"tt-recheck-auth",cookie:Yt.getCookie(e.aId)})}catch(a){console.log("recheck-auth err report fail"),console.log(a)}return k.a.resolve({status:0,auth:!1,url:a.res.reason.redirect_url,msg:a.msg,index:n})}return k.a.resolve({status:-1,auth:!1,url:"",index:n})})):de.a.Observable.of({status:-1,index:n})}return de.a.Observable.of({status:-2,index:n})}).subscribe(function(t){-1===t.status?e.postMessage({action:"check",index:t.index,status:-1}):-2===t.status?e.postMessage({action:"check",index:t.index,status:-2}):e.postMessage({action:"check",index:t.index,status:0,auth:t.auth,url:t.url||""})},function(e){},function(){console.log("auth check complete"),e.postMessage({action:"done"})})}};e.onMessage.addListener(t),e.onDisconnect.addListener(function(){console.log("port disconnected"),e.onMessage.removeListener(t)})}},{key:"checkAccountAuthV2",value:function(e){var t=function(t){if("start"===t.action||"recheck"===t.action){console.log("check auth status start");var n=t.accountList.map(function(e){return Yt.getCookie(e.aId)});e.postMessage({action:"init-done",cookies:n})}};e.onMessage.addListener(t),e.onDisconnect.addListener(function(){console.log("port disconnected"),e.onMessage.removeListener(t)})}},{key:"authAccount",value:function(e){var t=function(t){switch(t.action){case"auth":var n=t.account,a=y.a.convertPlatCode(n.platformCode),o=y.a.getPlatUrl(a),r=y.a.getDomain(a),i=void 0;i="tt"===a?Yt.getCookie(n.aId,"sso"):Yt.getCookie(n.aId),je.setPlatcookie(a,i,o,r,function(){Vt.openMp(a,{url:t.url,pageScript:"",platName:a,mpName:n.nickname,cookies:i,aId:n.aId,uniqueId:n.uniqueId},function(o){$t[o]={index:t.index,aId:n.aId,port:e},Jt[o]=new Fe(o,t.url,i,{plat:a,name:n.nickname},{onCookieModified:function(e){e.indexOf("_mp_auth_key")>-1?Yt.setCookie(n.aId,e,!0):Yt.setCookie(n.aId,e,!0,"sso")},onDestroy:function(){delete Jt[o]}})})})}};e.onMessage.addListener(t),e.onDisconnect.addListener(function(){console.log("port disconnected"),e.onMessage.removeListener(t)})}},{key:"publishAll",value:function(t){var n=function(n){switch(n.action){case"start":console.log("开始发布"),e.publish(n.data,function(e,n,a,o){t.postMessage({action:"singlePublish",index:n,status:e,url:a,articleData:o})},function(e,a,o,r){if(r&&r.account&&r.content&&r.content.errDes)try{r.content.cookie=Yt.getCookie(r.account.aId),r.content.articleOriUrl=n.data.article.url,Qe(r.account,r.content)}catch(e){console.log("publish err report fail"),console.log(r.content),console.log(e)}t.postMessage({action:"singlePublish",index:a,status:e,errMsg:o})},function(){t.postMessage({action:"publishDone"})})}};t.onMessage.addListener(n),t.onDisconnect.addListener(function(){console.log("publish port disconnected"),t.onMessage.removeListener(n)})}},{key:"publish",value:function(e,t,n,a){de.a.Observable.from(e.accountList).flatMap(function(t,n){var a=y.a.convertPlatCode(t.platformCode),o=void 0;switch(a){case"op":o=new ft(t,e.article,n);break;case"tt":o=new vt(t,e.article,n);break;case"qe":o=new _t(t,e.article,n);break;case"wy":o=new Ct(t,e.article,n);break;case"bj":o=new Lt(t,e.article,n);break;case"js":o=new Ht(t,e.article,n);break;case"wb":o=new Mt(t,e.article,n);break;case"sh":o=new Ft(t,e.article,n);break;default:o=null}return null===o?de.a.Observable.of({status:0,index:n}):de.a.Observable.fromPromise(o.doPublish()).catch(function(e){return console.log(e),de.a.Observable.of(e)})}).subscribe(function(e){console.log("publish next"),0===e.status?t(e.status,e.index,e.url,e.articleData):n(e.status,e.index,e.msg,e.err||void 0)},function(e){},function(){console.log("complete"),a()})}},{key:"addWebListener",value:function(){console.log("add web listener"),chrome.webRequest.onBeforeSendHeaders.addListener(Qt,{urls:zt},["blocking","requestHeaders"]),chrome.webRequest.onHeadersReceived.addListener(Zt,{urls:zt},["blocking","responseHeaders"])}},{key:"removeWebListener",value:function(){console.log("remove web listener"),chrome.webRequest.onBeforeSendHeaders.removeListener(Qt),chrome.webRequest.onHeadersReceived.removeListener(Zt)}}]),e}(),tn=en,nn=function(e,t){for(var n=arguments.length,a=Array(n>2?n-2:0),o=2;o<n;o++)a[o-2]=arguments[o];for(var r="",i=0;i<a.length;i++){var s=a[i];if(s instanceof DocumentFragment){var c=document.createElement("div");c.appendChild(a[i]),s=c.innerHTML}s="string"==typeof s?'"'+s.replace(/(\r\n|\r|\n|\t|\v|\f)/gm,"").replace(/"/g,'\\"')+'"':"object"===(void 0===s?"undefined":Te()(s))?f()(s):s.toString(),r+=s,i<a.length-1&&(r+=","),r=r.replace(/\\\\"/g,'\\"')}return'UE.getEditor("'+("wx"===e?"js_editor":e)+'")'+(t.member?"."+t.member:"")+'["'+t.method+'"]('+r+");"},an=new $e,on=function(e){var t="";switch(e){case"tt":t="https://mp.toutiao.com/profile_v3/graphic/publish";break;case"op":t="https://mp.yidianzixun.com/#/Writing/articleEditor";break;case"qe":t="https://om.qq.com/article/articlePublish";break;case"bj":t="http://baijiahao.baidu.com/builder/rc/edit?type=news";break;case"wb":t="https://card.weibo.com/article/v3/editor";break;case"wy":t="http://mp.163.com/article/postpage/";break;case"sh":t="https://mp.sohu.com/v2/main/news/add.action";break;case"js":t="http://www.jianshu.com/writer#/"}return t},rn=function(e,t){var n="";switch(e){case"tt":n="https://mp.toutiao.com/profile_v3/graphic/publish/?pgc_id="+t;break;case"op":n="https://mp.yidianzixun.com/#/Writing/"+t;break;case"qe":n="https://om.qq.com/article/articlePublish?articleId="+t+"&atype=0";break;case"bj":n="http://baijiahao.baidu.com/builder/rc/edit?type=news&article_id="+t;break;case"wb":n="https://card.weibo.com/article/v3/editor#/draft/"+t;break;case"wy":n="http://mp.163.com/article/editpage/"+t+".html";break;case"sh":n="https://mp.sohu.com/v2/main/news/edit.action?id="+t;break;case"js":n="http://www.jianshu.com/writer#/notebooks/"+t.split("-")[0]+"/notes/"+t.split("-")[1]}return n},sn="var mask = document.createElement('div'); mask.setAttribute('class', 'xmt-sync-lite-mask'); mask.setAttribute('style', 'z-index: 999999');\nvar popup = document.createElement('div');\npopup.setAttribute('class', 'xmt-sync-lite-popup');\npopup.setAttribute('style', 'z-index: 9999999;');\npopup.innerHTML = '<p class=\"xmt-sync-lite-title\">正在处理</p><p class=\"xmt-sync-lite-content\">请稍候...</p>';\ndocument.body.appendChild(mask);document.body.appendChild(popup);",cn=function(e,t){return"if(document.querySelector('.xmt-sync-lite-mask')){document.body.removeChild(document.querySelector('.xmt-sync-lite-mask'));document.body.removeChild(document.querySelector('.xmt-sync-lite-popup'));}\n    var mask = document.createElement('div'); mask.setAttribute('class', 'xmt-sync-lite-mask'); mask.setAttribute('style', 'z-index: 999999');\n    var popup = document.createElement('div');\n    popup.setAttribute('class', 'xmt-sync-lite-popup');\n    popup.setAttribute('style', 'z-index: 9999999;');\n    popup.innerHTML = '<p class=\"xmt-sync-lite-title\">"+(e?"采集成功":"采集失败")+'</p><p class="xmt-sync-lite-content">'+(t||(e?"请手动发布进行推送":"发送失败"))+"</p><button id=\"xmt-sync-lite-close\">确定</button>';\n    document.body.appendChild(mask);document.body.appendChild(popup);\n    popup.querySelector('#xmt-sync-lite-close').addEventListener('click', function(){\n      document.body.removeChild(mask);document.body.removeChild(popup);\n    })"},un=function(){function e(t,n,a){X()(this,e),this.articleData=t,this.accountData=n,a&&(this.tabId=a)}return K()(e,[{key:"getPublisher",value:function(e){var t=void 0;switch(e){case"op":t=new ft(this.accountData,this.articleData,0);break;case"tt":t=new vt(this.accountData,this.articleData,0);break;case"qe":t=new _t(this.accountData,this.articleData,0);break;case"wy":t=new Ct(this.accountData,this.articleData,0);break;case"bj":t=new Lt(this.accountData,this.articleData,0);break;case"js":t=new Ht(this.accountData,this.articleData,0);break;case"wb":t=new Mt(this.accountData,this.articleData,0);break;case"sh":t=new Ft(this.accountData,this.articleData,0);break;default:t=null}return t}},{key:"processImg",value:function(){var e=this;if(this.articleData.processedContent)return this.articleData.content=this.articleData.processedContent,k.a.resolve();var t=this.getPublisher(this.accountData.platform),n=void 0,a=1;return"wy"===this.accountData.platform?a=10:"qe"===this.accountData.platform?a=5:"wb"!==this.accountData.platform&&"sh"!==this.accountData.platform||(a=10),n=function(){return t.processImg.call(t,a,!0)},n().then(function(t){e.articleData.content=t})}},{key:"createDraft",value:function(){var e=this,t=this.getPublisher(this.accountData.platform);if(t)return t.createDraft().then(function(e){return k.a.resolve(e)},function(n){return t.processedContent&&(e.articleData.processedContent=t.processedContent),k.a.reject(n)}).catch(function(e){return k.a.reject(e)})}},{key:"injectScripts",value:function(){chrome.tabs.executeScript(this.tabId,{file:"static/js/content-scripts/sync-lite/editorScript.entry.js"}),chrome.tabs.executeScript(this.tabId,{file:"static/js/content-scripts/sync-lite/editorScript.bundle.js"}),chrome.tabs.executeScript(this.tabId,{code:sn,runAt:"document_end"}),chrome.tabs.executeScript(this.tabId,{file:"static/js/content-scripts/sync-lite/"+this.accountData.platform+"Editor.entry.js",runAt:"document_end"}),chrome.tabs.executeScript(this.tabId,{file:"static/js/content-scripts/sync-lite/"+this.accountData.platform+"Editor.bundle.js",runAt:"document_end"})}},{key:"sendArticle",value:function(){var e=this,t="";return"tt"!==this.accountData.platform&&"qe"!==this.accountData.platform&&"bj"!==this.accountData.platform&&"sh"!==this.accountData.platform||(t=nn("editorIdPlaceholder",{method:"setContent"},this.articleData.content),t+="var editor = UE.getEditor('editorIdPlaceholder');var setContentCallback = function(type, e){e.preventDefault();editor.removeListener('setContent', setContentCallback)};editor.addListener('setContent', setContentCallback)"),this.processImg().then(function(){return new k.a(function(n,a){var o=function o(r,i,s){i.tab.id===e.tabId&&("sync-lite-get-article"===r?s({data:e.articleData,UEScript:t}):"sync-lite-get-article-succ"===r?(chrome.tabs.executeScript(e.tabId,{code:cn(!0,"请手动发布进行推送（发文实际样式可能不一致，发文前请注意预览）")},function(){n()}),chrome.runtime.onMessage.removeListener(o)):"sync-lite-get-article-fail"===r&&(chrome.tabs.executeScript(e.tabId,{code:cn(!0,"同步失败")},function(){a()}),chrome.runtime.onMessage.removeListener(o)))};chrome.runtime.onMessage.addListener(o),setTimeout(function(){chrome.runtime.onMessage.removeListener(o)},2e4),e.injectScripts()})})}}]),e}(),ln=function(){var e={},t=[];chrome.extension.onRequest.addListener(function(n,a,o){switch(n.operation){case"sync-lite-article":qe.collect(n.url).then(function(e){if("succ"===e.status){var t=e.data;t.content=qe.thirdPlatFilter(t.content),o({status:"succ",url:n.url,data:t})}else o({status:"fail"})},function(e){o({status:"error"})});break;case"sync-lite-edit":if(n.needLogin)return an.openMp(n.platform,{url:y.a.genOpenMpUrl(n.platform),pageScript:n.getCookieRes.script,loginInfo:n.loginInfo,platName:n.platform,mpName:"",cookies:"",aId:n.aId,uniqueId:n.uniqueId},function(a){e[a]=new un(n.articleData,{platform:n.platform,aId:n.aId,uniqueId:n.uniqueId},a),t.push(a)}),void o({status:-3});var r=new un(n.articleData,{platform:n.platform,aId:n.aId,uniqueId:n.uniqueId}),i=function(e){var t=on(n.platform);"wy"===n.platform&&(t+=n.uniqueId),chrome.tabs.create({url:t},function(t){r.tabId=t.id,r.sendArticle().then(function(){r=null,o({status:0,res:e})},function(){r=null,o({status:-1,res:e})})})};r.createDraft().then(function(e){if(0===e.status){ae({type:"action",name:"sync-lite-succ",platform:n.platform});var t=rn(n.platform,e.id);chrome.tabs.create({url:t},function(e){chrome.tabs.executeScript(e.id,{file:"static/js/content-scripts/sync-lite/editorScript.entry.js"}),chrome.tabs.executeScript(e.id,{file:"static/js/content-scripts/sync-lite/editorScript.bundle.js"}),chrome.tabs.executeScript(e.id,{code:cn(!0)}),r=null}),o({status:0,res:e})}},function(e){i(e)}).catch(function(e){i(e)});break;case"setCookie":if(t.indexOf(a.tab.id)>-1&&e[a.tab.id]){chrome.tabs.executeScript(a.tab.id,{file:"static/js/content-scripts/sync-lite/editorScript.entry.js"}),chrome.tabs.executeScript(a.tab.id,{file:"static/js/content-scripts/sync-lite/editorScript.bundle.js"},function(){chrome.tabs.executeScript(a.tab.id,{code:sn,runAt:"document_end"})}),t.splice(t.indexOf(a.tab.id),1);var s=e[a.tab.id],c=function(){var t=on(n.platform);"wy"===n.platform&&(t+=n.uniqueId),chrome.tabs.update(a.tab.id,{url:t},function(n){var r=function(r,i,c){c.id===n.id&&c.url===t&&"complete"===i.status&&s.sendArticle().then(function(){s=null,e[a.tab.id]=null},function(){s=null,o({status:-1})})};chrome.tabs.onUpdated.addListener(r)})};s.createDraft().then(function(t){0===t.status&&(ae({type:"action",name:"sync-lite-succ",platform:n.platform}),chrome.tabs.update(a.tab.id,{url:rn(s.accountData.platform,t.id)},function(t){var n=function e(n,a,o){o.id===t.id&&"complete"===a.status&&(chrome.tabs.executeScript(n,{file:"static/js/content-scripts/sync-lite/editorScript.entry.js"}),chrome.tabs.executeScript(n,{file:"static/js/content-scripts/sync-lite/editorScript.bundle.js"}),chrome.tabs.executeScript(n,{code:cn(!0)}),chrome.tabs.onUpdated.removeListener(e))};chrome.tabs.onUpdated.addListener(n),s=null,e[a.tab.id]=null}))},function(e){c()}).catch(function(e){c()})}}return!0}),chrome.tabs.onRemoved.addListener(function(n){t.indexOf(n)>-1&&(console.log("sync-lite: 登录因关闭中断"),t.splice(t.indexOf(n),1),e[n]=null)}),chrome.tabs.onUpdated.addListener(function(n,a){if(t.indexOf(n)>-1&&e[n]){var o=a.url,r=/xui.ptlogin2.qq.com\/cgi-bin\/xlogin.*appid=716027609/,i=/api.weibo.com\/oauth2\/authorize.*client_id=2504490989/,s=/open.weixin.qq.com\/connect\/qrconnect.*appid=wx4dd648e754458dfe/,c=/login.taobao.com\/member\/login.jhtml.*redirect_url=.*weibo.com/;(r.test(o)||i.test(o)||s.test(o))&&"tt"===e[n].accountData.platform?console.log("sync-lite: 头条第三方登录"):c.test(o)&&"wb"===e[n].accountData.platform?console.log("sync-lite: 微博第三方登录"):void 0===a.url||a.url.match(y.a.getDomain(e[n].accountData.platform))||(console.log("sync-lite: 登录因跳转中断"),t.splice(t.indexOf(n),1),e[n]=null)}})},dn=[],mn=new tt,pn=new $e,hn={},fn=function(e){if(-1!==e.tabId)return{requestHeaders:e.requestHeaders};for(var t=e.requestHeaders,n=0;n<t.length;n++)if("X-Xmt-SyncHistory-Aid"===t[n].name){for(var a=t[n].value,o=t.length-1;o>=0;o--)if("cookie"===t[o].name.toLowerCase()){t[o].value=mn.getCookie(a);break}break}return{requestHeaders:t}},gn=function(e){e?chrome.webRequest.onBeforeSendHeaders.addListener(fn,{urls:dn},["blocking","requestHeaders"]):chrome.webRequest.onBeforeSendHeaders.removeListener(fn)},bn=function(){gn(!0),chrome.runtime.onMessageExternal.addListener(function(e,t,n){return"syncHistory-listener"===e.event?(gn(!1),dn=e.blockList,gn(!0)):"syncHistory-getArticles"===e.event?(console.log(e),b.a.ajax(e.options).then(function(e){n({status:0,data:e})},function(e){n({status:-1,data:e})})):"syncHistory-checkLogin"===e.event?tn.checkAccountLogin(port,!0):"syncHistory-openMp"===e.event&&$e.getCookie(y.a.convertPlatCode(e.account.platformCode),e.account.aId,"sync",function(t,n,a){if(0===t){var o=y.a.convertPlatCode(e.account.platformCode);pn.openMp(o,{url:e.openUrl,loginInfo:n,platName:o,mpName:e.account.nickname,cookies:a,aId:e.account.aId,uniqueId:e.account.uniqueId})}}),!0}),chrome.runtime.onConnectExternal.addListener(function(e){"syncHistory-login"===e.name&&(e.onMessage.addListener(function(t){if("login"===t.action){var n=t.account;$e.getCookie(y.a.convertPlatCode(n.platformCode),n.aId,"sync",function(t,a,o){if(0===t){var r=y.a.convertPlatCode(n.platformCode),i=y.a.genOpenMpUrl(r);pn.openMp(r,{url:i,loginInfo:a,platName:r,mpName:n.nickname,cookies:o,aId:n.aId,uniqueId:n.uniqueId},function(t){hn[t]={aId:n.aId,port:e}})}})}}),e.onDisconnect.addListener(function(){console.log("sync history login port disconnected")}))}),chrome.extension.onRequest.addListener(function(e,t,n){if("setCookie"===e.operation){var a=hn[t.tab.id];if(a){var o=function(e,n){mn.setCookie(e.aId,n,!1),e.port.postMessage({action:"login",status:"succ",aId:e.aId}),chrome.tabs.remove(t.tab.id),chrome.tabs.update(e.port.sender.tab.id,{active:!0}),delete hn[t.tab.id]};"qe"===e.platform?o(a,e.cookies):"tt"===e.platform?je.getCookies_new("https://mp.toutiao.com",y.a.getPlatCookie("tt"),function(e){var t=e.map(function(e){return e.name+"="+e.value}).join(";");o(a,t)}):je.getCookies(y.a.getPlatUrl(e.platform),y.a.getPlatCookie(e.platform),function(e){o(a,e)})}}})},vn=function(e,t,n){for(var a=[],o=0;o<t.length;o++)a.push(wn(t[o]));return k.a.all(a).then(function(t){console.log(t),t.map(function(e){e.err&&console.log(e.err)}),n(e.innerHTML)})},wn=function(e){return new k.a(function(t){var n=0;!function a(){n+=1,b.a.ajax("https://mp.toutiao.com/tools/catch_picture/?&",{type:"POST",data:{upfile:e.src,version:2}}).then(function(o){o.url?(e.src=o.url,t({url:o.url})):n<4?a():(e.remove(),t({err:o}))},function(o){n<4?a():(e.remove(),t({err:o}))})}()})},kn={init:function(){this.addListener()},addListener:function(){var e=this;chrome.extension.onRequest.addListener(function(t,n,a){if("ttCollect"===t.operation){switch(t.from){case"wx":qe.collect(t.url).then(function(e){if("succ"===e.status){var t=e.data,n=qe.thirdPlatFilter(t.content),o=document.createElement("section");o.innerHTML=n;var r=b()(o).find("img");vn(o,r,function(e){t.content=e,a(p()({status:"succ"},t))})}else a({status:"fail"})},function(){a({status:"error"})});break;case"tt":e.ttCollect(t.url).then(function(e){if("succ"===e.status){var t=e.data;a(p()({status:"succ"},t))}else a({status:"fail"})},function(){a({status:"error"})})}return!0}})},ttCollect:function(e){return b.a.get(e).then(function(e){if(null!==new RegExp("articleInfo:").exec(e)){var t=/articleInfo:\s?({\s*?title:(.|\s)*?}),\s*?commentInfo/.exec(e)[1],n=/title:\s?('|")(.*)('|")/.exec(t)[2],a=/content:\s?('|")(.*)('|")/.exec(t)[2];return k.a.resolve({status:"succ",data:{content:a,title:n}})}return k.a.resolve({status:"fail",data:e})})}},_n=function(){function e(){X()(this,e),this.addListener()}return K()(e,[{key:"addListener",value:function(){chrome.tabs.onUpdated.addListener(function(e,t,n){if("complete"===t.status&&n.url.match(_.a.urls.ZAN_LOGIN)){var a=parseInt(y.a.getQueryString("tabId",n.url));setTimeout(function(){chrome.tabs.remove(e,function(){console.log("remove")}),chrome.tabs.sendMessage(a,{action:"xmt-zan-init"})},1e3)}}),chrome.extension.onRequest.addListener(function(e){switch(e.operation){case"notLogin":return chrome.tabs.query({},function(e){for(var t=0;t<e.length;t++)if(e[t].active)return void chrome.tabs.create({url:_.a.urls.ZAN_HOST+"/login?tabId="+e[t].id})}),!0}})}}]),e}(),yn=_n,xn={},Cn=[];xn.init=function(){b.a.ajax({url:_.a.urls.API_HOST+"/api/extension/apps/domains",type:"GET",dataType:"json"}).then(function(e){0===e.base_resp.ret&&(Cn=e.domians)}),chrome.tabs.onUpdated.addListener(function(e,t,n){if("complete"===t.status){var a=n.url,o=n.title;Cn.indexOf(Sn(a))>-1&&b.a.ajax({url:_.a.urls.API_HOST+"/api/extension/apps/links/log",type:"POST",data:{url:a,title:o},dataType:"json"}).then(function(e){console.log(e)})}})};var Sn=function(e){var t=new RegExp(/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)/),n=t.exec(e);return null!==n?n[2]:(console.log("统计应用中心应用访问次数 => 获取当前tab中url的host, url匹配失败"),console.log(e),"")};xn.checkDomain=function(){b.a.ajax({url:_.a.urls.API_HOST+"/api/extension/apps/domains",type:"GET",dataType:"json"}).then(function(e){0===e.base_resp.ret&&Cn!==e.domians&&(Cn=e.domians)})};var In=xn,Tn={},Dn={"www.yunduimedia.com":"云堆","gongfudou.com":"功夫豆","lomoment.com":"时光机","my.weimob.com":"微盟","sh.so.tedu.cn":"达内网络营销学院（涨粉营销等相关课程售卖）","www.ybhlw.org":"会宜网络（微信营销策划、代运营等）","t.wxb.com":"微小宝","www.315pr.com":"三点一刻","www.jinniugengyun.com":"金牛微信营销推广平台","www.cn-com.com.cn":"微当家","hd.faisco.com":"凡科","www.85575.com":"不知道叫啥的刷粉刷阅读的网站","tt.jnzhychm.com":"不知道叫啥的跟广点通相关的网站","qq.bjyunrui.com":"不知道叫啥的跟广点通相关的网站","e.qq.com":"广点通","www.zhangfenba.com":"涨粉吧","51youfen.com":"51优粉","www.joinman.cn":"聚盟信息科技","www.jumkj.com":"聚盟信息科技","www.zhangfenba.cn":"牛粉吧","www.26aa.cn":"6涨粉吧","www.918map.com":"慧动科技","www.yaojinhe.com":"摇金盒","www.uboxsale.com":"友宝","www.365zf.wang":"涨粉王","www.gzhitui.com":"广之推","scrm.ecbao.cn":"电商宝","a.newrank.cn":"新榜","www.shenzan.com":"神赞","www.weixinyunduan.com":"腾讯云端","www.jimob.com.cn":"极盟","www.24haowan.com":"24好玩互动营销","www.youfenba.com":"优粉吧","www.yeezan.com":"易赞","gz.xiaoi.com":"公众宝","shequ.yunzhijia.com":"云之家","tui.younle.com":"乐推微","www.idouzi.com":"爱豆子","www.youfengwo.com":"有蜂窝","www.bangtuike.com.cn":"帮推客","www.iweizhijia.com":"微之家","www.weixiaoxin.com":"微小信","wx.weiweixiao.net":"微微校","www.weifenshi.cn":"微粉师","www.xiongdada.com.cn":"熊大大电小盒","www.weiqudao.net":"微运营"},An=[],jn=window.localStorage.getItem("xmt_fans_domain");null!==jn&&(An=JSON.parse(jn));var En=function(e){return new RegExp(/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/).exec(e)[2]},On=function(e,t,n){if("complete"===t.status){var a=window.localStorage.getItem("wx_uniqueId");if(null===a)return;var o=n.url,r=En(o),i=n.title;if(r in Dn){var s={domain:r,domainName:Dn[r],domainDesc:i,accessDate:y.a.getFormattedDate()};An.push(s),b.a.ajax({url:_.a.urls.API_HOST+"/api/tj/domain?uniqueId="+a,type:"POST",contentType:"application/json;charset=utf-8;charset=UTF-8",data:f()(An)}),An=[],window.localStorage.setItem("xmt_fans_domain","[]")}}};Tn.init=function(){chrome.tabs.onUpdated.addListener(On)},Tn.stop=function(){An=[],window.localStorage.setItem("xmt_fans_domain","[]"),chrome.tabs.onUpdated.removeListener(On)};var Ln=Tn,Un={},qn=[".*涨.*粉.*",".*加.*粉.*",".*增.*粉.*",".*微信.*粉.*",".*刷.*粉.*",".*刷.*赞.*",".*刷.*留言.*"],Hn=0,Nn=function(){var e=Date.parse(new Date)/1e3;e-Hn>600&&b.a.ajax({url:_.a.urls.API_HOST+"/api/tj/get_keyword_patterns",type:"GET",dataType:"json"}).then(function(t){0===t.base_resp.ret&&(qn=t.keywords,Hn=e)})},Pn=[],Rn=window.localStorage.getItem("xmt_search_keyword");null!==Rn&&(Pn=JSON.parse(Rn));var Mn=function(e){return new RegExp(/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/).exec(e)[2]},Bn=function(e,t,n){var a=y.a.getQueryString(t,e);Fn(e,a,n)},Gn=function(e,t,n){var a=t.exec(e)[1];Fn(e,a,n)},Fn=function(e,t,n){for(var a=t.replace(/\s+/g,"").replace(/[\@\#\$\%\^\+\&\*\{\}\:\"\L\<\>\?]/,""),o=0;o<qn.length;o++){if(new RegExp(qn[o]).test(a)){var r={keyword:a,domain:Mn(e),domainDesc:n,searchDate:y.a.getFormattedDate()};return Pn.push(r),void window.localStorage.setItem("xmt_search_keyword",f()(Pn))}}},Yn=function(e,t){if(e.match("www.baidu.com")||e.match("so.tv.sohu.com")||e.match("so.le.com"))Bn(e,"wd",t);else if(e.match("www.sogou.com"))Bn(e,"query",t);else if(e.match("taobao.com")||e.match("www.zhihu.com")||e.match("www.so.com")||e.match("cn.bing.com")||e.match("www.chinaso.com")||e.match("www.google.com")||e.match("www.douban.com")||e.match("v.qq.com")||e.match("v.youmi.cn"))Bn(e,"q",t);else if(e.match("tieba.baidu.com"))Bn(e,"prequery",t);else if(e.match("www.youdao.com")){var n=new RegExp("eng\\/(.*)\\/");Gn(e,n,t)}else if(e.match("s.weibo.com")){var a=decodeURI(e),o=new RegExp("weibo\\/(.*)\\&");Gn(a,o,t)}else if(e.match("www.toutiao.com")||e.match("www.soku.com")||e.match("search.bilibili.com")||e.match("study.163.com")||e.match("www.cctalk.com")||e.match("search.jd.com"))Bn(e,"keyword",t);else if(e.match("www.zaih.com"))Bn(e,"word",t);else if(e.match("ke.qq.com")){var r=new RegExp("list\\/(.*)");Gn(e,r,t)}else if(e.match("www.icourse163.org"))Bn(e,"search",t);else if(e.match("www.genshuixue.com")){var i=new RegExp("st-(.*)\\.");Gn(e,i,t)}else if(e.match("class.hujiang.com"))Bn(e,"k",t);else if(e.match("ke.youdao.com")){var s=new RegExp("search\\/(.*)");Gn(e,s,t)}else if(e.match("so.iqiyi.com")){var c=new RegExp("q_(.*)\\?");Gn(e,c,t)}else if(e.match("search.pptv.com"))Bn(e,"kw",t);else if(e.match("www.fun.tv"))Bn(e,"word",t);else if(e.match("www.ximalaya.com")){var u=new RegExp("kw\\/(.*)\\/");Gn(e,u,t)}else if(e.match("36kr.com")){var l=new RegExp("articles\\/(.*)\\?");Gn(e,l,t)}else if(e.match("www.huodongxing.com"))Bn(e,"qs",t);else if(e.match("www.vko.cn")||e.match("search.dangdang.com"))Bn(e,"key",t);else if(e.match("www.qingting.fm")){var d=new RegExp("all\\/(.*)");Gn(e,d,t)}else e.match("www.newrank.cn")&&Bn(e,"value",t)},zn=function(e){Nn();var t=window.localStorage.getItem("wx_uniqueId");if(null!==t){var n=e.url;n=n.match("www.newrank.cn")?unescape(n):decodeURI(e.url),chrome.tabs.get(e.tabId,function(e){Yn(n,e.title),Pn.length>=1&&(b.a.ajax({url:_.a.urls.API_HOST+"/api/tj/search_word?uniqueId="+t,type:"POST",contentType:"application/json;charset=utf-8;charset=UTF-8",data:f()(Pn)}),Pn=[],window.localStorage.setItem("xmt_search_keyword","[]"))})}},Vn=y.a.throttle(zn,2e3,{leading:!1});Un.init=function(){chrome.webRequest.onBeforeRequest.addListener(Vn,{urls:v.a.searchBlockList},["blocking"])},Un.stop=function(){Pn=[],window.localStorage.setItem("xmt_search_keyword","[]"),chrome.webRequest.onBeforeRequest.removeListener(Vn)};var Xn=Un,Jn=function(){chrome.webRequest.onBeforeRequest.addListener(function(e){console.log(e.requestBody.formData);var t=e.url.match(/&token=(\d*?)(&|$)/)[1];if(e.requestBody.formData.appmsgid&&"10"===e.requestBody.formData.type[0]){var n=e.requestBody.formData.appmsgid[0],a=0;b.a.get("https://mp.weixin.qq.com/cgi-bin/appmsg?t=media/appmsg_edit&action=edit&lang=zh_CN&token="+t+"&type=10&appmsgid="+n+"&isMul=1&f=json").then(function(e){if(0===e.base_resp.ret){var t=JSON.parse(e.app_msg_info);a=t.item[0].multi_item.length}ae({type:"action",name:"wx-masssend",msgId:n,articleCount:a})},function(){ae({type:"action",name:"wx-masssend",msgId:n,articleCount:a})})}},{urls:["*://mp.weixin.qq.com/cgi-bin/masssend?t=ajax-response&token=*"]},["requestBody"])},Kn={getWholeList:function(){return b.a.ajax(_.a.urls.API_HOST+"/api/hot_update/entry?extver="+v.a.version,{type:"GET",dataType:"json"}).then(function(e){if(0===e.base_resp.ret){if(0===e.entry.length)return k.a.reject(e);var t={};return e.entry.map(function(e){t[e.name]=e.url}),k.a.resolve(t)}return k.a.reject(e)},function(e){return k.a.reject(e)})},getModule:function(e){return b.a.ajax(e,{type:"GET",dataType:"html"}).then(function(e){return k.a.resolve(e)},function(e){return k.a.reject(e)})},getVer:function(e){return b.a.ajax(_.a.urls.API_HOST+"/api/hot_update/version?extver="+v.a.version+"&curver="+(e||""),{type:"GET",dataType:"json"}).then(function(e){return 0===e.base_resp.ret?k.a.resolve(e.version):k.a.reject(e)},function(e){return k.a.reject(e)})}},Wn=n(881),$n=n.n(Wn);window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var Qn=function(e){return new k.a(function(t,n){de.a.Observable.from(ne()(e)).flatMap(function(t){return de.a.Observable.fromPromise($n.a.setItem(t,e[t]).then(function(e){return k.a.resolve({status:0,moduleName:t})},function(e){return k.a.reject()})).catch(function(e){return de.a.Observable.of({status:-1,moduleName:t})})}).subscribe(function(e){e.status},function(e){},function(){t()})})},Zn=function(e){return $n.a.getItem(e).then(function(t){return null!==t?k.a.resolve(t):k.a.reject({code:-2,msg:e+"模块不存在"})}).catch(function(t){return console.log(t),k.a.reject({code:-1,msg:e+"模块获取失败"})})},ea=function(){function e(){X()(this,e),console.log("new code storage instant")}return K()(e,null,[{key:"saveCode",value:function(e){return Qn(e)}},{key:"getCode",value:function(e){return Zn(e)}}]),e}(),ta=ea,na=n(882),aa=n.n(na),oa="xmt-hot-update-version",ra={},ia={},sa=function(){function e(){X()(this,e),e.update().then(function(){e.checkUpdate()}),chrome.runtime.onMessage.addListener(function(t,n,a){if("hotUpdate"===t.operation)if("getModule"===t.action)e.getModule(t.moduleName).then(function(e){chrome.tabs.executeScript(n.tab.id,{code:e}),a({status:0})},function(e){a({status:-1,msg:"模块不存在"})});else if("check"===t.action){var o=y.a.getStorage(oa);Kn.getVer(o).then(function(t){o&&o===t||e.update().then(function(){y.a.setStorage(oa,t),ae({type:"action",name:"hotupdate-update-done"})})},void 0)}return!0})}return K()(e,null,[{key:"checkUpdate",value:function(){var t=y.a.getStorage(oa);Kn.getVer(t).then(function(n){t&&t===n||e.update().then(function(){y.a.setStorage(oa,n),ae({type:"action",name:"hotupdate-update-done"})},function(){console.log("更新失败")})},void 0),setTimeout(function(){e.checkUpdate()},18e5)}},{key:"update",value:function(){return new k.a(function(e,t){ia={},ra={},Kn.getWholeList().then(function(n){ra=n,de.a.Observable.from(ne()(ra)).flatMap(function(e){var t=void 0;t=JSON.parse(y.a.getStorage("xmt-module-file-list"))||aa.a;var n=ra[e].split("/").slice(-1)[0].split(".js")[0];return t&&t[e]&&n===t[e]?de.a.Observable.of({status:-2,moduleName:e}):de.a.Observable.fromPromise(Kn.getModule(ra[e]).then(function(t){return{status:0,moduleName:e,code:t}})).catch(function(t){return de.a.Observable.of({status:-1,moduleName:e,err:t})})}).subscribe(function(e){0===e.status&&(ia[e.moduleName]=e.code)},function(e){},function(){ne()(ia).length>0?ta.saveCode(ia).then(function(){var t={};ne()(ra).map(function(e){t[e]=ra[e].split("/").slice(-1)[0].split(".js")[0]}),y.a.setStorage("xmt-module-file-list",f()(t)),e()},function(){console.log("code save failed"),t()}):e()})},function(e){e.base_resp&&console.log(e.msg),t()})})}},{key:"getModule",value:function(e){return new k.a(function(t,n){ta.getCode(e).then(function(e){t(e)},function(a){console.log(a),ae({type:"action",name:"hotupdate-get-from-db-fail",moduleName:e}),ra&&ra[e]?Kn.getModule(ra[e]).then(function(n){t(n);var a={};a[e]=n,ta.saveCode(a)},function(){n()}):n()})})}}]),e}(),ca=sa,ua={},la=function(e){var t=e.requestHeaders;return t.push({name:"x-api-key",value:"UvAXz2I9cyIVLkIAhhesn0e0Uuntd8DajJg3msxG"}),{requestHeaders:t}};ua.readabilityListener=function(){chrome.webRequest.onBeforeSendHeaders.addListener(la,{urls:v.a.readabilityBlockList},["blocking","requestHeaders"])},ua.removeReadabilityListener=function(){chrome.webRequest.onBeforeSendHeaders.removeListener(la())};var da=ua,ma=[],pa=[],ha=(function(){be.addListener(),chrome.extension.onRequest.addListener(function(e,t,n){if("search-fusion"===e.operation)switch(e.message){case"setIframeListener":-1===ma.indexOf(t.tab.id)&&ma.push(t.tab.id),n(!0)}return!0}),chrome.runtime.onMessageExternal.addListener(function(e,t,n){if("search-fusion"===e.feature)switch(e.message){case"request":e.requestOptions.url.indexOf("weixin.sogou.com")>-1&&be.searchListener(),b.a.ajax(e.requestOptions).then(function(e){n({status:0,data:e})},function(e){n({status:-1,data:e})}).always(function(){e.requestOptions.url.indexOf("weixin.sogou.com")>-1&&be.removeSearchListener()});break;case"getBaiduCt":b.a.ajax({url:"https://www.baidu.com",type:"get",dataType:"html"}).then(function(e){var t=/"(.*?)all_async_search(.*?)"/,a=e.match(t);a?b.a.ajax({url:a[0].replace(/"/g,""),type:"get",dataType:"html"}).then(function(e){var t=e.match(/"&ct=(\d*?)"/);n(t?t[1]:null)},function(e){n(null)}):n(null)});break;case"setIframeListener":-1===ma.indexOf(t.tab.id)&&ma.push(t.tab.id),n(!0);break;case"insertToutiaoJs":chrome.tabs.executeScript(t.tab.id,{allFrames:!0,runAt:"document_end",code:e.codeStr});break;case"addImgListener":-1===pa.indexOf(t.tab.id)&&pa.push(t.tab.id)}return!0}),chrome.webRequest.onHeadersReceived.addListener(function(e){if(ma.indexOf(e.tabId)>-1&&0!==e.frameId){for(var t=e.responseHeaders,n=-1,a=0;a<t.length;a++)if("x-frame-options"===t[a].name.toLowerCase()||"frame-options"===t[a].name.toLowerCase()){n=a;break}return n>-1&&t.splice(n,1),{responseHeaders:t}}},{urls:["*://*/*"],types:["sub_frame"]},["blocking","responseHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener(function(e){if(pa.indexOf(e.tabId)>-1){for(var t=e.requestHeaders,n=!1,a=0;a<t.length;a++)"Referer"===t[a].name&&(n=!0,t[a].value="http://weixin.sogou.com");return n||t.push({name:"Referer",value:"http://weixin.sogou.com"}),{requestHeaders:t}}},{urls:v.a.sogouImgUrl},["blocking","requestHeaders"])}(),function(){chrome.webRequest.onBeforeSendHeaders.addListener(function(e){for(var t=e.requestHeaders,n=0;n<t.length;n++)"referer"===t[n].name.toLowerCase()&&t[n].value.match("x.xmt.cn/styleCenter")&&(t[n].value="https://mp.weixin.qq.com");return{requestHeaders:t}},{urls:["https://mmbiz.qlogo.cn/mmbiz_png/*"]},["blocking","requestHeaders"])}(),function(){chrome.webRequest.onBeforeSendHeaders.addListener(function(e){for(var t=e.requestHeaders,n=0;n<t.length;n++)"Referer"===t[n].name&&(!0,t[n].value="https://www.douban.com");return{requestHeaders:t}},{urls:v.a.doubanImgUrl},["blocking","requestHeaders"])}(),n(883)),fa=n.n(ha),ga={PAGE_JUMPER_OPEN:"xmt-page-jumper_open",PAGE_JUMPER_RESPONSE:"xmt-page-jumper_response"},ba=new fa.a,va=function(e,t){if(e.event===ga.PAGE_JUMPER_OPEN){console.log(e);var n=t.tab.id;chrome.tabs.create({url:e.url},function(t){ba.set(t.id,{sourceTab:n,url:e.url}),console.log(ba)})}},wa=function(e,t){if(e.event===ga.PAGE_JUMPER_RESPONSE){var n=ba.get(t.tab.id);n&&(ba.delete(t.tab.id),!0===e.close&&chrome.tabs.remove(t.tab.id),chrome.tabs.update(n.sourceTab,{active:!0}),chrome.tabs.sendMessage(n.sourceTab,{event:ga.PAGE_JUMPER_RESPONSE,content:e.content}))}};chrome.runtime.onMessage.addListener(va),chrome.runtime.onMessageExternal.addListener(va),chrome.runtime.onMessage.addListener(wa),chrome.runtime.onMessageExternal.addListener(wa),chrome.tabs.onRemoved.addListener(function(e){ba.get(e)&&(console.log("removed"),ba.delete(e))}),chrome.tabs.onUpdated.addListener(function(e,t){console.log(t.url),ba.get(e)&&t.url&&t.url!==ba.get(e).url&&!1===/sso\.(195\.)?xmt\.cn/.test(t.url)&&(console.log("updated"),ba.delete(e))});var ka=n(898),_a=n.n(ka);!function(){var e=["skinv","mainv","listv","popv"],t=function(e,t,o,r){var i={url:"http://www.huishengqianzhushou.com/api/xmtgj",type:"post",data:{skinv:e,mainv:t,listv:o,popv:r},dataType:"json",success:function(e){e.length>0?a(e):n()},error:function(){n()}};b.a.ajax(i)},n=function(){var t=[];b.a.each(e,function(e,n){var a="hsq"+n+"data";chrome.storage.local.get([a],function(a){t[e]=b.a.isEmptyObject(a),"popv"==n&&(-1==b.a.inArray(!0,t)?r():o())})})},a=function(e){b.a.each(e,function(e,t){var n=t.name,a=t.url,o="release/"+n+".js",i="hsq"+n,s="hsq"+n+"data";b.a.ajax({type:"get",url:a,dataType:"html",success:function(e){chrome.storage.local.set(_a()({},s,e),function(){"skinv"==n&&r()}),chrome.storage.local.set(_a()({},i,t.version))},error:function(){chrome.storage.local.get([s],function(e){b.a.isEmptyObject(e)?b.a.get(o,function(e){chrome.storage.local.set(_a()({},s,e),function(){"skinv"==n&&r()})},"html"):"skinv"==n&&r()})}})})},o=function(){b.a.each(e,function(e,t){var n="hsq"+t,a="hsq"+t+"data",o="release/"+t+".js";b.a.get(o,function(e){chrome.storage.local.set(_a()({},a,e),function(){"skinv"==t&&r()}),chrome.storage.local.set(_a()({},n,"1.0.0.0"))},"html")})},r=function(){chrome.storage.local.get("hsqskinvdata",function(e){new Function(e.hsqskinvdata)()})};chrome.storage.local.get(function(e){var n=void 0!=e.hsqskinv?e.hsqskinv:"1.0.0.0",a=void 0!=e.hsqmainv?e.hsqmainv:"1.0.0.0",o=void 0!=e.hsqlistv?e.hsqlistv:"1.0.0.0",r=void 0!=e.hsqpopv?e.hsqpopv:"1.0.0.0";t(n,a,o,r)})}(),function(){new I.a({detectScreenOrientation:!1,excludeTimezoneOffset:!0,excludeAddBehavior:!0,excludeIEPlugins:!0}).get(function(e,t){chrome.cookies.set({url:"https://api.x.xmt.cn",name:"fingerprint",value:e})}),new ca,chrome.runtime.setUninstallURL("https://xmt.cn/plugin/uninstall?version="+v.a.version+"&date="+v.a.date),chrome.runtime.onInstalled.addListener(function(e){"install"===e.reason&&(y.a.browerOpenUrl("https://xmt.cn/plugin/install?from=install"),y.a.removeStorage(_.a.STORAGE_BIND_HINT_KEY)),"install"!==e.reason&&"update"!==e.reason||window.localStorage.setItem("is_update","0")}),C.init(),In.init(),chrome.cookies.get({url:v.a.wxUrl,name:"bizuin"},function(e){null!==e&&window.localStorage.setItem("wx_uniqueId",e.value)}),C.forceUpdate().then(function(e){e.option.userInfoReport?(Ln.init(),Xn.init()):(Ln.stop(),Xn.stop(),console.log("report off"))},function(e){console.log(e)}),z(),D(),U.init();var e=new $e;kn.init(),new yn,new tn,ln(),bn(),re.init(),new Se,se(),Jn(),chrome.contextMenus.removeAll(function(){chrome.contextMenus.create({id:"xmt-cookie-clear-root",title:"cookie清理",contexts:["browser_action"]});for(var t=0;t<v.a.platforms.length;t++)!function(t){var n=y.a.getPlatName(y.a.getPlatformCode(v.a.platforms[t]));chrome.contextMenus.create({title:n,contexts:["browser_action"],parentId:"xmt-cookie-clear-root",onclick:function(){$e.clearPlatCookie(v.a.platforms[t]),"wx"!==v.a.platforms[t]&&"wx_ta"!==v.a.platforms[t]||e.clearCookieBox(v.a.platforms[t])}})}(t);chrome.contextMenus.create({title:"采集文章",contexts:["page"],id:"xmt-collect-article",onclick:function(e,t){chrome.tabs.sendMessage(t.id,{action:"xmt-article-collect"})}}),chrome.contextMenus.create({title:"采集图片",contexts:["image"],id:"xmt-collect-image",onclick:function(e,t){chrome.tabs.sendMessage(t.id,{action:"xmt-img-collect",url:e.srcUrl})}},function(){console.log(chrome.runtime.lastError)})});var t=[],n=[],a=1,o={};chrome.extension.onRequest.addListener(function(e,r,i){switch(e.operation){case"config":switch(e.action){case"get":i({config:C.getConfig(e.key)});break;case"set":C.setConfig(e.newConfig),e.newConfig.showCollectBtn&&chrome.tabs.query({},function(t){t.map(function(t){chrome.tabs.sendMessage(t.id,{operation:"showCollectBtn",toShow:!!e.newConfig.showCollectBtn.status})})}),e.newConfig.dragCollect&&chrome.tabs.query({},function(t){t.map(function(t){chrome.tabs.sendMessage(t.id,{operation:"dragCollect",toOpen:!!e.newConfig.dragCollect.status})})})}break;case"getUnreadMsgCount":return ue.requestUnreadCount().then(function(e){i({count:e.count})},function(e){i({count:0})}),!0;case"style":switch(e.action){case"get":y.a.getOptions().then(function(e){i(void 0!==e.customStyle?{style:C.getCustomStyle()}:{style:{style:[]}})});break;case"set":y.a.saveOptions({customStyle:e.customStyle})}break;case"search":switch(e.action){case"open":y.a.browerOpenUrl(_.a.urls.SEARCH_URL+"#/wxsearch/1/"+e.keyword)}break;case"searchType":switch(e.action){case"get":i({type:a});break;case"set":a=e.type}break;case"token":switch(e.action){case"get":i({token:n});break;case"set":var s=e.token;if(-1==f()(n).indexOf(e.token.nickname))n.push(s);else for(var c=0;c<n.length;c++)n[c].nickname==s.nickname&&(n[c].token=s.token)}break;case"searchM":switch(e.action){case"get":i({data:U.getSearchMouth()});break;case"open":U.setSearchMouth(1);break;case"close":U.setSearchMouth(0);break;case"time":U.setTime(e.date)}break;case"accountsData":"get"===e.action?i({accountsData:Se.getAccountsData()}):"update"===e.action&&Se.updateAccountsData(e.accountsData);break;case"getUpdate":"check"===e.action?re.checkNewVersion().then(function(e){i({needUpdate:e.hasNewVer,version:e.version,url:e.url})}):i(re.getUpdateInfo());break;case"xmtLogin":switch(e.action){case"check":var u=Se.getLoginInfo();i({status:u.loginStatus,account:u.loginAccount}),-1===u.loginStatus&&Se.refresh();break;case"login":Se.updateLoginInfo(0,e.account);break;case"logout":je.removeCookie("https://yj.xmt.cn/","PHPSESSID"),Se.updateLoginInfo(-3)}break;case"dataCount":ae(e.options);break;case"collect":return qe.collect(e.url).then(function(t){if("succ"===t.status){var n=t.data;e.from&&"material"===e.from||(n.content=qe.filter(n.content)),i(p()({status:"succ",url:e.url},n))}else i({status:"fail"})},function(e){i({status:"error"})}),!0;case"collectOther":return da.readabilityListener(),b.a.ajax(e.options).then(function(e){i({status:0,data:e}),da.removeReadabilityListener()},function(e){i({status:-1,data:e}),da.removeReadabilityListener()}),!0;case"soogifEdit":var l=y.a.genId();t[l]={},t[l].content=e.base64Img||"",t[l].editorTabId=r.tab.id;var d="http://tool-gifeditor.soogif.com/editor.jsp?gif_id="+l+"&extension_id="+chrome.runtime.id;e.base64Img||(d+="&create"),chrome.tabs.create({url:d},function(e){t[l].soogifTabId=e.id;var n=function(){chrome.tabs.sendMessage(t[l].editorTabId,{event:"editCanceled",gifId:l,type:d.match("create")?"create":"edit"}),delete t[l]};t[l].removeTabHandler=function(e){t[l]&&e==t[l].soogifTabId&&n()},t[l].updateTabHandler=function(e,a){t[l]&&e==t[l].soogifTabId&&(void 0===a.url||a.url===d||a.url.match(/(tool-gifcrop\.soogif\.com)|(tool-compress\.soogif\.com)|(tool-gifeditor\.soogif\.com)/)||n())},chrome.tabs.onRemoved.addListener(t[l].removeTabHandler),chrome.tabs.onUpdated.addListener(t[l].updateTabHandler)}),i({gifId:l});break;case"route":"get"===e.action&&i({routeName:we.get()}),"set"===e.action&&we.set(e.routeName);break;case"go-outer-login":switch(e.action){case"login":ke.goLogin();break;case"bind":ke.goBind(e.phone);break;case"reg":ke.goReg()}break;case"go-xmt-sync":chrome.tabs.create({url:_.a.urls.PLAT_SYNC_HREF});break;case"runScript":chrome.tabs.create({url:e.url},function(e){chrome.tabs.executeScript(e.id,{file:"/static/inject-resource/js/welcome.js"})});break;case"Domain":In.checkDomain();break;case"getToutiao":be.getHotList(function(e){i({data:e})});break;case"getUrl":be.getUrl(e.url,function(e){i(e)});break;case"postUrl":return be.postUrl(e.url,e.data,function(e){i(e)}),!0;case"sxl-article":switch(e.action){case"save":o=e.content;break;case"submit":y.a.submitArticle(o)}break;case"isUpdate":switch(e.action){case"set":window.localStorage.setItem("is_update","1");break;case"get":var m=window.localStorage.getItem("is_update");i({is_update:m})}break;case"sxlTip":switch(e.action){case"set":window.localStorage.setItem("sxl_tip","1");break;case"get":var h=window.localStorage.getItem("sxl_tip");i({sxl_tip:h||"0"})}}}),chrome.webRequest.onBeforeSendHeaders.addListener(function(e){for(var t=e.requestHeaders,n=[],a=0;a<t.length;a++)"X-Requested-With"!==t[a].name&&n.push(t[a]);return{requestHeaders:n}},{urls:["https://mp.weixin.qq.com/cgi-bin/filetransfer?*"]},["blocking","requestHeaders"]),chrome.runtime.onMessageExternal.addListener(function(e,n,a){switch(e.event){case"xmt-request":return b.a.ajax(e.options).then(function(e){a({status:0,data:e})},function(e){a({status:-1,data:e})}),!0;case"uploadImg":return $.fileTransfer(e.base64,{ticket_id:e.ticket_id,ticket:e.ticket,token:e.token}).then(function(e){a(e)},function(e){}),!0;case"mhAddListener":ee.addListener();break;case"mhRemoveListener":ee.removeListener();break;case"getCachedGif":a(t[e.gifId]&&t[e.gifId].content.length>0?{success:!0,gifData:t[e.gifId].content}:{success:!1});break;case"sendEditedGif":var o=y.a.getQueryString("gif_id","?"+n.url.split("?")[1]);a({success:!0}),t[o]?(chrome.tabs.remove(n.tab.id),chrome.tabs.update(t[o].editorTabId,{active:!0}),chrome.tabs.sendMessage(t[o].editorTabId,{event:"sendEditedGif",gifId:o,content:e.gifData,type:n.url.match("create")?"create":"edit"},function(e){delete t[o]})):console.log("找不到图片");break;case"editCollectedStyle":return b.a.post(_.a.urls.SAVE_STYLE+e.id,{content:e.content}).done(function(e){a(0===e.base_resp.ret?{success:!0}:{success:!1})}).fail(function(){a({success:!1})}),!0;case"xmt_login_succ":Se.updateLoginInfo(0,e.account),chrome.tabs.remove(parseInt(e.windowId)),chrome.tabs.create({url:"https://xmt.cn/plugin/install?from=login"});break;case"xmt_bind_succ":chrome.tabs.remove(parseInt(e.windowId));break;case"getHot":return be.getHot(e.type,function(e){a(e)}),!0;case"getToutiao":return be.getToutiao(e.page,function(e,t){a({data:e,count:t})}),!0;case"getBaidu":return be.getBaidu(e.url,function(e){a(e)}),!0;case"getUrl":return be.searchListener(),be.getUrl(e.url,function(e){be.removeSearchListener(),a(e)}),!0;case"newgetUrl":return be.searchListener(),be.newgetUrl(e.options,function(e){be.removeSearchListener(),a(e)}),!0;case"getAccount":return be.getAccount(e.url,function(e){a(e)}),!0;case"postCode":return be.postUrl(e.url,e.data,function(e){a(e)}),!0}})}()},78:function(e,t,n){"use strict";var a=n(2),o=n.n(a),r=n(1),i={};i.getData=function(e,t){var n={state:0};return s(e,t).then(function(a){return n.state=a.state,0==a.state?(n.total_friend_cnt=a.fans_count,c(e,t).then(function(e){return n.state=e.state,0==e.state&&(n.headline_title=e.headline_data.headline_title,n.headline_url=e.headline_data.headline_url,n.read_num=e.headline_data.read_num,n.like_num=e.headline_data.like_num,n.date_time=1e3*e.headline_data.date_time),n})):n})};var s=function(e,t){var n={};return n[r.a.DESKTOP.CUSTOM_HEADER]="getFansCount:"+e,u("https://mp.weixin.qq.com/cgi-bin/home?t=home/index&lang=zh_CN&token="+t+"&f=json",n).then(function(e){return 0==e.base_resp.ret?{state:0,fans_count:e.home_info.total_friend_cnt}:{state:e.base_resp.ret}})},c=function e(t,n,a){var o={headline_title:"",headline_url:"",read_num:0,like_num:0,date_time:0},i={};i[r.a.DESKTOP.CUSTOM_HEADER]="getHeadline:"+t;var s="";return a?s="https://mp.weixin.qq.com/cgi-bin/masssendpage?t=mass/list&action=history&begin="+2*a+"&count=10&token="+n+"&lang=zh_CN&f=json":(a=0,s="https://mp.weixin.qq.com/cgi-bin/masssendpage?t=mass/list&action=history&begin=0&count=10&token="+n+"&lang=zh_CN&f=json"),u(s,i).then(function(r){if("string"!=typeof r){if(0!=r.base_resp.ret)return{state:r.base_resp.ret};if(r.hasOwnProperty("msg_items")){var i=JSON.parse(r.msg_items).msg_item;if(i.length>0){for(var s=0;s<i.length;s++)if(i[s].multi_item.length>0){var c=i[s].multi_item[0];if(1!==c.is_deleted)return o.headline_title=c.title,o.headline_url=c.content_url,o.read_num=c.read_num,o.like_num=c.like_num,o.date_time=i[0].date_time,{state:0,headline_data:o}}if(10==i.length)return e(t,n,a+1)}}}return{state:0,headline_data:o}})},u=function(e,t){return o.a.ajax({url:e,type:"get",headers:t})};i.getToken=function(e){return/token=(\d+)&/.exec(e)[1]},i.newAccountData=function(){return{status:r.a.DESKTOP.ACCOUNT_STATUS.EXPIRED,token:"",total_friend_cnt:0,headline_title:"",headline_url:"",date_time:0,read_num:0,like_num:0,aId:48522,cookies:"",nickname:"",password:"",platform_code:"",portrait:"",user_info_unique_id:"",username:""}},t.a=i},882:function(e,t){e.exports={editorExpand:"editorExpand.c77510967ddf8fd95a14.js",managerExpand:"managerExpand.52b2fa8272b2c057c3d7.js",permanent:"permanent.2482636898d0c18803ba.js",compressImg:"compressImg.51e89a885b43dce8a497.js",styleCollect:"styleCollect.5dfdd1ff35e81aff44d8.js",wx:"wx.750962a2e6b226720e42.js",tt:"tt.8afd371efef2e4aa2b79.js",op:"op.220dd59b4632e9c9d677.js",om:"compressImg.51e89a885b43dce8a497.js",wb:"wb.23a4985cc9db15abafc1.js",bj:"bj.20ab15bc91beebc12dbd.js",uc:"uc.4ef4a51ff454f81fd964.js",zh:"zh.11f8aeabe6c9d380194c.js",wy:"wy.53136afa60630b906041.js",sh:"sh.0efedce4d900088b5b34.js",js:"bj.20ab15bc91beebc12dbd.js",wxb:"wxb.7e652d5ba935dc2f3227.js",xb:"wxb.7e652d5ba935dc2f3227.js",db:"bj.20ab15bc91beebc12dbd.js",loginAccountStyle:"loginAccountStyle.2bd26557ad64b4764b5e.js",collectionImg:"collectionImg.1b3e40d720221d2429f3.js",style:"style.bac7632f446b0e36d326.js",ttStyle:"ttStyle.f54209f3753f7fa3de11.js",collection:"collection.fc5920a9b5fd5ad29002.js",sendExtId:"sendExtId.3e4e511af016a7d3f557.js",sxl:"sxl.9267821936b275170687.js",ttEditorExpand:"ttEditorExpand.107c34f39ffdd4dbfd35.js",loginPageScript:"loginPageScript.03093db39b3d5b8c4d8c.js",ttCollect:"ttCollect.5ba1a5ad114496547c7b.js",shop:"shop.245f68a9050691579182.js"}}},[571]);